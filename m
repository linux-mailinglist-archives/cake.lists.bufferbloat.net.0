Return-Path: <cake-bounces@lists.bufferbloat.net>
X-Original-To: lists+cake@lfdr.de
Delivered-To: lists+cake@lfdr.de
Received: from lists.bufferbloat.net (lists.bufferbloat.net [IPv6:2600:3c03:e000:3ca:f00f:f00f:b33b:b33b])
	by mail.lfdr.de (Postfix) with ESMTPS id C6AE03C352A
	for <lists+cake@lfdr.de>; Sat, 10 Jul 2021 17:33:35 +0200 (CEST)
Received: from pitt.bufferbloat.net (localhost [127.0.0.1])
	by lists.bufferbloat.net (Postfix) with ESMTP id 46B453CBC7;
	Sat, 10 Jul 2021 11:33:34 -0400 (EDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
	d=lists.bufferbloat.net; s=201610; t=1625931214;
	bh=oqH2rfo13kUmTZ0UzHe7yH2JXVPeAykxw5tSQJm/5qo=;
	h=References:In-Reply-To:From:Date:To:Subject:List-Id:
	 List-Unsubscribe:List-Archive:List-Post:List-Help:List-Subscribe:
	 From;
	b=PdbEsilQ5CQX7iNxJeZZuClbnkffg5ZnGeOgeEK8FlXPsn+VsqdXNp+/5r/m+A9qb
	 ovcvGB3vijO6kBmuIND6FYJ0RjgMlZvxV+TkLXJirqR1M6UZYLS1iNnPrL+gYlUOUn
	 5syqo+zC6v57F1PurewE8/ku3MCUJKQmh4PXrU7bdOCZdSxEg/F1Rk3BG1Bhlu8oXS
	 j2WBiVwpa5h/XmOCn+xrtwzCIbVqC/xYd80ZjvR0TQu78gzuub+xesi+4uIIBLlWv8
	 e3ipEddl/xble/k9DkhwU8rLv+e7ZaLz5M6MZBfsB+WFk86nt0K0wYh60NhLLxpDlw
	 cRU4kV3chMl0Q==
X-Original-To: cake@lists.bufferbloat.net
Delivered-To: cake@lists.bufferbloat.net
Received: from mail-il1-x135.google.com (mail-il1-x135.google.com
 [IPv6:2607:f8b0:4864:20::135])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by lists.bufferbloat.net (Postfix) with ESMTPS id A98A93B29E;
 Sat, 10 Jul 2021 11:33:33 -0400 (EDT)
Received: by mail-il1-x135.google.com with SMTP id z1so14118816ils.0;
 Sat, 10 Jul 2021 08:33:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :content-transfer-encoding;
 bh=SKQwTNJ1mKJgP01WP9xXIKwMv2FyY6XYnKpjgyiMKEU=;
 b=dNKOIcy7lqQ3wn16KJseVk1s69SyghAqwZ2r1PDurjLa1XwbE/6c0rPXfXFd8L1iqk
 AeJfZCSZtgCS5f0mj+ovGR0U/tYGDlShL2KcFj2KYQ52MmEPsM2Q8L3YFG6L3mS4WHPA
 oL++uOGpCAdfRZPWjk0lpxMZtAZDaHNRdpnt3Vt1KWe+O3nj9xFKC/HxEjOmpftI0Ij4
 OFnLNlXdkw9pPLkmH+KMxOmWbBCtkv7nr/+jHvyIcUq7h0eNgKmgs+Cx+AGTnzLZ9mJT
 0cnjHMCLniMNanGvCY+IJY57qoKndOARP0xXhiyqA80I2RDn16+xkcD83NLJ1yUdUfu4
 b7OA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:content-transfer-encoding;
 bh=SKQwTNJ1mKJgP01WP9xXIKwMv2FyY6XYnKpjgyiMKEU=;
 b=OWNkm+8VRJVTIlnmxBtDKL10Z4wnqDud8CFo9yGdx9jIG3AJrKI+BDTxK9ne0AVsMD
 nFs0idEhMKUu3KbtkgDwYt5/f49GmeGwOW/FUOJAJ4Bzn1CSn+fWU+DW/DMdBrbm938J
 RfP3C6y/OdYrcZgxGSjSzs3TA/hDo5U2LVyjoDoGWSoOUD6seSFSRv4XrUDRN7Yw+c8t
 x9oSSBvRmZDqs8Zuk/6tR1W98Zy7KzW4inNuBQkYjM9wJl1GU5y+7GpBNpp64yL9qiXo
 jgO1sc78/5QLJhJwHOhzmI9bSd69i14FZV2/8pwXOsQcSiMi5OXBOndcXiXRhLtyV6Qt
 zPJw==
X-Gm-Message-State: AOAM531O5sbxAWWib0BVWbhvqpvMBdJpyKO4jqmT3I3FRqBRGnC5Dtc6
 R30MvOoA6bamb1/58h2jfvWe6tjRkQalKwBT9uWhiz0Bv4k=
X-Google-Smtp-Source: ABdhPJxcQ6dNFuW+WhvswZW/QfcqEG2wPN0ap9FcVSk+b31GA2CGvWRgXHx0INAZe9CHk7qlxJcxRfYWWhbCIdhnEoY=
X-Received: by 2002:a05:6e02:8:: with SMTP id h8mr30329199ilr.0.1625931212634; 
 Sat, 10 Jul 2021 08:33:32 -0700 (PDT)
MIME-Version: 1.0
References: <1625910047-56840-1-git-send-email-shenjian15@huawei.com>
In-Reply-To: <1625910047-56840-1-git-send-email-shenjian15@huawei.com>
From: Dave Taht <dave.taht@gmail.com>
Date: Sat, 10 Jul 2021 08:33:20 -0700
Message-ID: <CAA93jw4oWpoWkRk+YrzLfWX+0PpMHMJmALup6BLBczwLrjn-hA@mail.gmail.com>
To: Cake List <cake@lists.bufferbloat.net>, 
 cerowrt-devel <cerowrt-devel@lists.bufferbloat.net>
Subject: [Cake] Fwd: [RFC net-next] net: extend netdev features
X-BeenThere: cake@lists.bufferbloat.net
X-Mailman-Version: 2.1.20
Precedence: list
List-Id: Cake - FQ_codel the next generation <cake.lists.bufferbloat.net>
List-Unsubscribe: <https://lists.bufferbloat.net/options/cake>,
 <mailto:cake-request@lists.bufferbloat.net?subject=unsubscribe>
List-Archive: <https://lists.bufferbloat.net/pipermail/cake>
List-Post: <mailto:cake@lists.bufferbloat.net>
List-Help: <mailto:cake-request@lists.bufferbloat.net?subject=help>
List-Subscribe: <https://lists.bufferbloat.net/listinfo/cake>,
 <mailto:cake-request@lists.bufferbloat.net?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: cake-bounces@lists.bufferbloat.net
Sender: "Cake" <cake-bounces@lists.bufferbloat.net>

T25lIHRoaW5nIHNvbWV3aGF0IHJlbGF0ZWQgdG8gdGhpcyB3YXMgZmluYWxseSBleHBhbmRpbmcg
dGhlIHNwYWNlCmF2YWlsYWJsZSBmb3IgdGhlIHRjIGFuZCBpcHRhYmxlcyBmdW5jdGlvbmFsaXR5
IGZvcgp0aGluZ3MgbGlrZSBoYXNoaW5nIGFuZCBhY3Rpb25zIGV0YyBmcm9tIDE2IGJpdHMgdG8g
MzIuIFRoYXQgaXMKc29tZXRoaW5nIG9mIGEgZm9yayBsaWZ0IHVwZ3JhZGUsIGJ1dC4uLiA2NGsg
cXVldWVzIGlzIG5vdAplbm91Z2ggaW4gc29tZSBjYXNlcywgbm9yIGlzIDY0ayBwb3NzaWJsZSB1
c2VycyBpbiBsaWJyZXFvcy4gdGhvdWdodHMKCi0tLS0tLS0tLS0gRm9yd2FyZGVkIG1lc3NhZ2Ug
LS0tLS0tLS0tCkZyb206IEppYW4gU2hlbiA8c2hlbmppYW4xNUBodWF3ZWkuY29tPgpEYXRlOiBT
YXQsIEp1bCAxMCwgMjAyMSBhdCAyOjQ3IEFNClN1YmplY3Q6IFtSRkMgbmV0LW5leHRdIG5ldDog
ZXh0ZW5kIG5ldGRldiBmZWF0dXJlcwpUbzogPGRhdmVtQGRhdmVtbG9mdC5uZXQ+LCA8a3ViYUBr
ZXJuZWwub3JnPgpDYzogPG5ldGRldkB2Z2VyLmtlcm5lbC5vcmc+LCA8bGludXhhcm1Ab3BlbmV1
bGVyLm9yZz4KCgpGb3IgdGhlIHByb3RvdHlwZSBvZiBuZXRkZXZfZmVhdHVyZXNfdCBpcyB1NjQs
IGFuZCB0aGUgbnVtYmVyCm9mIG5ldGRldmljZSBmZWF0dXJlIGJpdHMgaXMgNjQgbm93LiBTbyB0
aGVyZSBpcyBubyBzcGFjZSB0bwppbnRyb2R1Y2UgbmV3IGZlYXR1cmUgYml0LgoKSSBkaWQgYSBz
bWFsbCBjaGFuZ2UgZm9yIHRoaXMuIEtlZXAgdGhlIHByb3RvdHlwZSBvZgpuZXRkZXZfZmVhdHVy
ZV90LCBhbmQgZXh0ZW5kIHRoZSBmZWF0dXJlIG1lbWJlcnMgaW4gc3RydWN0Cm5ldF9kZXZpY2Ug
dG8gYW4gYXJyYXkgb2YgbmV0ZGV2X2ZlYXR1cmVzX3QuIFNvIG1vcmUgZmVhdHVyZXMKYml0cyBj
YW4gYmUgdXNlZC4KCkFzIHRoaXMgY2hhbmdlLCBzb21lIGZ1bmN0aW9ucyB3aGljaCB1c2UgbmV0
ZGV2X2ZlYXR1cmVzX3QgYXMKcGFyYW1ldGVyIG9yIHJldHVyZW4gdmFsdWUgd2lsbCBiZSBhZmZl
Y3RlZC4KSSBkaWQgYmVsb3cgY2hhbmdlczoKYS4gcGFyYW1ldGVyOiAibmV0ZGV2X2ZlYXR1cmVz
X3QiIHRvICJuZXRkZXZfZmVhdHVyZXNfdCAqIgpiLiByZXR1cm4gdmFsdWU6ICJuZXRkZXZfZmVh
dHVyZV90IiB0byAidm9pZCIsIGFuZCBhZGQKIm5ldGRldl9mZWF0dXJlX3QgKiIgYXMgb3V0cHV0
IHBhcmFtZXRlci4KCkkga2VwdCBzb21lIGZ1bmN0aW9ucyBubyBjaGFuZ2UsIHdoaWNoIGFyZSBz
dXJlbHkgdXNlaW5nIHRoZQpmaXJzdCA2NCBiaXQgb2YgbmV0IGRldmljZSBmZWF0dXJlcyBub3cs
IHN1Y2ggYXMgZnVuY3Rpb24KbmVkZXZfYWRkX3Rzb19mZWF0dXJlcygpLiBJbiBvcmRlciB0byBt
aW5pbWl6ZSB0byBjaGFuZ2VzLgoKRm9yIHRoZSBmZWF0dXJlcyBhcmUgYXJyYXkgbm93LCBzbyBp
dCdzIHVuYWJsZSB0byBkbyBsb2dpY2FsCm9wZXJhdGlvbiBkaXJlY3RseS4gSSBpbnRyb2R1Y2Ug
YSBpbmxpbmUgZnVuY3Rpb24gc2V0IGZvcgp0aGVtLCBpbmNsdWRpbmcgIm5ldGRldl9mZWF0dXJl
c19hbmQvYW5kbm90L29yL3hvci9lcXVhbC9lbXB0eSIuCgpGb3IgTkVUREVWX0ZFQVRVUkVfQ09V
TlQgbWF5IGJlIG1vcmUgdGhhbiA2NCwgc28gdGhlIHNoaWZ0Cm9wZXJhdGlvbiBmb3IgTkVUREVW
X0ZFQVRVUkVfQ09VTlQgaXMgaWxsZWdhbC4gSSBjaGFuZ2VkIHNvbWUKbWFjcm9lcyBhbmQgZnVu
Y3Rpb25zLCB3aGljaCBkb2VzIHNoaWZ0IG9wZXJ0aW9uIHdpdGggaXQuCgpJIGhhdmVuJ3QgZmlu
aXNoZWQgYWxsIHRoZSBjaGFuZ2VzLCBmb3IgaXQgYWZmZWN0ZWQgYWxsIHRoZQpkcml2ZXJzIHdo
aWNoIHVzZSB0aGUgZmVhdHVyZSwgbmVlZCBtb3JlIHRpbWUgYW5kIHRlc3QuIEkKc2VudCB0aGlz
IFJGQyBwYXRjaCwgd2FudCB0byBrbm93IHdoZXRoZXIgdGhpcyBjaGFuZ2UgaXMKYWNjZXB0YWJs
ZSwgYW5kIGhvdyB0byBpbXByb3ZlIGl0LgoKQW55IGNvbW1lbnRzIHdpbGwgYmUgaGVscGZ1bC4K
ClNpZ25lZC1vZmYtYnk6IEppYW4gU2hlbiA8c2hlbmppYW4xNUBodWF3ZWkuY29tPgotLS0KIGRy
aXZlcnMvbmV0L2V0aGVybmV0L2hpc2lsaWNvbi9obnMvaG5zX2VuZXQuYyAgIHwgIDM0ICstLQog
ZHJpdmVycy9uZXQvZXRoZXJuZXQvaGlzaWxpY29uL2huczMvaG5zM19lbmV0LmMgfCAgOTcgKysr
Ky0tLS0tCiBkcml2ZXJzL25ldC9ldGhlcm5ldC9odWF3ZWkvaGluaWMvaGluaWNfbWFpbi5jICB8
ICA3MSArKystLS0KIGRyaXZlcnMvbmV0L2V0aGVybmV0L2h1YXdlaS9oaW5pYy9oaW5pY19yeC5j
ICAgIHwgICA0ICstCiBpbmNsdWRlL2xpbnV4L2lmX3ZsYW4uaCAgICAgICAgICAgICAgICAgICAg
ICAgICB8ICAgMiArLQogaW5jbHVkZS9saW51eC9uZXRkZXZfZmVhdHVyZXMuaCAgICAgICAgICAg
ICAgICAgfCAxMDUgKysrKysrKystCiBpbmNsdWRlL2xpbnV4L25ldGRldmljZS5oICAgICAgICAg
ICAgICAgICAgICAgICB8ICAzMSArLS0KIG5ldC84MDIxcS92bGFuLmMgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHwgICA0ICstCiBuZXQvODAyMXEvdmxhbi5oICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB8ICAgMiArLQogbmV0LzgwMjFxL3ZsYW5fZGV2LmMgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgfCAgNDkgKysrLS0KIG5ldC9jb3JlL2Rldi5jICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHwgMjc2ICsrKysrKysrKysrKy0tLS0tLS0tLS0tLQogbmV0
L2NvcmUvbmV0cG9sbC5jICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIG5l
dC9ldGh0b29sL2ZlYXR1cmVzLmMgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDU2ICsrKy0t
CiBuZXQvZXRodG9vbC9pb2N0bC5jICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICA5MyAr
KysrKy0tLQogMTQgZmlsZXMgY2hhbmdlZCwgNDkzIGluc2VydGlvbnMoKyksIDMzNyBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL25ldC9ldGhlcm5ldC9oaXNpbGljb24vaG5zL2hu
c19lbmV0LmMKYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9oaXNpbGljb24vaG5zL2huc19lbmV0LmMK
aW5kZXggYWQ1MzRmOS4uNGYyNDVjZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9uZXQvZXRoZXJuZXQv
aGlzaWxpY29uL2hucy9obnNfZW5ldC5jCisrKyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2hpc2ls
aWNvbi9obnMvaG5zX2VuZXQuYwpAQCAtNDc5LDcgKzQ3OSw3IEBAIHN0YXRpYyB2b2lkIGhuc19u
aWNfcnhfY2hlY2tzdW0oc3RydWN0Cmhuc19uaWNfcmluZ19kYXRhICpyaW5nX2RhdGEsCiAgICAg
ICAgdTMyIGw0aWQ7CgogICAgICAgIC8qIGNoZWNrIGlmIFJYIGNoZWNrc3VtIG9mZmxvYWQgaXMg
ZW5hYmxlZCAqLwotICAgICAgIGlmICh1bmxpa2VseSghKG5ldGRldi0+ZmVhdHVyZXMgJiBORVRJ
Rl9GX1JYQ1NVTSkpKQorICAgICAgIGlmICh1bmxpa2VseSghKG5ldGRldi0+ZmVhdHVyZXNbMF0g
JiBORVRJRl9GX1JYQ1NVTSkpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvKiBJ
biBoYXJkd2FyZSwgd2Ugb25seSBzdXBwb3J0IGNoZWNrc3VtIGZvciB0aGUgZm9sbG93aW5nIHBy
b3RvY29sczoKQEAgLTE3NjgsMTcgKzE3NjgsMTcgQEAgc3RhdGljIGludCBobnNfbmljX2NoYW5n
ZV9tdHUoc3RydWN0Cm5ldF9kZXZpY2UgKm5kZXYsIGludCBuZXdfbXR1KQogfQoKIHN0YXRpYyBp
bnQgaG5zX25pY19zZXRfZmVhdHVyZXMoc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRldiwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlcykKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCAqZmVhdHVyZXMp
CiB7CiAgICAgICAgc3RydWN0IGhuc19uaWNfcHJpdiAqcHJpdiA9IG5ldGRldl9wcml2KG5ldGRl
dik7CgogICAgICAgIHN3aXRjaCAocHJpdi0+ZW5ldF92ZXIpIHsKICAgICAgICBjYXNlIEFFX1ZF
UlNJT05fMToKLSAgICAgICAgICAgICAgIGlmIChmZWF0dXJlcyAmIChORVRJRl9GX1RTTyB8IE5F
VElGX0ZfVFNPNikpCisgICAgICAgICAgICAgICBpZiAoZmVhdHVyZXNbMF0gJiAoTkVUSUZfRl9U
U08gfCBORVRJRl9GX1RTTzYpKQogICAgICAgICAgICAgICAgICAgICAgICBuZXRkZXZfaW5mbyhu
ZXRkZXYsICJlbmV0IHYxIGRvIG5vdCBzdXBwb3J0IHRzbyFcbiIpOwogICAgICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgZGVmYXVsdDoKLSAgICAgICAgICAgICAgIGlmIChmZWF0dXJlcyAmIChO
RVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNikpIHsKKyAgICAgICAgICAgICAgIGlmIChmZWF0dXJl
c1swXSAmIChORVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNikpIHsKICAgICAgICAgICAgICAgICAg
ICAgICAgcHJpdi0+b3BzLmZpbGxfZGVzYyA9IGZpbGxfdHNvX2Rlc2M7CiAgICAgICAgICAgICAg
ICAgICAgICAgIHByaXYtPm9wcy5tYXliZV9zdG9wX3R4ID0gaG5zX25pY19tYXliZV9zdG9wX3Rz
bzsKICAgICAgICAgICAgICAgICAgICAgICAgLyogVGhlIGNoaXAgb25seSBzdXBwb3J0IDcqNDA5
NiAqLwpAQCAtMTc4OSwyNCArMTc4OSwyMyBAQCBzdGF0aWMgaW50IGhuc19uaWNfc2V0X2ZlYXR1
cmVzKHN0cnVjdApuZXRfZGV2aWNlICpuZXRkZXYsCiAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgICBicmVhazsKICAgICAgICB9Ci0gICAgICAgbmV0ZGV2LT5mZWF0dXJlcyA9IGZlYXR1
cmVzOworICAgICAgIG5ldGRldi0+ZmVhdHVyZXNbMF0gPSBmZWF0dXJlc1swXTsKICAgICAgICBy
ZXR1cm4gMDsKIH0KCi1zdGF0aWMgbmV0ZGV2X2ZlYXR1cmVzX3QgaG5zX25pY19maXhfZmVhdHVy
ZXMoCi0gICAgICAgICAgICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqbmV0ZGV2LCBuZXRkZXZfZmVh
dHVyZXNfdCBmZWF0dXJlcykKK3N0YXRpYyB2b2lkIGhuc19uaWNfZml4X2ZlYXR1cmVzKHN0cnVj
dCBuZXRfZGV2aWNlICpuZXRkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l
dGRldl9mZWF0dXJlc190ICpmZWF0dXJlcykKIHsKICAgICAgICBzdHJ1Y3QgaG5zX25pY19wcml2
ICpwcml2ID0gbmV0ZGV2X3ByaXYobmV0ZGV2KTsKCiAgICAgICAgc3dpdGNoIChwcml2LT5lbmV0
X3ZlcikgewogICAgICAgIGNhc2UgQUVfVkVSU0lPTl8xOgotICAgICAgICAgICAgICAgZmVhdHVy
ZXMgJj0gfihORVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNiB8CisgICAgICAgICAgICAgICBmZWF0
dXJlc1swXSAmPSB+KE5FVElGX0ZfVFNPIHwgTkVUSUZfRl9UU082IHwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBORVRJRl9GX0hXX1ZMQU5fQ1RBR19GSUxURVIpOwogICAgICAgICAg
ICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg
ICAgIH0KLSAgICAgICByZXR1cm4gZmVhdHVyZXM7CiB9Cgogc3RhdGljIGludCBobnNfbmljX3Vj
X3N5bmMoc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRldiwgY29uc3QgdW5zaWduZWQKY2hhciAqYWRk
cikKQEAgLTIxNjMsOCArMjE2Miw4IEBAIHN0YXRpYyB2b2lkIGhuc19uaWNfc2V0X3ByaXZfb3Bz
KHN0cnVjdApuZXRfZGV2aWNlICpuZXRkZXYpCiAgICAgICAgICAgICAgICBwcml2LT5vcHMubWF5
YmVfc3RvcF90eCA9IGhuc19uaWNfbWF5YmVfc3RvcF90eDsKICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICAgICAgcHJpdi0+b3BzLmdldF9yeGRfYm51bSA9IGdldF92MnJ4X2Rlc2NfYm51bTsK
LSAgICAgICAgICAgICAgIGlmICgobmV0ZGV2LT5mZWF0dXJlcyAmIE5FVElGX0ZfVFNPKSB8fAot
ICAgICAgICAgICAgICAgICAgIChuZXRkZXYtPmZlYXR1cmVzICYgTkVUSUZfRl9UU082KSkgewor
ICAgICAgICAgICAgICAgaWYgKChuZXRkZXYtPmZlYXR1cmVzWzBdICYgTkVUSUZfRl9UU08pIHx8
CisgICAgICAgICAgICAgICAgICAgKG5ldGRldi0+ZmVhdHVyZXNbMF0gJiBORVRJRl9GX1RTTzYp
KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaXYtPm9wcy5maWxsX2Rlc2MgPSBmaWxsX3Rz
b19kZXNjOwogICAgICAgICAgICAgICAgICAgICAgICBwcml2LT5vcHMubWF5YmVfc3RvcF90eCA9
IGhuc19uaWNfbWF5YmVfc3RvcF90c287CiAgICAgICAgICAgICAgICAgICAgICAgIC8qIFRoaXMg
Y2hpcCBvbmx5IHN1cHBvcnQgNyo0MDk2ICovCkBAIC0yMzI1LDIyICsyMzI0LDIzIEBAIHN0YXRp
YyBpbnQgaG5zX25pY19kZXZfcHJvYmUoc3RydWN0CnBsYXRmb3JtX2RldmljZSAqcGRldikKICAg
ICAgICBuZGV2LT5uZXRkZXZfb3BzID0gJmhuc19uaWNfbmV0ZGV2X29wczsKICAgICAgICBobnNf
ZXRodG9vbF9zZXRfb3BzKG5kZXYpOwoKLSAgICAgICBuZGV2LT5mZWF0dXJlcyB8PSBORVRJRl9G
X0lQX0NTVU0gfCBORVRJRl9GX0lQVjZfQ1NVTSB8CisgICAgICAgbmRldi0+ZmVhdHVyZXNbMF0g
fD0gTkVUSUZfRl9JUF9DU1VNIHwgTkVUSUZfRl9JUFY2X0NTVU0gfAogICAgICAgICAgICAgICAg
TkVUSUZfRl9SWENTVU0gfCBORVRJRl9GX1NHIHwgTkVUSUZfRl9HU08gfAogICAgICAgICAgICAg
ICAgTkVUSUZfRl9HUk87Ci0gICAgICAgbmRldi0+dmxhbl9mZWF0dXJlcyB8PQorICAgICAgIG5k
ZXYtPnZsYW5fZmVhdHVyZXNbMF0gfD0KICAgICAgICAgICAgICAgIE5FVElGX0ZfSVBfQ1NVTSB8
IE5FVElGX0ZfSVBWNl9DU1VNIHwgTkVUSUZfRl9SWENTVU07Ci0gICAgICAgbmRldi0+dmxhbl9m
ZWF0dXJlcyB8PSBORVRJRl9GX1NHIHwgTkVUSUZfRl9HU08gfCBORVRJRl9GX0dSTzsKKyAgICAg
ICBuZGV2LT52bGFuX2ZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfU0cgfCBORVRJRl9GX0dTTyB8IE5F
VElGX0ZfR1JPOwoKICAgICAgICAvKiBNVFUgcmFuZ2U6IDY4IC0gOTU3OCAodjEpIG9yIDk3MDYg
KHYyKSAqLwogICAgICAgIG5kZXYtPm1pbl9tdHUgPSBNQUNfTUlOX01UVTsKICAgICAgICBzd2l0
Y2ggKHByaXYtPmVuZXRfdmVyKSB7CiAgICAgICAgY2FzZSBBRV9WRVJTSU9OXzI6Ci0gICAgICAg
ICAgICAgICBuZGV2LT5mZWF0dXJlcyB8PSBORVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNiB8IE5F
VElGX0ZfTlRVUExFOwotICAgICAgICAgICAgICAgbmRldi0+aHdfZmVhdHVyZXMgfD0gTkVUSUZf
Rl9JUF9DU1VNIHwgTkVUSUZfRl9JUFY2X0NTVU0gfAorICAgICAgICAgICAgICAgbmRldi0+ZmVh
dHVyZXNbMF0gfD0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBORVRJRl9GX1RTTyB8
IE5FVElGX0ZfVFNPNiB8IE5FVElGX0ZfTlRVUExFOworICAgICAgICAgICAgICAgbmRldi0+aHdf
ZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9JUF9DU1VNIHwgTkVUSUZfRl9JUFY2X0NTVU0gfAogICAg
ICAgICAgICAgICAgICAgICAgICBORVRJRl9GX1JYQ1NVTSB8IE5FVElGX0ZfU0cgfCBORVRJRl9G
X0dTTyB8CiAgICAgICAgICAgICAgICAgICAgICAgIE5FVElGX0ZfR1JPIHwgTkVUSUZfRl9UU08g
fCBORVRJRl9GX1RTTzY7Ci0gICAgICAgICAgICAgICBuZGV2LT52bGFuX2ZlYXR1cmVzIHw9IE5F
VElGX0ZfVFNPIHwgTkVUSUZfRl9UU082OworICAgICAgICAgICAgICAgbmRldi0+dmxhbl9mZWF0
dXJlc1swXSB8PSBORVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNjsKICAgICAgICAgICAgICAgIG5k
ZXYtPm1heF9tdHUgPSBNQUNfTUFYX01UVV9WMiAtCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKEVUSF9ITEVOICsgRVRIX0ZDU19MRU4gKyBWTEFOX0hMRU4pOwogICAgICAgICAgICAg
ICAgYnJlYWs7CmRpZmYgLS1naXQgYS9kcml2ZXJzL25ldC9ldGhlcm5ldC9oaXNpbGljb24vaG5z
My9obnMzX2VuZXQuYwpiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2hpc2lsaWNvbi9obnMzL2huczNf
ZW5ldC5jCmluZGV4IGNkYjVmMTQuLmJhNTY5MDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbmV0L2V0
aGVybmV0L2hpc2lsaWNvbi9obnMzL2huczNfZW5ldC5jCisrKyBiL2RyaXZlcnMvbmV0L2V0aGVy
bmV0L2hpc2lsaWNvbi9obnMzL2huczNfZW5ldC5jCkBAIC0xNDgxLDcgKzE0ODEsNyBAQCBzdGF0
aWMgaW50IGhuczNfaGFuZGxlX3Z0YWdzKHN0cnVjdApobnMzX2VuZXRfcmluZyAqdHhfcmluZywK
ICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwoKICAgICAgICBpZiAoc2tiLT5wcm90b2Nv
bCA9PSBodG9ucyhFVEhfUF84MDIxUSkgJiYKLSAgICAgICAgICAgIShoYW5kbGUtPmtpbmZvLm5l
dGRldi0+ZmVhdHVyZXMgJiBORVRJRl9GX0hXX1ZMQU5fQ1RBR19UWCkpIHsKKyAgICAgICAgICAg
IShoYW5kbGUtPmtpbmZvLm5ldGRldi0+ZmVhdHVyZXNbMF0gJiBORVRJRl9GX0hXX1ZMQU5fQ1RB
R19UWCkpIHsKICAgICAgICAgICAgICAgIC8qIFdoZW4gSFcgVkxBTiBhY2NlbGVyYXRpb24gaXMg
dHVybmVkIG9mZiwgYW5kIHRoZSBzdGFjawogICAgICAgICAgICAgICAgICogc2V0cyB0aGUgcHJv
dG9jb2wgdG8gODAyLjFxLCB0aGUgZHJpdmVyIGp1c3QgbmVlZCB0bwogICAgICAgICAgICAgICAg
ICogc2V0IHRoZSBwcm90b2NvbCB0byB0aGUgZW5jYXBzdWxhdGVkIGV0aGVydHlwZS4KQEAgLTIz
MDAsNTYgKzIzMDAsNTcgQEAgc3RhdGljIGludCBobnMzX25pY19kb19pb2N0bChzdHJ1Y3QgbmV0
X2RldmljZSAqbmV0ZGV2LAogfQoKIHN0YXRpYyBpbnQgaG5zM19uaWNfc2V0X2ZlYXR1cmVzKHN0
cnVjdCBuZXRfZGV2aWNlICpuZXRkZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVzKQorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBuZXRkZXZfZmVhdHVyZXNfdCAqZmVhdHVyZXMpCiB7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1
cmVzX3QgY2hhbmdlZCA9IG5ldGRldi0+ZmVhdHVyZXMgXiBmZWF0dXJlczsKKyAgICAgICBuZXRk
ZXZfZmVhdHVyZXNfdCBjaGFuZ2VkW05FVERFVl9GRUFUVVJFX0RXT1JEU107CiAgICAgICAgc3Ry
dWN0IGhuczNfbmljX3ByaXYgKnByaXYgPSBuZXRkZXZfcHJpdihuZXRkZXYpOwogICAgICAgIHN0
cnVjdCBobmFlM19oYW5kbGUgKmggPSBwcml2LT5hZV9oYW5kbGU7CiAgICAgICAgYm9vbCBlbmFi
bGU7CiAgICAgICAgaW50IHJldDsKCi0gICAgICAgaWYgKGNoYW5nZWQgJiAoTkVUSUZfRl9HUk9f
SFcpICYmIGgtPmFlX2FsZ28tPm9wcy0+c2V0X2dyb19lbikgewotICAgICAgICAgICAgICAgZW5h
YmxlID0gISEoZmVhdHVyZXMgJiBORVRJRl9GX0dST19IVyk7CisgICAgICAgbmV0ZGV2X2ZlYXR1
cmVzX3hvcihjaGFuZ2VkLCBuZXRkZXYtPmZlYXR1cmVzLCBmZWF0dXJlcyk7CisgICAgICAgaWYg
KGNoYW5nZWRbMF0gJiAoTkVUSUZfRl9HUk9fSFcpICYmIGgtPmFlX2FsZ28tPm9wcy0+c2V0X2dy
b19lbikgeworICAgICAgICAgICAgICAgZW5hYmxlID0gISEoZmVhdHVyZXNbMF0gJiBORVRJRl9G
X0dST19IVyk7CiAgICAgICAgICAgICAgICByZXQgPSBoLT5hZV9hbGdvLT5vcHMtPnNldF9ncm9f
ZW4oaCwgZW5hYmxlKTsKICAgICAgICAgICAgICAgIGlmIChyZXQpCiAgICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQoKLSAgICAgICBpZiAoKGNoYW5nZWQgJiBORVRJ
Rl9GX0hXX1ZMQU5fQ1RBR19SWCkgJiYKKyAgICAgICBpZiAoKGNoYW5nZWRbMF0gJiBORVRJRl9G
X0hXX1ZMQU5fQ1RBR19SWCkgJiYKICAgICAgICAgICAgaC0+YWVfYWxnby0+b3BzLT5lbmFibGVf
aHdfc3RyaXBfcnh2dGFnKSB7Ci0gICAgICAgICAgICAgICBlbmFibGUgPSAhIShmZWF0dXJlcyAm
IE5FVElGX0ZfSFdfVkxBTl9DVEFHX1JYKTsKKyAgICAgICAgICAgICAgIGVuYWJsZSA9ICEhKGZl
YXR1cmVzWzBdICYgTkVUSUZfRl9IV19WTEFOX0NUQUdfUlgpOwogICAgICAgICAgICAgICAgcmV0
ID0gaC0+YWVfYWxnby0+b3BzLT5lbmFibGVfaHdfc3RyaXBfcnh2dGFnKGgsIGVuYWJsZSk7CiAg
ICAgICAgICAgICAgICBpZiAocmV0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0
OwogICAgICAgIH0KCi0gICAgICAgaWYgKChjaGFuZ2VkICYgTkVUSUZfRl9OVFVQTEUpICYmIGgt
PmFlX2FsZ28tPm9wcy0+ZW5hYmxlX2ZkKSB7Ci0gICAgICAgICAgICAgICBlbmFibGUgPSAhIShm
ZWF0dXJlcyAmIE5FVElGX0ZfTlRVUExFKTsKKyAgICAgICBpZiAoKGNoYW5nZWRbMF0gJiBORVRJ
Rl9GX05UVVBMRSkgJiYgaC0+YWVfYWxnby0+b3BzLT5lbmFibGVfZmQpIHsKKyAgICAgICAgICAg
ICAgIGVuYWJsZSA9ICEhKGZlYXR1cmVzWzBdICYgTkVUSUZfRl9OVFVQTEUpOwogICAgICAgICAg
ICAgICAgaC0+YWVfYWxnby0+b3BzLT5lbmFibGVfZmQoaCwgZW5hYmxlKTsKICAgICAgICB9Cgot
ICAgICAgIGlmICgobmV0ZGV2LT5mZWF0dXJlcyAmIE5FVElGX0ZfSFdfVEMpID4gKGZlYXR1cmVz
ICYgTkVUSUZfRl9IV19UQykgJiYKKyAgICAgICBpZiAoKG5ldGRldi0+ZmVhdHVyZXNbMF0gJiBO
RVRJRl9GX0hXX1RDKSA+CisgICAgICAgICAgICAoZmVhdHVyZXNbMF0gJiBORVRJRl9GX0hXX1RD
KSAmJgogICAgICAgICAgICBoLT5hZV9hbGdvLT5vcHMtPmNsc19mbG93ZXJfYWN0aXZlKGgpKSB7
CiAgICAgICAgICAgICAgICBuZXRkZXZfZXJyKG5ldGRldiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgInRoZXJlIGFyZSBvZmZsb2FkZWQgVEMgZmlsdGVycyBhY3RpdmUsCmNhbm5vdCBkaXNh
YmxlIEhXIFRDIG9mZmxvYWQiKTsKICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwogICAg
ICAgIH0KCi0gICAgICAgaWYgKChjaGFuZ2VkICYgTkVUSUZfRl9IV19WTEFOX0NUQUdfRklMVEVS
KSAmJgorICAgICAgIGlmICgoY2hhbmdlZFswXSAmIE5FVElGX0ZfSFdfVkxBTl9DVEFHX0ZJTFRF
UikgJiYKICAgICAgICAgICAgaC0+YWVfYWxnby0+b3BzLT5lbmFibGVfdmxhbl9maWx0ZXIpIHsK
LSAgICAgICAgICAgICAgIGVuYWJsZSA9ICEhKGZlYXR1cmVzICYgTkVUSUZfRl9IV19WTEFOX0NU
QUdfRklMVEVSKTsKKyAgICAgICAgICAgICAgIGVuYWJsZSA9ICEhKGZlYXR1cmVzWzBdICYgTkVU
SUZfRl9IV19WTEFOX0NUQUdfRklMVEVSKTsKICAgICAgICAgICAgICAgIHJldCA9IGgtPmFlX2Fs
Z28tPm9wcy0+ZW5hYmxlX3ZsYW5fZmlsdGVyKGgsIGVuYWJsZSk7CiAgICAgICAgICAgICAgICBp
ZiAocmV0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0KCi0g
ICAgICAgbmV0ZGV2LT5mZWF0dXJlcyA9IGZlYXR1cmVzOworICAgICAgIG5ldGRldl9mZWF0dXJl
c19jb3B5KG5ldGRldi0+ZmVhdHVyZXMsIGZlYXR1cmVzKTsKICAgICAgICByZXR1cm4gMDsKIH0K
Ci1zdGF0aWMgbmV0ZGV2X2ZlYXR1cmVzX3QgaG5zM19mZWF0dXJlc19jaGVjayhzdHJ1Y3Qgc2tf
YnVmZiAqc2tiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlcykKK3N0YXRpYyB2b2lkIGhuczNf
ZmVhdHVyZXNfY2hlY2soc3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0IG5ldF9kZXZpY2UgKmRl
diwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCAqZmVh
dHVyZXMpCiB7CiAjZGVmaW5lIEhOUzNfTUFYX0hEUl9MRU4gICAgICAgNDgwVQogI2RlZmluZSBI
TlMzX01BWF9MNF9IRFJfTEVOICAgIDYwVQpAQCAtMjM3Myw5ICsyMzc0LDcgQEAgc3RhdGljIG5l
dGRldl9mZWF0dXJlc190CmhuczNfZmVhdHVyZXNfY2hlY2soc3RydWN0IHNrX2J1ZmYgKnNrYiwK
ICAgICAgICAgKiBsZW4gb2YgNDgwIGJ5dGVzLgogICAgICAgICAqLwogICAgICAgIGlmIChsZW4g
PiBITlMzX01BWF9IRFJfTEVOKQotICAgICAgICAgICAgICAgZmVhdHVyZXMgJj0gfihORVRJRl9G
X0NTVU1fTUFTSyB8IE5FVElGX0ZfR1NPX01BU0spOwotCi0gICAgICAgcmV0dXJuIGZlYXR1cmVz
OworICAgICAgICAgICAgICAgZmVhdHVyZXNbMF0gJj0gfihORVRJRl9GX0NTVU1fTUFTSyB8IE5F
VElGX0ZfR1NPX01BU0spOwogfQoKIHN0YXRpYyB2b2lkIGhuczNfbmljX2dldF9zdGF0czY0KHN0
cnVjdCBuZXRfZGV2aWNlICpuZXRkZXYsCkBAIC0zMTI3LDI3ICszMTI2LDI4IEBAIHN0YXRpYyB2
b2lkIGhuczNfc2V0X2RlZmF1bHRfZmVhdHVyZShzdHJ1Y3QKbmV0X2RldmljZSAqbmV0ZGV2KQoK
ICAgICAgICBuZXRkZXYtPnByaXZfZmxhZ3MgfD0gSUZGX1VOSUNBU1RfRkxUOwoKLSAgICAgICBu
ZXRkZXYtPmh3X2VuY19mZWF0dXJlcyB8PSBORVRJRl9GX1JYQ1NVTSB8IE5FVElGX0ZfU0cgfCBO
RVRJRl9GX0dTTyB8CisgICAgICAgbmV0ZGV2LT5od19lbmNfZmVhdHVyZXNbMF0gfD0KKyAgICAg
ICAgICAgICAgIE5FVElGX0ZfUlhDU1VNIHwgTkVUSUZfRl9TRyB8IE5FVElGX0ZfR1NPIHwKICAg
ICAgICAgICAgICAgIE5FVElGX0ZfR1JPIHwgTkVUSUZfRl9UU08gfCBORVRJRl9GX1RTTzYgfCBO
RVRJRl9GX0dTT19HUkUgfAogICAgICAgICAgICAgICAgTkVUSUZfRl9HU09fR1JFX0NTVU0gfCBO
RVRJRl9GX0dTT19VRFBfVFVOTkVMIHwKICAgICAgICAgICAgICAgIE5FVElGX0ZfU0NUUF9DUkMg
fCBORVRJRl9GX1RTT19NQU5HTEVJRCB8IE5FVElGX0ZfRlJBR0xJU1Q7CgogICAgICAgIG5ldGRl
di0+Z3NvX3BhcnRpYWxfZmVhdHVyZXMgfD0gTkVUSUZfRl9HU09fR1JFX0NTVU07CgotICAgICAg
IG5ldGRldi0+ZmVhdHVyZXMgfD0gTkVUSUZfRl9IV19WTEFOX0NUQUdfRklMVEVSIHwKKyAgICAg
ICBuZXRkZXYtPmZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfSFdfVkxBTl9DVEFHX0ZJTFRFUiB8CiAg
ICAgICAgICAgICAgICBORVRJRl9GX0hXX1ZMQU5fQ1RBR19UWCB8IE5FVElGX0ZfSFdfVkxBTl9D
VEFHX1JYIHwKICAgICAgICAgICAgICAgIE5FVElGX0ZfUlhDU1VNIHwgTkVUSUZfRl9TRyB8IE5F
VElGX0ZfR1NPIHwKICAgICAgICAgICAgICAgIE5FVElGX0ZfR1JPIHwgTkVUSUZfRl9UU08gfCBO
RVRJRl9GX1RTTzYgfCBORVRJRl9GX0dTT19HUkUgfAogICAgICAgICAgICAgICAgTkVUSUZfRl9H
U09fR1JFX0NTVU0gfCBORVRJRl9GX0dTT19VRFBfVFVOTkVMIHwKICAgICAgICAgICAgICAgIE5F
VElGX0ZfU0NUUF9DUkMgfCBORVRJRl9GX0ZSQUdMSVNUOwoKLSAgICAgICBuZXRkZXYtPnZsYW5f
ZmVhdHVyZXMgfD0gTkVUSUZfRl9SWENTVU0gfAorICAgICAgIG5ldGRldi0+dmxhbl9mZWF0dXJl
c1swXSB8PSBORVRJRl9GX1JYQ1NVTSB8CiAgICAgICAgICAgICAgICBORVRJRl9GX1NHIHwgTkVU
SUZfRl9HU08gfCBORVRJRl9GX0dSTyB8CiAgICAgICAgICAgICAgICBORVRJRl9GX1RTTyB8IE5F
VElGX0ZfVFNPNiB8IE5FVElGX0ZfR1NPX0dSRSB8CiAgICAgICAgICAgICAgICBORVRJRl9GX0dT
T19HUkVfQ1NVTSB8IE5FVElGX0ZfR1NPX1VEUF9UVU5ORUwgfAogICAgICAgICAgICAgICAgTkVU
SUZfRl9TQ1RQX0NSQyB8IE5FVElGX0ZfRlJBR0xJU1Q7CgotICAgICAgIG5ldGRldi0+aHdfZmVh
dHVyZXMgfD0gTkVUSUZfRl9IV19WTEFOX0NUQUdfVFggfAorICAgICAgIG5ldGRldi0+aHdfZmVh
dHVyZXNbMF0gfD0gTkVUSUZfRl9IV19WTEFOX0NUQUdfVFggfAogICAgICAgICAgICAgICAgTkVU
SUZfRl9IV19WTEFOX0NUQUdfUlggfAogICAgICAgICAgICAgICAgTkVUSUZfRl9SWENTVU0gfCBO
RVRJRl9GX1NHIHwgTkVUSUZfRl9HU08gfAogICAgICAgICAgICAgICAgTkVUSUZfRl9HUk8gfCBO
RVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNiB8IE5FVElGX0ZfR1NPX0dSRSB8CkBAIC0zMTU1LDQ4
ICszMTU1LDQ5IEBAIHN0YXRpYyB2b2lkIGhuczNfc2V0X2RlZmF1bHRfZmVhdHVyZShzdHJ1Y3QK
bmV0X2RldmljZSAqbmV0ZGV2KQogICAgICAgICAgICAgICAgTkVUSUZfRl9TQ1RQX0NSQyB8IE5F
VElGX0ZfRlJBR0xJU1Q7CgogICAgICAgIGlmIChhZV9kZXYtPmRldl92ZXJzaW9uID49IEhOQUUz
X0RFVklDRV9WRVJTSU9OX1YyKSB7Ci0gICAgICAgICAgICAgICBuZXRkZXYtPmh3X2ZlYXR1cmVz
IHw9IE5FVElGX0ZfR1JPX0hXOwotICAgICAgICAgICAgICAgbmV0ZGV2LT5mZWF0dXJlcyB8PSBO
RVRJRl9GX0dST19IVzsKKyAgICAgICAgICAgICAgIG5ldGRldi0+aHdfZmVhdHVyZXNbMF0gfD0g
TkVUSUZfRl9HUk9fSFc7CisgICAgICAgICAgICAgICBuZXRkZXYtPmZlYXR1cmVzWzBdIHw9IE5F
VElGX0ZfR1JPX0hXOwoKICAgICAgICAgICAgICAgIGlmICghKGgtPmZsYWdzICYgSE5BRTNfU1VQ
UE9SVF9WRikpIHsKLSAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2LT5od19mZWF0dXJlcyB8
PSBORVRJRl9GX05UVVBMRTsKLSAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2LT5mZWF0dXJl
cyB8PSBORVRJRl9GX05UVVBMRTsKKyAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2LT5od19m
ZWF0dXJlc1swXSB8PSBORVRJRl9GX05UVVBMRTsKKyAgICAgICAgICAgICAgICAgICAgICAgbmV0
ZGV2LT5mZWF0dXJlc1swXSB8PSBORVRJRl9GX05UVVBMRTsKICAgICAgICAgICAgICAgIH0KICAg
ICAgICB9CgogICAgICAgIGlmICh0ZXN0X2JpdChITkFFM19ERVZfU1VQUE9SVF9VRFBfR1NPX0Is
IGFlX2Rldi0+Y2FwcykpIHsKLSAgICAgICAgICAgICAgIG5ldGRldi0+aHdfZmVhdHVyZXMgfD0g
TkVUSUZfRl9HU09fVURQX0w0OwotICAgICAgICAgICAgICAgbmV0ZGV2LT5mZWF0dXJlcyB8PSBO
RVRJRl9GX0dTT19VRFBfTDQ7Ci0gICAgICAgICAgICAgICBuZXRkZXYtPnZsYW5fZmVhdHVyZXMg
fD0gTkVUSUZfRl9HU09fVURQX0w0OwotICAgICAgICAgICAgICAgbmV0ZGV2LT5od19lbmNfZmVh
dHVyZXMgfD0gTkVUSUZfRl9HU09fVURQX0w0OworICAgICAgICAgICAgICAgbmV0ZGV2LT5od19m
ZWF0dXJlc1swXSB8PSBORVRJRl9GX0dTT19VRFBfTDQ7CisgICAgICAgICAgICAgICBuZXRkZXYt
PmZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfR1NPX1VEUF9MNDsKKyAgICAgICAgICAgICAgIG5ldGRl
di0+dmxhbl9mZWF0dXJlc1swXSB8PSBORVRJRl9GX0dTT19VRFBfTDQ7CisgICAgICAgICAgICAg
ICBuZXRkZXYtPmh3X2VuY19mZWF0dXJlc1swXSB8PSBORVRJRl9GX0dTT19VRFBfTDQ7CiAgICAg
ICAgfQoKICAgICAgICBpZiAodGVzdF9iaXQoSE5BRTNfREVWX1NVUFBPUlRfSFdfVFhfQ1NVTV9C
LCBhZV9kZXYtPmNhcHMpKSB7Ci0gICAgICAgICAgICAgICBuZXRkZXYtPmh3X2ZlYXR1cmVzIHw9
IE5FVElGX0ZfSFdfQ1NVTTsKLSAgICAgICAgICAgICAgIG5ldGRldi0+ZmVhdHVyZXMgfD0gTkVU
SUZfRl9IV19DU1VNOwotICAgICAgICAgICAgICAgbmV0ZGV2LT52bGFuX2ZlYXR1cmVzIHw9IE5F
VElGX0ZfSFdfQ1NVTTsKLSAgICAgICAgICAgICAgIG5ldGRldi0+aHdfZW5jX2ZlYXR1cmVzIHw9
IE5FVElGX0ZfSFdfQ1NVTTsKKyAgICAgICAgICAgICAgIG5ldGRldi0+aHdfZmVhdHVyZXNbMF0g
fD0gTkVUSUZfRl9IV19DU1VNOworICAgICAgICAgICAgICAgbmV0ZGV2LT5mZWF0dXJlc1swXSB8
PSBORVRJRl9GX0hXX0NTVU07CisgICAgICAgICAgICAgICBuZXRkZXYtPnZsYW5fZmVhdHVyZXNb
MF0gfD0gTkVUSUZfRl9IV19DU1VNOworICAgICAgICAgICAgICAgbmV0ZGV2LT5od19lbmNfZmVh
dHVyZXNbMF0gfD0gTkVUSUZfRl9IV19DU1VNOwogICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAg
ICAgICBuZXRkZXYtPmh3X2ZlYXR1cmVzIHw9IE5FVElGX0ZfSVBfQ1NVTSB8IE5FVElGX0ZfSVBW
Nl9DU1VNOwotICAgICAgICAgICAgICAgbmV0ZGV2LT5mZWF0dXJlcyB8PSBORVRJRl9GX0lQX0NT
VU0gfCBORVRJRl9GX0lQVjZfQ1NVTTsKLSAgICAgICAgICAgICAgIG5ldGRldi0+dmxhbl9mZWF0
dXJlcyB8PSBORVRJRl9GX0lQX0NTVU0gfCBORVRJRl9GX0lQVjZfQ1NVTTsKLSAgICAgICAgICAg
ICAgIG5ldGRldi0+aHdfZW5jX2ZlYXR1cmVzIHw9IE5FVElGX0ZfSVBfQ1NVTSB8IE5FVElGX0Zf
SVBWNl9DU1VNOworICAgICAgICAgICAgICAgbmV0ZGV2LT5od19mZWF0dXJlc1swXSB8PSBORVRJ
Rl9GX0lQX0NTVU0gfCBORVRJRl9GX0lQVjZfQ1NVTTsKKyAgICAgICAgICAgICAgIG5ldGRldi0+
ZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9JUF9DU1VNIHwgTkVUSUZfRl9JUFY2X0NTVU07CisgICAg
ICAgICAgICAgICBuZXRkZXYtPnZsYW5fZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9JUF9DU1VNIHwg
TkVUSUZfRl9JUFY2X0NTVU07CisgICAgICAgICAgICAgICBuZXRkZXYtPmh3X2VuY19mZWF0dXJl
c1swXSB8PQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTkVUSUZfRl9J
UF9DU1VNIHwgTkVUSUZfRl9JUFY2X0NTVU07CiAgICAgICAgfQoKICAgICAgICBpZiAodGVzdF9i
aXQoSE5BRTNfREVWX1NVUFBPUlRfVURQX1RVTk5FTF9DU1VNX0IsIGFlX2Rldi0+Y2FwcykpIHsK
LSAgICAgICAgICAgICAgIG5ldGRldi0+aHdfZmVhdHVyZXMgfD0gTkVUSUZfRl9HU09fVURQX1RV
Tk5FTF9DU1VNOwotICAgICAgICAgICAgICAgbmV0ZGV2LT5mZWF0dXJlcyB8PSBORVRJRl9GX0dT
T19VRFBfVFVOTkVMX0NTVU07Ci0gICAgICAgICAgICAgICBuZXRkZXYtPnZsYW5fZmVhdHVyZXMg
fD0gTkVUSUZfRl9HU09fVURQX1RVTk5FTF9DU1VNOwotICAgICAgICAgICAgICAgbmV0ZGV2LT5o
d19lbmNfZmVhdHVyZXMgfD0gTkVUSUZfRl9HU09fVURQX1RVTk5FTF9DU1VNOworICAgICAgICAg
ICAgICAgbmV0ZGV2LT5od19mZWF0dXJlc1swXSB8PSBORVRJRl9GX0dTT19VRFBfVFVOTkVMX0NT
VU07CisgICAgICAgICAgICAgICBuZXRkZXYtPmZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfR1NPX1VE
UF9UVU5ORUxfQ1NVTTsKKyAgICAgICAgICAgICAgIG5ldGRldi0+dmxhbl9mZWF0dXJlc1swXSB8
PSBORVRJRl9GX0dTT19VRFBfVFVOTkVMX0NTVU07CisgICAgICAgICAgICAgICBuZXRkZXYtPmh3
X2VuY19mZWF0dXJlc1swXSB8PSBORVRJRl9GX0dTT19VRFBfVFVOTkVMX0NTVU07CiAgICAgICAg
fQoKICAgICAgICBpZiAodGVzdF9iaXQoSE5BRTNfREVWX1NVUFBPUlRfRkRfRk9SV0FSRF9UQ19C
LCBhZV9kZXYtPmNhcHMpKSB7Ci0gICAgICAgICAgICAgICBuZXRkZXYtPmh3X2ZlYXR1cmVzIHw9
IE5FVElGX0ZfSFdfVEM7Ci0gICAgICAgICAgICAgICBuZXRkZXYtPmZlYXR1cmVzIHw9IE5FVElG
X0ZfSFdfVEM7CisgICAgICAgICAgICAgICBuZXRkZXYtPmh3X2ZlYXR1cmVzWzBdIHw9IE5FVElG
X0ZfSFdfVEM7CisgICAgICAgICAgICAgICBuZXRkZXYtPmZlYXR1cmVzWzBdIHw9IE5FVElGX0Zf
SFdfVEM7CiAgICAgICAgfQoKICAgICAgICBpZiAodGVzdF9iaXQoSE5BRTNfREVWX1NVUFBPUlRf
VkxBTl9GTFRSX01ERl9CLCBhZV9kZXYtPmNhcHMpKQotICAgICAgICAgICAgICAgbmV0ZGV2LT5o
d19mZWF0dXJlcyB8PSBORVRJRl9GX0hXX1ZMQU5fQ1RBR19GSUxURVI7CisgICAgICAgICAgICAg
ICBuZXRkZXYtPmh3X2ZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfSFdfVkxBTl9DVEFHX0ZJTFRFUjsK
IH0KCiBzdGF0aWMgaW50IGhuczNfYWxsb2NfYnVmZmVyKHN0cnVjdCBobnMzX2VuZXRfcmluZyAq
cmluZywKQEAgLTM3MjcsNyArMzcyOCw3IEBAIHN0YXRpYyB2b2lkIGhuczNfcnhfY2hlY2tzdW0o
c3RydWN0CmhuczNfZW5ldF9yaW5nICpyaW5nLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAoKICAgICAg
ICBza2JfY2hlY2tzdW1fbm9uZV9hc3NlcnQoc2tiKTsKCi0gICAgICAgaWYgKCEobmV0ZGV2LT5m
ZWF0dXJlcyAmIE5FVElGX0ZfUlhDU1VNKSkKKyAgICAgICBpZiAoIShuZXRkZXYtPmZlYXR1cmVz
WzBdICYgTkVUSUZfRl9SWENTVU0pKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBp
ZiAodGVzdF9iaXQoSE5TM19OSUNfU1RBVEVfUlhEX0FEVl9MQVlPVVRfRU5BQkxFLCAmcHJpdi0+
c3RhdGUpKQpAQCAtNDAyNCw3ICs0MDI1LDcgQEAgc3RhdGljIGludCBobnMzX2hhbmRsZV9iZGlu
Zm8oc3RydWN0CmhuczNfZW5ldF9yaW5nICpyaW5nLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiKQogICAg
ICAgICAqIG90X3ZsYW5fdGFnIGluIHR3byBsYXllciB0YWcgY2FzZSwgYW5kIHN0b3JlZCBhdCB2
bGFuX3RhZwogICAgICAgICAqIGluIG9uZSBsYXllciB0YWcgY2FzZS4KICAgICAgICAgKi8KLSAg
ICAgICBpZiAobmV0ZGV2LT5mZWF0dXJlcyAmIE5FVElGX0ZfSFdfVkxBTl9DVEFHX1JYKSB7Cisg
ICAgICAgaWYgKG5ldGRldi0+ZmVhdHVyZXNbMF0gJiBORVRJRl9GX0hXX1ZMQU5fQ1RBR19SWCkg
ewogICAgICAgICAgICAgICAgdTE2IHZsYW5fdGFnOwoKICAgICAgICAgICAgICAgIGlmIChobnMz
X3BhcnNlX3ZsYW5fdGFnKHJpbmcsIGRlc2MsIGwyMzRpbmZvLCAmdmxhbl90YWcpKQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvaHVhd2VpL2hpbmljL2hpbmljX21haW4uYwpiL2Ry
aXZlcnMvbmV0L2V0aGVybmV0L2h1YXdlaS9oaW5pYy9oaW5pY19tYWluLmMKaW5kZXggNDA1ZWU0
ZC4uYjE5M2VlNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvaHVhd2VpL2hpbmlj
L2hpbmljX21haW4uYworKysgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9odWF3ZWkvaGluaWMvaGlu
aWNfbWFpbi5jCkBAIC03OSw4ICs3OSw4IEBAIE1PRFVMRV9QQVJNX0RFU0Mocnhfd2VpZ2h0LCAi
TnVtYmVyIFJ4IHBhY2tldHMgZm9yCk5BUEkgYnVkZ2V0IChkZWZhdWx0PTY0KSIpOwogc3RhdGlj
IGludCBjaGFuZ2VfbWFjX2FkZHIoc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRldiwgY29uc3QgdTgg
KmFkZHIpOwoKIHN0YXRpYyBpbnQgc2V0X2ZlYXR1cmVzKHN0cnVjdCBoaW5pY19kZXYgKm5pY19k
ZXYsCi0gICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190IHByZV9mZWF0dXJl
cywKLSAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVhdHVyZXMsIGJv
b2wgZm9yY2VfY2hhbmdlKTsKKyAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVz
X3QgKnByZV9mZWF0dXJlcywKKyAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVz
X3QgKmZlYXR1cmVzLCBib29sIGZvcmNlX2NoYW5nZSk7Cgogc3RhdGljIHZvaWQgdXBkYXRlX3J4
X3N0YXRzKHN0cnVjdCBoaW5pY19kZXYgKm5pY19kZXYsIHN0cnVjdCBoaW5pY19yeHEgKnJ4cSkK
IHsKQEAgLTg4MCw3ICs4ODAsNyBAQCBzdGF0aWMgdm9pZCBoaW5pY19nZXRfc3RhdHM2NChzdHJ1
Y3QgbmV0X2RldmljZSAqbmV0ZGV2LAogfQoKIHN0YXRpYyBpbnQgaGluaWNfc2V0X2ZlYXR1cmVz
KHN0cnVjdCBuZXRfZGV2aWNlICpuZXRkZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVzKQorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBuZXRkZXZfZmVhdHVyZXNfdCAqZmVhdHVyZXMpCiB7CiAgICAgICAgc3RydWN0IGhpbmljX2Rl
diAqbmljX2RldiA9IG5ldGRldl9wcml2KG5ldGRldik7CgpAQCAtODg4LDE4ICs4ODgsMTYgQEAg
c3RhdGljIGludCBoaW5pY19zZXRfZmVhdHVyZXMoc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRldiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzLCBmYWxzZSk7CiB9Cgotc3RhdGlj
IG5ldGRldl9mZWF0dXJlc190IGhpbmljX2ZpeF9mZWF0dXJlcyhzdHJ1Y3QgbmV0X2RldmljZSAq
bmV0ZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRl
dl9mZWF0dXJlc190IGZlYXR1cmVzKQorc3RhdGljIHZvaWQgaGluaWNfZml4X2ZlYXR1cmVzKHN0
cnVjdCBuZXRfZGV2aWNlICpuZXRkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBu
ZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlcykKIHsKICAgICAgICBzdHJ1Y3QgaGluaWNfZGV2ICpu
aWNfZGV2ID0gbmV0ZGV2X3ByaXYobmV0ZGV2KTsKCiAgICAgICAgLyogSWYgUnggY2hlY2tzdW0g
aXMgZGlzYWJsZWQsIHRoZW4gTFJPIHNob3VsZCBhbHNvIGJlIGRpc2FibGVkICovCi0gICAgICAg
aWYgKCEoZmVhdHVyZXMgJiBORVRJRl9GX1JYQ1NVTSkpIHsKKyAgICAgICBpZiAoIShmZWF0dXJl
c1swXSAmIE5FVElGX0ZfUlhDU1VNKSkgewogICAgICAgICAgICAgICAgbmV0aWZfaW5mbyhuaWNf
ZGV2LCBkcnYsIG5ldGRldiwgImRpc2FibGluZyBMUk8gYXMKUlhDU1VNIGlzIG9mZlxuIik7Ci0g
ICAgICAgICAgICAgICBmZWF0dXJlcyAmPSB+TkVUSUZfRl9MUk87CisgICAgICAgICAgICAgICBm
ZWF0dXJlc1swXSAmPSB+TkVUSUZfRl9MUk87CiAgICAgICAgfQotCi0gICAgICAgcmV0dXJuIGZl
YXR1cmVzOwogfQoKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbmV0X2RldmljZV9vcHMgaGluaWNfbmV0
ZGV2X29wcyA9IHsKQEAgLTk0MywxOSArOTQxLDIyIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbmV0
X2RldmljZV9vcHMgaGluaWN2Zl9uZXRkZXZfb3BzID0gewoKIHN0YXRpYyB2b2lkIG5ldGRldl9m
ZWF0dXJlc19pbml0KHN0cnVjdCBuZXRfZGV2aWNlICpuZXRkZXYpCiB7Ci0gICAgICAgbmV0ZGV2
LT5od19mZWF0dXJlcyA9IE5FVElGX0ZfU0cgfCBORVRJRl9GX0hJR0hETUEgfCBORVRJRl9GX0lQ
X0NTVU0gfAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBORVRJRl9GX0lQVjZfQ1NVTSB8
IE5FVElGX0ZfVFNPIHwgTkVUSUZfRl9UU082IHwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgTkVUSUZfRl9SWENTVU0gfCBORVRJRl9GX0xSTyB8Ci0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIE5FVElGX0ZfSFdfVkxBTl9DVEFHX1RYIHwKTkVUSUZfRl9IV19WTEFOX0NUQUdfUlgg
fAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBORVRJRl9GX0dTT19VRFBfVFVOTkVMIHwK
TkVUSUZfRl9HU09fVURQX1RVTk5FTF9DU1VNOwotCi0gICAgICAgbmV0ZGV2LT52bGFuX2ZlYXR1
cmVzID0gbmV0ZGV2LT5od19mZWF0dXJlczsKLQotICAgICAgIG5ldGRldi0+ZmVhdHVyZXMgPSBu
ZXRkZXYtPmh3X2ZlYXR1cmVzIHwgTkVUSUZfRl9IV19WTEFOX0NUQUdfRklMVEVSOwotCi0gICAg
ICAgbmV0ZGV2LT5od19lbmNfZmVhdHVyZXMgPSBORVRJRl9GX0lQX0NTVU0gfCBORVRJRl9GX0lQ
VjZfQ1NVTQp8IE5FVElGX0ZfU0NUUF9DUkMgfAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgTkVUSUZfRl9TRyB8IE5FVElGX0ZfVFNPIHwKTkVUSUZfRl9UU082IHwgTkVUSUZfRl9U
U09fRUNOIHwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5FVElGX0ZfR1NPX1VE
UF9UVU5ORUxfQ1NVTSB8Ck5FVElGX0ZfR1NPX1VEUF9UVU5ORUw7CisgICAgICAgbmV0ZGV2LT5o
d19mZWF0dXJlc1swXSA9CisgICAgICAgICAgICAgICAgICAgICAgIE5FVElGX0ZfU0cgfCBORVRJ
Rl9GX0hJR0hETUEgfCBORVRJRl9GX0lQX0NTVU0gfAorICAgICAgICAgICAgICAgICAgICAgICBO
RVRJRl9GX0lQVjZfQ1NVTSB8IE5FVElGX0ZfVFNPIHwgTkVUSUZfRl9UU082IHwKKyAgICAgICAg
ICAgICAgICAgICAgICAgTkVUSUZfRl9SWENTVU0gfCBORVRJRl9GX0xSTyB8CisgICAgICAgICAg
ICAgICAgICAgICAgIE5FVElGX0ZfSFdfVkxBTl9DVEFHX1RYIHwgTkVUSUZfRl9IV19WTEFOX0NU
QUdfUlggfAorICAgICAgICAgICAgICAgICAgICAgICBORVRJRl9GX0dTT19VRFBfVFVOTkVMIHwg
TkVUSUZfRl9HU09fVURQX1RVTk5FTF9DU1VNOworCisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2Nv
cHkobmV0ZGV2LT52bGFuX2ZlYXR1cmVzLCBuZXRkZXYtPmh3X2ZlYXR1cmVzKTsKKworICAgICAg
IG5ldGRldi0+ZmVhdHVyZXNbMF0gPQorICAgICAgICAgICAgICAgICAgICAgICBuZXRkZXYtPmh3
X2ZlYXR1cmVzWzBdIHwgTkVUSUZfRl9IV19WTEFOX0NUQUdfRklMVEVSOworCisgICAgICAgbmV0
ZGV2LT5od19lbmNfZmVhdHVyZXNbMF0gPQorICAgICAgICAgICAgICAgTkVUSUZfRl9JUF9DU1VN
IHwgTkVUSUZfRl9JUFY2X0NTVU0gfCBORVRJRl9GX1NDVFBfQ1JDIHwKKyAgICAgICAgICAgICAg
IE5FVElGX0ZfU0cgfCBORVRJRl9GX1RTTyB8IE5FVElGX0ZfVFNPNiB8IE5FVElGX0ZfVFNPX0VD
TiB8CisgICAgICAgICAgICAgICBORVRJRl9GX0dTT19VRFBfVFVOTkVMX0NTVU0gfCBORVRJRl9G
X0dTT19VRFBfVFVOTkVMOwogfQoKIHN0YXRpYyB2b2lkIGhpbmljX3JlZnJlc2hfbmljX2NmZyhz
dHJ1Y3QgaGluaWNfZGV2ICpuaWNfZGV2KQpAQCAtMTA3MiwyMSArMTA3MywyMiBAQCBzdGF0aWMg
dm9pZCBsaW5rX2Vycl9ldmVudCh2b2lkICpoYW5kbGUsCiB9Cgogc3RhdGljIGludCBzZXRfZmVh
dHVyZXMoc3RydWN0IGhpbmljX2RldiAqbmljX2RldiwKLSAgICAgICAgICAgICAgICAgICAgICAg
bmV0ZGV2X2ZlYXR1cmVzX3QgcHJlX2ZlYXR1cmVzLAotICAgICAgICAgICAgICAgICAgICAgICBu
ZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlcywgYm9vbCBmb3JjZV9jaGFuZ2UpCisgICAgICAgICAg
ICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190ICpwcmVfZmVhdHVyZXMsCisgICAgICAgICAg
ICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190ICpmZWF0dXJlcywgYm9vbCBmb3JjZV9jaGFu
Z2UpCiB7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgY2hhbmdlZCA9IGZvcmNlX2NoYW5nZSA/
IH4wIDogcHJlX2ZlYXR1cmVzIF4gZmVhdHVyZXM7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3Qg
ZmFpbGVkX2ZlYXR1cmVzW05FVERFVl9GRUFUVVJFX0RXT1JEU10gPSB7MH07CiAgICAgICAgdTMy
IGNzdW1fZW4gPSBISU5JQ19SWF9DU1VNX09GRkxPQURfRU47Ci0gICAgICAgbmV0ZGV2X2ZlYXR1
cmVzX3QgZmFpbGVkX2ZlYXR1cmVzID0gMDsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBjaGFu
Z2VkOwogICAgICAgIGludCByZXQgPSAwOwogICAgICAgIGludCBlcnIgPSAwOwoKKyAgICAgICBj
aGFuZ2VkID0gZm9yY2VfY2hhbmdlID8gfjAgOiBwcmVfZmVhdHVyZXNbMF0gXiBmZWF0dXJlc1sw
XTsKICAgICAgICBpZiAoY2hhbmdlZCAmIE5FVElGX0ZfVFNPKSB7Ci0gICAgICAgICAgICAgICBy
ZXQgPSBoaW5pY19wb3J0X3NldF90c28obmljX2RldiwgKGZlYXR1cmVzICYgTkVUSUZfRl9UU08p
ID8KKyAgICAgICAgICAgICAgIHJldCA9IGhpbmljX3BvcnRfc2V0X3RzbyhuaWNfZGV2LCAoZmVh
dHVyZXNbMF0gJiBORVRJRl9GX1RTTykgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEhJTklDX1RTT19FTkFCTEUgOiBISU5JQ19UU09fRElTQUJMRSk7CiAgICAgICAg
ICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IHJldDsKLSAg
ICAgICAgICAgICAgICAgICAgICAgZmFpbGVkX2ZlYXR1cmVzIHw9IE5FVElGX0ZfVFNPOworICAg
ICAgICAgICAgICAgICAgICAgICBmYWlsZWRfZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9UU087CiAg
ICAgICAgICAgICAgICB9CiAgICAgICAgfQoKQEAgLTEwOTQsMzMgKzEwOTYsMzQgQEAgc3RhdGlj
IGludCBzZXRfZmVhdHVyZXMoc3RydWN0IGhpbmljX2RldiAqbmljX2RldiwKICAgICAgICAgICAg
ICAgIHJldCA9IGhpbmljX3NldF9yeF9jc3VtX29mZmxvYWQobmljX2RldiwgY3N1bV9lbik7CiAg
ICAgICAgICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IHJl
dDsKLSAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkX2ZlYXR1cmVzIHw9IE5FVElGX0ZfUlhD
U1VNOworICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWRfZmVhdHVyZXNbMF0gfD0gTkVUSUZf
Rl9SWENTVU07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY2hhbmdl
ZCAmIE5FVElGX0ZfTFJPKSB7CiAgICAgICAgICAgICAgICByZXQgPSBoaW5pY19zZXRfcnhfbHJv
X3N0YXRlKG5pY19kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICEhKGZlYXR1cmVzICYgTkVUSUZfRl9MUk8pLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAhIShmZWF0dXJlc1swXSAmIE5FVElGX0ZfTFJPKSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSElOSUNfTFJPX1JYX1RJTUVS
X0RFRkFVTFQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhJ
TklDX0xST19NQVhfV1FFX05VTV9ERUZBVUxUKTsKICAgICAgICAgICAgICAgIGlmIChyZXQpIHsK
ICAgICAgICAgICAgICAgICAgICAgICAgZXJyID0gcmV0OwotICAgICAgICAgICAgICAgICAgICAg
ICBmYWlsZWRfZmVhdHVyZXMgfD0gTkVUSUZfRl9MUk87CisgICAgICAgICAgICAgICAgICAgICAg
IGZhaWxlZF9mZWF0dXJlc1swXSB8PSBORVRJRl9GX0xSTzsKICAgICAgICAgICAgICAgIH0KICAg
ICAgICB9CgogICAgICAgIGlmIChjaGFuZ2VkICYgTkVUSUZfRl9IV19WTEFOX0NUQUdfUlgpIHsK
ICAgICAgICAgICAgICAgIHJldCA9IGhpbmljX3NldF9yeF92bGFuX29mZmxvYWQobmljX2RldiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISEoZmVhdHVy
ZXMgJgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhIShm
ZWF0dXJlc1swXSAmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIE5FVElGX0ZfSFdfVkxBTl9DVEFHX1JYKSk7CiAgICAgICAgICAgICAgICBpZiAocmV0
KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IHJldDsKLSAgICAgICAgICAgICAgICAg
ICAgICAgZmFpbGVkX2ZlYXR1cmVzIHw9IE5FVElGX0ZfSFdfVkxBTl9DVEFHX1JYOworICAgICAg
ICAgICAgICAgICAgICAgICBmYWlsZWRfZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9IV19WTEFOX0NU
QUdfUlg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXJyKSB7Ci0g
ICAgICAgICAgICAgICBuaWNfZGV2LT5uZXRkZXYtPmZlYXR1cmVzID0gZmVhdHVyZXMgXiBmYWls
ZWRfZmVhdHVyZXM7CisgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfeG9yKG5pY19kZXYt
Pm5ldGRldi0+ZmVhdHVyZXMsIGZlYXR1cmVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBmYWlsZWRfZmVhdHVyZXMpCiAgICAgICAgICAgICAgICByZXR1cm4gLUVJTzsKICAg
ICAgICB9CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvaHVhd2VpL2hpbmljL2hp
bmljX3J4LmMKYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9odWF3ZWkvaGluaWMvaGluaWNfcnguYwpp
bmRleCBmZWQzYjZiLi40NTJhOTFiIDEwMDY0NAotLS0gYS9kcml2ZXJzL25ldC9ldGhlcm5ldC9o
dWF3ZWkvaGluaWMvaGluaWNfcnguYworKysgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9odWF3ZWkv
aGluaWMvaGluaWNfcnguYwpAQCAtMTA2LDcgKzEwNiw3IEBAIHN0YXRpYyB2b2lkIHJ4X2NzdW0o
c3RydWN0IGhpbmljX3J4cSAqcnhxLCB1MzIgc3RhdHVzLAoKICAgICAgICBjc3VtX2VyciA9IEhJ
TklDX1JRX0NRRV9TVEFUVVNfR0VUKHN0YXR1cywgQ1NVTV9FUlIpOwoKLSAgICAgICBpZiAoIShu
ZXRkZXYtPmZlYXR1cmVzICYgTkVUSUZfRl9SWENTVU0pKQorICAgICAgIGlmICghKG5ldGRldi0+
ZmVhdHVyZXNbMF0gJiBORVRJRl9GX1JYQ1NVTSkpCiAgICAgICAgICAgICAgICByZXR1cm47Cgog
ICAgICAgIGlmICghY3N1bV9lcnIpIHsKQEAgLTQxMSw3ICs0MTEsNyBAQCBzdGF0aWMgaW50IHJ4
cV9yZWN2KHN0cnVjdCBoaW5pY19yeHEgKnJ4cSwgaW50IGJ1ZGdldCkKCiAgICAgICAgICAgICAg
ICBvZmZsb2FkX3R5cGUgPSBiZTMyX3RvX2NwdShjcWUtPm9mZmxvYWRfdHlwZSk7CiAgICAgICAg
ICAgICAgICB2bGFuX2xlbiA9IGJlMzJfdG9fY3B1KGNxZS0+bGVuKTsKLSAgICAgICAgICAgICAg
IGlmICgobmV0ZGV2LT5mZWF0dXJlcyAmIE5FVElGX0ZfSFdfVkxBTl9DVEFHX1JYKSAmJgorICAg
ICAgICAgICAgICAgaWYgKChuZXRkZXYtPmZlYXR1cmVzWzBdICYgTkVUSUZfRl9IV19WTEFOX0NU
QUdfUlgpICYmCiAgICAgICAgICAgICAgICAgICAgSElOSUNfR0VUX1JYX1ZMQU5fT0ZGTE9BRF9F
TihvZmZsb2FkX3R5cGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZCA9IEhJTklDX0dF
VF9SWF9WTEFOX1RBRyh2bGFuX2xlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIF9fdmxhbl9o
d2FjY2VsX3B1dF90YWcoc2tiLCBodG9ucyhFVEhfUF84MDIxUSksIHZpZCk7CmRpZmYgLS1naXQg
YS9pbmNsdWRlL2xpbnV4L2lmX3ZsYW4uaCBiL2luY2x1ZGUvbGludXgvaWZfdmxhbi5oCmluZGV4
IDQxYTUxODMuLjQxNzM0NjQgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvaWZfdmxhbi5oCisr
KyBiL2luY2x1ZGUvbGludXgvaWZfdmxhbi5oCkBAIC01NjMsNyArNTYzLDcgQEAgc3RhdGljIGlu
bGluZSBpbnQgX192bGFuX2h3YWNjZWxfZ2V0X3RhZyhjb25zdApzdHJ1Y3Qgc2tfYnVmZiAqc2ti
LAogICovCiBzdGF0aWMgaW5saW5lIGludCB2bGFuX2dldF90YWcoY29uc3Qgc3RydWN0IHNrX2J1
ZmYgKnNrYiwgdTE2ICp2bGFuX3RjaSkKIHsKLSAgICAgICBpZiAoc2tiLT5kZXYtPmZlYXR1cmVz
ICYgTkVUSUZfRl9IV19WTEFOX0NUQUdfVFgpIHsKKyAgICAgICBpZiAoc2tiLT5kZXYtPmZlYXR1
cmVzWzBdICYgTkVUSUZfRl9IV19WTEFOX0NUQUdfVFgpIHsKICAgICAgICAgICAgICAgIHJldHVy
biBfX3ZsYW5faHdhY2NlbF9nZXRfdGFnKHNrYiwgdmxhbl90Y2kpOwogICAgICAgIH0gZWxzZSB7
CiAgICAgICAgICAgICAgICByZXR1cm4gX192bGFuX2dldF90YWcoc2tiLCB2bGFuX3RjaSk7CmRp
ZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L25ldGRldl9mZWF0dXJlcy5oIGIvaW5jbHVkZS9saW51
eC9uZXRkZXZfZmVhdHVyZXMuaAppbmRleCAyYzZiOWU0Li45MTg0OTYzIDEwMDY0NAotLS0gYS9p
bmNsdWRlL2xpbnV4L25ldGRldl9mZWF0dXJlcy5oCisrKyBiL2luY2x1ZGUvbGludXgvbmV0ZGV2
X2ZlYXR1cmVzLmgKQEAgLTEwMiw3ICsxMDIsOCBAQCBlbnVtIHsKIH07CgogLyogY29weSduJ3Bh
c3RlIGNvbXByZXNzaW9uIDspICovCi0jZGVmaW5lIF9fTkVUSUZfRl9CSVQoYml0KSAgICAgKChu
ZXRkZXZfZmVhdHVyZXNfdCkxIDw8IChiaXQpKQorI2RlZmluZSBfX05FVElGX0ZfQklUKGJpdCkg
ICAgICgobmV0ZGV2X2ZlYXR1cmVzX3QpMSA8PCAoYml0ICYgMHgzRikpCisKICNkZWZpbmUgX19O
RVRJRl9GKG5hbWUpICAgICAgICAgICAgICAgIF9fTkVUSUZfRl9CSVQoTkVUSUZfRl8jI25hbWUj
I19CSVQpCgogI2RlZmluZSBORVRJRl9GX0ZDT0VfQ1JDICAgICAgIF9fTkVUSUZfRihGQ09FX0NS
QykKQEAgLTE2OSw2ICsxNzAsOCBAQCBlbnVtIHsKICNkZWZpbmUgTkVUSUZfRl9IV19IU1JfRldE
ICAgICBfX05FVElGX0YoSFdfSFNSX0ZXRCkKICNkZWZpbmUgTkVUSUZfRl9IV19IU1JfRFVQICAg
ICBfX05FVElGX0YoSFdfSFNSX0RVUCkKCisjZGVmaW5lIE5FVERFVl9GRUFUVVJFX0RXT1JEUyAg
RElWX1JPVU5EX1VQKE5FVERFVl9GRUFUVVJFX0NPVU5ULCA2NCkKKwogLyogRmluZHMgdGhlIG5l
eHQgZmVhdHVyZSB3aXRoIHRoZSBoaWdoZXN0IG51bWJlciBvZiB0aGUgcmFuZ2Ugb2Ygc3RhcnQg
dGlsbCAwLgogICovCiBzdGF0aWMgaW5saW5lIGludCBmaW5kX25leHRfbmV0ZGV2X2ZlYXR1cmUo
dTY0IGZlYXR1cmUsIHVuc2lnbmVkIGxvbmcgc3RhcnQpCkBAIC0xODUsOCArMTg4LDcgQEAgc3Rh
dGljIGlubGluZSBpbnQgZmluZF9uZXh0X25ldGRldl9mZWF0dXJlKHU2NApmZWF0dXJlLCB1bnNp
Z25lZCBsb25nIHN0YXJ0KQogICogbWFza19hZGRyIHNob3VsZCBiZSBhIHU2NCBhbmQgYml0IGFu
IGludAogICovCiAjZGVmaW5lIGZvcl9lYWNoX25ldGRldl9mZWF0dXJlKG1hc2tfYWRkciwgYml0
KQogICAgICAgICBcCi0gICAgICAgZm9yICgoYml0KSA9IGZpbmRfbmV4dF9uZXRkZXZfZmVhdHVy
ZSgobWFza19hZGRyKSwgICAgICAgICAgICAgIFwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIE5FVERFVl9GRUFUVVJFX0NPVU5UKTsgICAgXAorICAgICAgIGZv
ciAoKGJpdCkgPSBmaW5kX25leHRfbmV0ZGV2X2ZlYXR1cmUoKG1hc2tfYWRkciksIDY0KTsgICAg
ICAgICBcCiAgICAgICAgICAgICAoYml0KSA+PSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFwKICAgICAgICAgICAgIChiaXQpID0gZmluZF9uZXh0X25l
dGRldl9mZWF0dXJlKChtYXNrX2FkZHIpLCAoYml0KSAtIDEpKQoKQEAgLTE5NSwxMSArMTk3LDYg
QEAgc3RhdGljIGlubGluZSBpbnQgZmluZF9uZXh0X25ldGRldl9mZWF0dXJlKHU2NApmZWF0dXJl
LCB1bnNpZ25lZCBsb25nIHN0YXJ0KQogI2RlZmluZSBORVRJRl9GX05FVkVSX0NIQU5HRSAgIChO
RVRJRl9GX1ZMQU5fQ0hBTExFTkdFRCB8IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgTkVUSUZfRl9MTFRYIHwgTkVUSUZfRl9ORVROU19MT0NBTCkKCi0vKiByZW1lbWJlciB0aGF0
ICgodCkxIDw8IHRfQklUUykgaXMgdW5kZWZpbmVkIGluIEM5OSAqLwotI2RlZmluZSBORVRJRl9G
X0VUSFRPT0xfQklUUyAgICgoX19ORVRJRl9GX0JJVChORVRERVZfRkVBVFVSRV9DT1VOVCAtIDEp
IHwgXAotICAgICAgICAgICAgICAgKF9fTkVUSUZfRl9CSVQoTkVUREVWX0ZFQVRVUkVfQ09VTlQg
LSAxKSAtIDEpKSAmIFwKLSAgICAgICAgICAgICAgIH5ORVRJRl9GX05FVkVSX0NIQU5HRSkKLQog
LyogU2VnbWVudGF0aW9uIG9mZmxvYWQgZmVhdHVyZSBtYXNrICovCiAjZGVmaW5lIE5FVElGX0Zf
R1NPX01BU0sgICAgICAgKF9fTkVUSUZfRl9CSVQoTkVUSUZfRl9HU09fTEFTVCArIDEpIC0gXAog
ICAgICAgICAgICAgICAgX19ORVRJRl9GX0JJVChORVRJRl9GX0dTT19TSElGVCkpCkBAIC0yNjEs
NCArMjU4LDk2IEBAIHN0YXRpYyBpbmxpbmUgaW50IGZpbmRfbmV4dF9uZXRkZXZfZmVhdHVyZSh1
NjQKZmVhdHVyZSwgdW5zaWduZWQgbG9uZyBzdGFydCkKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTkVUSUZfRl9HU09fVURQX1RVTk5FTCB8ICAgICAgICAgICAgICAgXAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBORVRJRl9GX0dTT19VRFBfVFVOTkVMX0NTVU0pCgor
c3RhdGljIGlubGluZSB2b2lkIG5ldGRldl9mZWF0dXJlc19jb3B5KG5ldGRldl9mZWF0dXJlc190
ICpkc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXRk
ZXZfZmVhdHVyZXNfdCAqc3JjKQoreworICAgICAgIHVuc2lnbmVkIGludCBpOworCisgICAgICAg
Zm9yIChpID0gMDsgaSA8IE5FVERFVl9GRUFUVVJFX0RXT1JEUzsgaSsrKQorICAgICAgICAgICAg
ICAgZHN0W2ldID0gc3JjW2ldOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgbmV0ZGV2X2ZlYXR1
cmVzX2FuZChuZXRkZXZfZmVhdHVyZXNfdCAqZHN0LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBjb25zdCBuZXRkZXZfZmVhdHVyZXNfdCAqYSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV0ZGV2X2ZlYXR1cmVzX3QgKmIpCit7Cisg
ICAgICAgdW5zaWduZWQgaW50IGk7CisKKyAgICAgICBmb3IgKGkgPSAwOyBpIDwgTkVUREVWX0ZF
QVRVUkVfRFdPUkRTOyBpKyspCisgICAgICAgICAgICAgICBkc3RbaV0gPSBhW2ldICYgYltpXTsK
K30KKworc3RhdGljIGlubGluZSB2b2lkIG5ldGRldl9mZWF0dXJlc19hbmRub3QobmV0ZGV2X2Zl
YXR1cmVzX3QgKmRzdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgbmV0ZGV2X2ZlYXR1cmVzX3QgKmEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnN0IG5ldGRldl9mZWF0dXJlc190ICpiKQoreworICAgICAgIHVuc2ln
bmVkIGludCBpOworCisgICAgICAgZm9yIChpID0gMDsgaSA8IE5FVERFVl9GRUFUVVJFX0RXT1JE
UzsgaSsrKQorICAgICAgICAgICAgICAgZHN0W2ldID0gYVtpXSAmIH5iW2ldOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQgbmV0ZGV2X2ZlYXR1cmVzX29yKG5ldGRldl9mZWF0dXJlc190ICpkc3Qs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV0ZGV2X2ZlYXR1
cmVzX3QgKmEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV0
ZGV2X2ZlYXR1cmVzX3QgKmIpCit7CisgICAgICAgdW5zaWduZWQgaW50IGk7CisKKyAgICAgICBm
b3IgKGkgPSAwOyBpIDwgTkVUREVWX0ZFQVRVUkVfRFdPUkRTOyBpKyspCisgICAgICAgICAgICAg
ICBkc3RbaV0gPSBhW2ldIHwgYltpXTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIG5ldGRldl9m
ZWF0dXJlc194b3IobmV0ZGV2X2ZlYXR1cmVzX3QgKmRzdCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgY29uc3QgbmV0ZGV2X2ZlYXR1cmVzX3QgKmEsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ldGRldl9mZWF0dXJlc190ICpiKQor
eworICAgICAgIHVuc2lnbmVkIGludCBpOworCisgICAgICAgZm9yIChpID0gMDsgaSA8IE5FVERF
Vl9GRUFUVVJFX0RXT1JEUzsgaSsrKQorICAgICAgICAgICAgICAgZHN0W2ldID0gYVtpXSBeIGJb
aV07Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBuZXRkZXZfZmVhdHVyZXNfc2V0KG5ldGRldl9m
ZWF0dXJlc190ICpkc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVu
c2lnbmVkIGludCBiaXQpCit7CisgICAgICAgZHN0W2JpdCAvIDY0XSB8PSBfX05FVElGX0ZfQklU
KGJpdCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBuZXRkZXZfZmVhdHVyZXNfZXF1YWwoY29u
c3QgbmV0ZGV2X2ZlYXR1cmVzX3QgKmEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29uc3QgbmV0ZGV2X2ZlYXR1cmVzX3QgKmIpCit7CisgICAgICAgdW5zaWduZWQg
aW50IGk7CisKKyAgICAgICBmb3IgKGkgPSAwOyBpIDwgTkVUREVWX0ZFQVRVUkVfRFdPUkRTOyBp
KyspCisgICAgICAgICAgICAgICBpZiAoYVtpXSAhPSBiW2ldKQorICAgICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gZmFsc2U7CisKKyAgICAgICByZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIGlu
bGluZSB2b2lkIG5ldGRldl9mZWF0dXJlc19lbXB0eShuZXRkZXZfZmVhdHVyZXNfdCAqc3JjKQor
eworICAgICAgIHVuc2lnbmVkIGludCBpOworCisgICAgICAgZm9yIChpID0gMDsgaSA8IE5FVERF
Vl9GRUFUVVJFX0RXT1JEUzsgaSsrKQorICAgICAgICAgICAgICAgaWYgKHNyY1tpXSkKKyAgICAg
ICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworCisgICAgICAgcmV0dXJuIHRydWU7Cit9
CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBuZXRkZXZfZmVhdHVyZXNfZXRodG9vbF9iaXRzKG5ldGRl
dl9mZWF0dXJlc190ICpkc3QpCit7CisgICAgICAgdW5zaWduZWQgaW50IGk7CisKKyAgICAgICBm
b3IgKGkgPSAwOyBpIDwgTkVUREVWX0ZFQVRVUkVfRFdPUkRTOyBpKyspIHsKKyAgICAgICAgICAg
ICAgIGlmIChORVRERVZfRkVBVFVSRV9DT1VOVCA+PSAoaSArIDEpICogNjQpCisgICAgICAgICAg
ICAgICAgICAgICAgIGRzdFtpXSA9IEdFTk1BU0tfVUxMKDYzLCAwKTsKKyAgICAgICAgICAgICAg
IGVsc2UKKyAgICAgICAgICAgICAgICAgICAgICAgZHN0W2ldID0gR0VOTUFTS19VTEwoTkVUREVW
X0ZFQVRVUkVfQ09VTlQgLSBpICogNjQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgMCk7CisgICAgICAgfQorICAgICAgIGRzdFswXSAmPSB+TkVUSUZf
Rl9ORVZFUl9DSEFOR0U7Cit9CisKICNlbmRpZiAvKiBfTElOVVhfTkVUREVWX0ZFQVRVUkVTX0gg
Ki8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvbmV0ZGV2aWNlLmggYi9pbmNsdWRlL2xpbnV4
L25ldGRldmljZS5oCmluZGV4IGVhZjViYjAuLjRhMjk0ODcgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
bGludXgvbmV0ZGV2aWNlLmgKKysrIGIvaW5jbHVkZS9saW51eC9uZXRkZXZpY2UuaApAQCAtMTM0
Nyw5ICsxMzQ3LDkgQEAgc3RydWN0IG5ldF9kZXZpY2Vfb3BzIHsKICAgICAgICBpbnQgICAgICAg
ICAgICAgICAgICAgICAoKm5kb19zdG9wKShzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KTsKICAgICAg
ICBuZXRkZXZfdHhfdCAgICAgICAgICAgICAoKm5kb19zdGFydF94bWl0KShzdHJ1Y3Qgc2tfYnVm
ZiAqc2tiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpOwotICAgICAgIG5ldGRldl9mZWF0dXJlc190ICAgICAg
ICgqbmRvX2ZlYXR1cmVzX2NoZWNrKShzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAorICAgICAgIHZvaWQg
ICAgICAgICAgICAgICAgICAgICgqbmRvX2ZlYXR1cmVzX2NoZWNrKShzdHJ1Y3Qgc2tfYnVmZiAq
c2tiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAotCm5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVzKTsK
KwpuZXRkZXZfZmVhdHVyZXNfdCAqZmVhdHVyZXMpOwogICAgICAgIHUxNiAgICAgICAgICAgICAg
ICAgICAgICgqbmRvX3NlbGVjdF9xdWV1ZSkoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBza19i
dWZmICpza2IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqc2JfZGV2KTsKQEAgLTE0NjcsMTAgKzE0NjcsMTAgQEAg
c3RydWN0IG5ldF9kZXZpY2Vfb3BzIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgYm9vbCBhbGxfc2xhdmVzKTsKICAgICAgICBzdHJ1Y3QgbmV0
X2RldmljZSogICAgICAoKm5kb19za19nZXRfbG93ZXJfZGV2KShzdHJ1Y3QgbmV0X2RldmljZSAq
ZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCBzb2NrICpzayk7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgICAgICAgKCpu
ZG9fZml4X2ZlYXR1cmVzKShzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVh
dHVyZXMpOworICAgICAgIHZvaWQgICAgICAgICAgICAgICAgICAgICgqbmRvX2ZpeF9mZWF0dXJl
cykoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190CipmZWF0dXJlcyk7CiAgICAg
ICAgaW50ICAgICAgICAgICAgICAgICAgICAgKCpuZG9fc2V0X2ZlYXR1cmVzKShzdHJ1Y3QgbmV0
X2RldmljZSAqZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVhdHVyZXMpOworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QKKmZlYXR1
cmVzKTsKICAgICAgICBpbnQgICAgICAgICAgICAgICAgICAgICAoKm5kb19uZWlnaF9jb25zdHJ1
Y3QpKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbmVpZ2hib3VyICpuKTsKICAgICAgICB2
b2lkICAgICAgICAgICAgICAgICAgICAoKm5kb19uZWlnaF9kZXN0cm95KShzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2LApAQCAtMTk3OCwxMiArMTk3OCwxMiBAQCBzdHJ1Y3QgbmV0X2RldmljZSB7CiAg
ICAgICAgdW5zaWduZWQgc2hvcnQgICAgICAgICAgbmVlZGVkX2hlYWRyb29tOwogICAgICAgIHVu
c2lnbmVkIHNob3J0ICAgICAgICAgIG5lZWRlZF90YWlscm9vbTsKCi0gICAgICAgbmV0ZGV2X2Zl
YXR1cmVzX3QgICAgICAgZmVhdHVyZXM7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgICAgICAg
aHdfZmVhdHVyZXM7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgICAgICAgd2FudGVkX2ZlYXR1
cmVzOwotICAgICAgIG5ldGRldl9mZWF0dXJlc190ICAgICAgIHZsYW5fZmVhdHVyZXM7Ci0gICAg
ICAgbmV0ZGV2X2ZlYXR1cmVzX3QgICAgICAgaHdfZW5jX2ZlYXR1cmVzOwotICAgICAgIG5ldGRl
dl9mZWF0dXJlc190ICAgICAgIG1wbHNfZmVhdHVyZXM7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVz
X3QgICAgICAgZmVhdHVyZXNbTkVUREVWX0ZFQVRVUkVfRFdPUkRTXTsKKyAgICAgICBuZXRkZXZf
ZmVhdHVyZXNfdCAgICAgICBod19mZWF0dXJlc1tORVRERVZfRkVBVFVSRV9EV09SRFNdOworICAg
ICAgIG5ldGRldl9mZWF0dXJlc190ICAgICAgIHdhbnRlZF9mZWF0dXJlc1tORVRERVZfRkVBVFVS
RV9EV09SRFNdOworICAgICAgIG5ldGRldl9mZWF0dXJlc190ICAgICAgIHZsYW5fZmVhdHVyZXNb
TkVUREVWX0ZFQVRVUkVfRFdPUkRTXTsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCAgICAgICBo
d19lbmNfZmVhdHVyZXNbTkVUREVWX0ZFQVRVUkVfRFdPUkRTXTsKKyAgICAgICBuZXRkZXZfZmVh
dHVyZXNfdCAgICAgICBtcGxzX2ZlYXR1cmVzW05FVERFVl9GRUFUVVJFX0RXT1JEU107CiAgICAg
ICAgbmV0ZGV2X2ZlYXR1cmVzX3QgICAgICAgZ3NvX3BhcnRpYWxfZmVhdHVyZXM7CgogICAgICAg
IHVuc2lnbmVkIGludCAgICAgICAgICAgIG1pbl9tdHU7CkBAIC00OTg2LDEwICs0OTg2LDExIEBA
IHN0YXRpYyBpbmxpbmUgbmV0ZGV2X2ZlYXR1cmVzX3QKbmV0ZGV2X2ludGVyc2VjdF9mZWF0dXJl
cyhuZXRkZXZfZmVhdHVyZXNfdCBmMSwKICAgICAgICByZXR1cm4gZjEgJiBmMjsKIH0KCi1zdGF0
aWMgaW5saW5lIG5ldGRldl9mZWF0dXJlc190IG5ldGRldl9nZXRfd2FudGVkX2ZlYXR1cmVzKAot
ICAgICAgIHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpCitzdGF0aWMgaW5saW5lIHZvaWQgbmV0ZGV2
X2dldF93YW50ZWRfZmVhdHVyZXMoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190ICp3YW50
ZWQpCiB7Ci0gICAgICAgcmV0dXJuIChkZXYtPmZlYXR1cmVzICYgfmRldi0+aHdfZmVhdHVyZXMp
IHwgZGV2LT53YW50ZWRfZmVhdHVyZXM7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZG5vdCh3
YW50ZWQsIGRldi0+ZmVhdHVyZXMsIGRldi0+aHdfZmVhdHVyZXMpOworICAgICAgIG5ldGRldl9m
ZWF0dXJlc19vcih3YW50ZWQsIHdhbnRlZCwgZGV2LT53YW50ZWRfZmVhdHVyZXMpOwogfQogbmV0
ZGV2X2ZlYXR1cmVzX3QgbmV0ZGV2X2luY3JlbWVudF9mZWF0dXJlcyhuZXRkZXZfZmVhdHVyZXNf
dCBhbGwsCiAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3Qgb25lLCBuZXRkZXZfZmVhdHVyZXNfdCBt
YXNrKTsKQEAgLTUwMTQsNyArNTAxNSw3IEBAIHZvaWQgbmV0aWZfc3RhY2tlZF90cmFuc2Zlcl9v
cGVyc3RhdGUoY29uc3QKc3RydWN0IG5ldF9kZXZpY2UgKnJvb3RkZXYsCiBuZXRkZXZfZmVhdHVy
ZXNfdCBwYXNzdGhydV9mZWF0dXJlc19jaGVjayhzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqZGV2
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVy
ZXNfdCBmZWF0dXJlcyk7Ci1uZXRkZXZfZmVhdHVyZXNfdCBuZXRpZl9za2JfZmVhdHVyZXMoc3Ry
dWN0IHNrX2J1ZmYgKnNrYik7Cit2b2lkIG5ldGlmX3NrYl9mZWF0dXJlcyhzdHJ1Y3Qgc2tfYnVm
ZiAqc2tiLCBuZXRkZXZfZmVhdHVyZXNfdCAqZmVhdHVyZXMpOwoKIHN0YXRpYyBpbmxpbmUgYm9v
bCBuZXRfZ3NvX29rKG5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVzLCBpbnQgZ3NvX3R5cGUpCiB7
CmRpZmYgLS1naXQgYS9uZXQvODAyMXEvdmxhbi5jIGIvbmV0LzgwMjFxL3ZsYW4uYwppbmRleCA0
Y2RmODQxLi43ZDc3NjkyIDEwMDY0NAotLS0gYS9uZXQvODAyMXEvdmxhbi5jCisrKyBiL25ldC84
MDIxcS92bGFuLmMKQEAgLTMyOCw3ICszMjgsNyBAQCBzdGF0aWMgdm9pZCB2bGFuX3RyYW5zZmVy
X2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCiAgICAgICAgdmxhbmRldi0+Z3NvX21h
eF9zaXplID0gZGV2LT5nc29fbWF4X3NpemU7CiAgICAgICAgdmxhbmRldi0+Z3NvX21heF9zZWdz
ID0gZGV2LT5nc29fbWF4X3NlZ3M7CgotICAgICAgIGlmICh2bGFuX2h3X29mZmxvYWRfY2FwYWJs
ZShkZXYtPmZlYXR1cmVzLCB2bGFuLT52bGFuX3Byb3RvKSkKKyAgICAgICBpZiAodmxhbl9od19v
ZmZsb2FkX2NhcGFibGUoZGV2LT5mZWF0dXJlc1swXSwgdmxhbi0+dmxhbl9wcm90bykpCiAgICAg
ICAgICAgICAgICB2bGFuZGV2LT5oYXJkX2hlYWRlcl9sZW4gPSBkZXYtPmhhcmRfaGVhZGVyX2xl
bjsKICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB2bGFuZGV2LT5oYXJkX2hlYWRlcl9sZW4g
PSBkZXYtPmhhcmRfaGVhZGVyX2xlbiArIFZMQU5fSExFTjsKQEAgLTMzOSw3ICszMzksNyBAQCBz
dGF0aWMgdm9pZCB2bGFuX3RyYW5zZmVyX2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYs
CgogICAgICAgIHZsYW5kZXYtPnByaXZfZmxhZ3MgJj0gfklGRl9YTUlUX0RTVF9SRUxFQVNFOwog
ICAgICAgIHZsYW5kZXYtPnByaXZfZmxhZ3MgfD0gKHZsYW4tPnJlYWxfZGV2LT5wcml2X2ZsYWdz
ICYKSUZGX1hNSVRfRFNUX1JFTEVBU0UpOwotICAgICAgIHZsYW5kZXYtPmh3X2VuY19mZWF0dXJl
cyA9IHZsYW5fdG5sX2ZlYXR1cmVzKHZsYW4tPnJlYWxfZGV2KTsKKyAgICAgICB2bGFuZGV2LT5o
d19lbmNfZmVhdHVyZXNbMF0gPSB2bGFuX3RubF9mZWF0dXJlcyh2bGFuLT5yZWFsX2Rldik7Cgog
ICAgICAgIG5ldGRldl91cGRhdGVfZmVhdHVyZXModmxhbmRldik7CiB9CmRpZmYgLS1naXQgYS9u
ZXQvODAyMXEvdmxhbi5oIGIvbmV0LzgwMjFxL3ZsYW4uaAppbmRleCAxYTcwNWE0Li40ZTc4NGEx
IDEwMDY0NAotLS0gYS9uZXQvODAyMXEvdmxhbi5oCisrKyBiL25ldC84MDIxcS92bGFuLmgKQEAg
LTEwNyw3ICsxMDcsNyBAQCBzdGF0aWMgaW5saW5lIG5ldGRldl9mZWF0dXJlc190CnZsYW5fdG5s
X2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpyZWFsX2RldikKIHsKICAgICAgICBuZXRkZXZf
ZmVhdHVyZXNfdCByZXQ7CgotICAgICAgIHJldCA9IHJlYWxfZGV2LT5od19lbmNfZmVhdHVyZXMg
JgorICAgICAgIHJldCA9IHJlYWxfZGV2LT5od19lbmNfZmVhdHVyZXNbMF0gJgogICAgICAgICAg
ICAgIChORVRJRl9GX0NTVU1fTUFTSyB8IE5FVElGX0ZfR1NPX1NPRlRXQVJFIHwKICAgICAgICAg
ICAgICAgTkVUSUZfRl9HU09fRU5DQVBfQUxMKTsKCmRpZmYgLS1naXQgYS9uZXQvODAyMXEvdmxh
bl9kZXYuYyBiL25ldC84MDIxcS92bGFuX2Rldi5jCmluZGV4IGEwMzY3YjMuLjZkNDk3NjEgMTAw
NjQ0Ci0tLSBhL25ldC84MDIxcS92bGFuX2Rldi5jCisrKyBiL25ldC84MDIxcS92bGFuX2Rldi5j
CkBAIC01NjYsMjEgKzU2NiwyMSBAQCBzdGF0aWMgaW50IHZsYW5fZGV2X2luaXQoc3RydWN0IG5l
dF9kZXZpY2UgKmRldikKICAgICAgICBpZiAodmxhbi0+ZmxhZ3MgJiBWTEFOX0ZMQUdfQlJJREdF
X0JJTkRJTkcpCiAgICAgICAgICAgICAgICBkZXYtPnN0YXRlIHw9ICgxIDw8IF9fTElOS19TVEFU
RV9OT0NBUlJJRVIpOwoKLSAgICAgICBkZXYtPmh3X2ZlYXR1cmVzID0gTkVUSUZfRl9IV19DU1VN
IHwgTkVUSUZfRl9TRyB8Ci0gICAgICAgICAgICAgICAgICAgICAgICAgIE5FVElGX0ZfRlJBR0xJ
U1QgfCBORVRJRl9GX0dTT19TT0ZUV0FSRSB8Ci0gICAgICAgICAgICAgICAgICAgICAgICAgIE5F
VElGX0ZfR1NPX0VOQ0FQX0FMTCB8Ci0gICAgICAgICAgICAgICAgICAgICAgICAgIE5FVElGX0Zf
SElHSERNQSB8IE5FVElGX0ZfU0NUUF9DUkMgfAotICAgICAgICAgICAgICAgICAgICAgICAgICBO
RVRJRl9GX0FMTF9GQ09FOworICAgICAgIGRldi0+aHdfZmVhdHVyZXNbMF0gPSBORVRJRl9GX0hX
X0NTVU0gfCBORVRJRl9GX1NHIHwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTkVUSUZf
Rl9GUkFHTElTVCB8IE5FVElGX0ZfR1NPX1NPRlRXQVJFIHwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTkVUSUZfRl9HU09fRU5DQVBfQUxMIHwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgTkVUSUZfRl9ISUdIRE1BIHwgTkVUSUZfRl9TQ1RQX0NSQyB8CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIE5FVElGX0ZfQUxMX0ZDT0U7CgotICAgICAgIGRldi0+ZmVhdHVyZXMg
fD0gZGV2LT5od19mZWF0dXJlcyB8IE5FVElGX0ZfTExUWDsKKyAgICAgICBkZXYtPmZlYXR1cmVz
WzBdIHw9IGRldi0+aHdfZmVhdHVyZXNbMF0gfCBORVRJRl9GX0xMVFg7CiAgICAgICAgZGV2LT5n
c29fbWF4X3NpemUgPSByZWFsX2Rldi0+Z3NvX21heF9zaXplOwogICAgICAgIGRldi0+Z3NvX21h
eF9zZWdzID0gcmVhbF9kZXYtPmdzb19tYXhfc2VnczsKLSAgICAgICBpZiAoZGV2LT5mZWF0dXJl
cyAmIE5FVElGX0ZfVkxBTl9GRUFUVVJFUykKKyAgICAgICBpZiAoZGV2LT5mZWF0dXJlc1swXSAm
IE5FVElGX0ZfVkxBTl9GRUFUVVJFUykKICAgICAgICAgICAgICAgIG5ldGRldl93YXJuKHJlYWxf
ZGV2LCAiVkxBTiBmZWF0dXJlcyBhcmUgc2V0CmluY29ycmVjdGx5LiAgUS1pbi1RIGNvbmZpZ3Vy
YXRpb25zIG1heSBub3Qgd29yayBjb3JyZWN0bHkuXG4iKTsKCi0gICAgICAgZGV2LT52bGFuX2Zl
YXR1cmVzID0gcmVhbF9kZXYtPnZsYW5fZmVhdHVyZXMgJiB+TkVUSUZfRl9BTExfRkNPRTsKLSAg
ICAgICBkZXYtPmh3X2VuY19mZWF0dXJlcyA9IHZsYW5fdG5sX2ZlYXR1cmVzKHJlYWxfZGV2KTsK
LSAgICAgICBkZXYtPm1wbHNfZmVhdHVyZXMgPSByZWFsX2Rldi0+bXBsc19mZWF0dXJlczsKKyAg
ICAgICBkZXYtPnZsYW5fZmVhdHVyZXNbMF0gPSByZWFsX2Rldi0+dmxhbl9mZWF0dXJlc1swXSAm
IH5ORVRJRl9GX0FMTF9GQ09FOworICAgICAgIGRldi0+aHdfZW5jX2ZlYXR1cmVzWzBdID0gdmxh
bl90bmxfZmVhdHVyZXMocmVhbF9kZXYpOworICAgICAgIG5ldGRldl9mZWF0dXJlc19jb3B5KGRl
di0+bXBsc19mZWF0dXJlcywgcmVhbF9kZXYtPm1wbHNfZmVhdHVyZXMpOwoKICAgICAgICAvKiBp
cHY2IHNoYXJlZCBjYXJkIHJlbGF0ZWQgc3R1ZmYgKi8KICAgICAgICBkZXYtPmRldl9pZCA9IHJl
YWxfZGV2LT5kZXZfaWQ7CkBAIC02MzMsMjcgKzYzMywzMCBAQCB2b2lkIHZsYW5fZGV2X3VuaW5p
dChzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogICAgICAgIH0KIH0KCi1zdGF0aWMgbmV0ZGV2X2Zl
YXR1cmVzX3Qgdmxhbl9kZXZfZml4X2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCi0g
ICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVhdHVyZXMpCitzdGF0aWMgdm9pZCB2bGFuX2Rldl9m
aXhfZmVhdHVyZXMoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190ICpmZWF0dXJlcykKIHsKICAgICAgICBzdHJ1
Y3QgbmV0X2RldmljZSAqcmVhbF9kZXYgPSB2bGFuX2Rldl9wcml2KGRldiktPnJlYWxfZGV2Owot
ICAgICAgIG5ldGRldl9mZWF0dXJlc190IG9sZF9mZWF0dXJlcyA9IGZlYXR1cmVzOwotICAgICAg
IG5ldGRldl9mZWF0dXJlc190IGxvd2VyX2ZlYXR1cmVzOworICAgICAgIG5ldGRldl9mZWF0dXJl
c190IGxvd2VyX2ZlYXR1cmVzW05FVERFVl9GRUFUVVJFX0RXT1JEU107CisgICAgICAgbmV0ZGV2
X2ZlYXR1cmVzX3Qgb2xkX2ZlYXR1cmVzW05FVERFVl9GRUFUVVJFX0RXT1JEU107CgotICAgICAg
IGxvd2VyX2ZlYXR1cmVzID0gbmV0ZGV2X2ludGVyc2VjdF9mZWF0dXJlcygocmVhbF9kZXYtPnZs
YW5fZmVhdHVyZXMgfAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTkVUSUZfRl9SWENTVU0pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICByZWFsX2Rldi0+ZmVhdHVyZXMpOworICAgICAgIG5ldGRldl9m
ZWF0dXJlc19jb3B5KGxvd2VyX2ZlYXR1cmVzLCBmZWF0dXJlcyk7CisKKyAgICAgICBsb3dlcl9m
ZWF0dXJlc1swXSA9CisgICAgICAgICAgICAgICBuZXRkZXZfaW50ZXJzZWN0X2ZlYXR1cmVzKChy
ZWFsX2Rldi0+dmxhbl9mZWF0dXJlc1swXSB8CisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBORVRJRl9GX1JYQ1NVTSksCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHJlYWxfZGV2LT5mZWF0dXJlc1swXSk7CgogICAgICAgIC8qIEFkZCBI
V19DU1VNIHNldHRpbmcgdG8gcHJlc2VydmUgdXNlciBhYmlsaXR5IHRvIGNvbnRyb2wKICAgICAg
ICAgKiBjaGVja3N1bSBvZmZsb2FkIG9uIHRoZSB2bGFuIGRldmljZS4KICAgICAgICAgKi8KLSAg
ICAgICBpZiAobG93ZXJfZmVhdHVyZXMgJiAoTkVUSUZfRl9JUF9DU1VNfE5FVElGX0ZfSVBWNl9D
U1VNKSkKLSAgICAgICAgICAgICAgIGxvd2VyX2ZlYXR1cmVzIHw9IE5FVElGX0ZfSFdfQ1NVTTsK
LSAgICAgICBmZWF0dXJlcyA9IG5ldGRldl9pbnRlcnNlY3RfZmVhdHVyZXMoZmVhdHVyZXMsIGxv
d2VyX2ZlYXR1cmVzKTsKLSAgICAgICBmZWF0dXJlcyB8PSBvbGRfZmVhdHVyZXMgJiAoTkVUSUZf
Rl9TT0ZUX0ZFQVRVUkVTIHwKTkVUSUZfRl9HU09fU09GVFdBUkUpOwotICAgICAgIGZlYXR1cmVz
IHw9IE5FVElGX0ZfTExUWDsKKyAgICAgICBpZiAobG93ZXJfZmVhdHVyZXNbMF0gJiAoTkVUSUZf
Rl9JUF9DU1VNIHwgTkVUSUZfRl9JUFY2X0NTVU0pKQorICAgICAgICAgICAgICAgbG93ZXJfZmVh
dHVyZXNbMF0gfD0gTkVUSUZfRl9IV19DU1VNOwoKLSAgICAgICByZXR1cm4gZmVhdHVyZXM7Cisg
ICAgICAgZmVhdHVyZXNbMF0gPSBuZXRkZXZfaW50ZXJzZWN0X2ZlYXR1cmVzKGZlYXR1cmVzWzBd
LCBsb3dlcl9mZWF0dXJlc1swXSk7CisgICAgICAgZmVhdHVyZXNbMF0gfD0gb2xkX2ZlYXR1cmVz
WzBdICYKKyAgICAgICAgICAgICAgICAgICAgICAgKE5FVElGX0ZfU09GVF9GRUFUVVJFUyB8IE5F
VElGX0ZfR1NPX1NPRlRXQVJFKTsKKyAgICAgICBmZWF0dXJlc1swXSB8PSBORVRJRl9GX0xMVFg7
CiB9Cgogc3RhdGljIGludCB2bGFuX2V0aHRvb2xfZ2V0X2xpbmtfa3NldHRpbmdzKHN0cnVjdCBu
ZXRfZGV2aWNlICpkZXYsCmRpZmYgLS1naXQgYS9uZXQvY29yZS9kZXYuYyBiL25ldC9jb3JlL2Rl
di5jCmluZGV4IGMyNTNjMmEuLjcwNjZiZjMgMTAwNjQ0Ci0tLSBhL25ldC9jb3JlL2Rldi5jCisr
KyBiL25ldC9jb3JlL2Rldi5jCkBAIC0xNzY1LDcgKzE3NjUsNyBAQCB2b2lkIGRldl9kaXNhYmxl
X2xybyhzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogICAgICAgIGRldi0+d2FudGVkX2ZlYXR1cmVz
ICY9IH5ORVRJRl9GX0xSTzsKICAgICAgICBuZXRkZXZfdXBkYXRlX2ZlYXR1cmVzKGRldik7Cgot
ICAgICAgIGlmICh1bmxpa2VseShkZXYtPmZlYXR1cmVzICYgTkVUSUZfRl9MUk8pKQorICAgICAg
IGlmICh1bmxpa2VseShkZXYtPmZlYXR1cmVzWzBdICYgTkVUSUZfRl9MUk8pKQogICAgICAgICAg
ICAgICAgbmV0ZGV2X1dBUk4oZGV2LCAiZmFpbGVkIHRvIGRpc2FibGUgTFJPIVxuIik7CgogICAg
ICAgIG5ldGRldl9mb3JfZWFjaF9sb3dlcl9kZXYoZGV2LCBsb3dlcl9kZXYsIGl0ZXIpCkBAIC0x
Nzg2LDcgKzE3ODYsNyBAQCBzdGF0aWMgdm9pZCBkZXZfZGlzYWJsZV9ncm9faHcoc3RydWN0IG5l
dF9kZXZpY2UgKmRldikKICAgICAgICBkZXYtPndhbnRlZF9mZWF0dXJlcyAmPSB+TkVUSUZfRl9H
Uk9fSFc7CiAgICAgICAgbmV0ZGV2X3VwZGF0ZV9mZWF0dXJlcyhkZXYpOwoKLSAgICAgICBpZiAo
dW5saWtlbHkoZGV2LT5mZWF0dXJlcyAmIE5FVElGX0ZfR1JPX0hXKSkKKyAgICAgICBpZiAodW5s
aWtlbHkoZGV2LT5mZWF0dXJlc1swXSAmIE5FVElGX0ZfR1JPX0hXKSkKICAgICAgICAgICAgICAg
IG5ldGRldl9XQVJOKGRldiwgImZhaWxlZCB0byBkaXNhYmxlIEdST19IVyFcbiIpOwogfQoKQEAg
LTMyNzYsNyArMzI3Niw3IEBAIHN0YXRpYyB2b2lkIHNrYl93YXJuX2JhZF9vZmZsb2FkKGNvbnN0
IHN0cnVjdApza19idWZmICpza2IpCiAgICAgICAgfQogICAgICAgIHNrYl9kdW1wKEtFUk5fV0FS
TklORywgc2tiLCBmYWxzZSk7CiAgICAgICAgV0FSTigxLCAiJXM6IGNhcHM9KCVwTkYsICVwTkYp
XG4iLAotICAgICAgICAgICAgbmFtZSwgZGV2ID8gJmRldi0+ZmVhdHVyZXMgOiAmbnVsbF9mZWF0
dXJlcywKKyAgICAgICAgICAgIG5hbWUsIGRldiA/ICZkZXYtPmZlYXR1cmVzWzBdIDogJm51bGxf
ZmVhdHVyZXMsCiAgICAgICAgICAgICBza2ItPnNrID8gJnNrYi0+c2stPnNrX3JvdXRlX2NhcHMg
OiAmbnVsbF9mZWF0dXJlcyk7CiB9CgpAQCAtMzQ2Myw3ICszNDYzLDggQEAgc3RydWN0IHNrX2J1
ZmYgKl9fc2tiX2dzb19zZWdtZW50KHN0cnVjdCBza19idWZmICpza2IsCiAgICAgICAgICAgICAg
ICBuZXRkZXZfZmVhdHVyZXNfdCBwYXJ0aWFsX2ZlYXR1cmVzID0gTkVUSUZfRl9HU09fUk9CVVNU
OwogICAgICAgICAgICAgICAgc3RydWN0IG5ldF9kZXZpY2UgKmRldiA9IHNrYi0+ZGV2OwoKLSAg
ICAgICAgICAgICAgIHBhcnRpYWxfZmVhdHVyZXMgfD0gZGV2LT5mZWF0dXJlcyAmIGRldi0+Z3Nv
X3BhcnRpYWxfZmVhdHVyZXM7CisgICAgICAgICAgICAgICBwYXJ0aWFsX2ZlYXR1cmVzIHw9Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT5mZWF0dXJlc1swXSAmIGRldi0+Z3Nv
X3BhcnRpYWxfZmVhdHVyZXM7CiAgICAgICAgICAgICAgICBpZiAoIXNrYl9nc29fb2soc2tiLCBm
ZWF0dXJlcyB8IHBhcnRpYWxfZmVhdHVyZXMpKQogICAgICAgICAgICAgICAgICAgICAgICBmZWF0
dXJlcyAmPSB+TkVUSUZfRl9HU09fUEFSVElBTDsKICAgICAgICB9CkBAIC0zNTA4LDcgKzM1MDks
NyBAQCBzdGF0aWMgaW50IGlsbGVnYWxfaGlnaGRtYShzdHJ1Y3QgbmV0X2RldmljZQoqZGV2LCBz
dHJ1Y3Qgc2tfYnVmZiAqc2tiKQogI2lmZGVmIENPTkZJR19ISUdITUVNCiAgICAgICAgaW50IGk7
CgotICAgICAgIGlmICghKGRldi0+ZmVhdHVyZXMgJiBORVRJRl9GX0hJR0hETUEpKSB7CisgICAg
ICAgaWYgKCEoZGV2LT5mZWF0dXJlc1swXSAmIE5FVElGX0ZfSElHSERNQSkpIHsKICAgICAgICAg
ICAgICAgIGZvciAoaSA9IDA7IGkgPCBza2Jfc2hpbmZvKHNrYiktPm5yX2ZyYWdzOyBpKyspIHsK
ICAgICAgICAgICAgICAgICAgICAgICAgc2tiX2ZyYWdfdCAqZnJhZyA9ICZza2Jfc2hpbmZvKHNr
YiktPmZyYWdzW2ldOwoKQEAgLTM2MTIsMzQgKzM2MTMsMzMgQEAgc3RhdGljIG5ldGRldl9mZWF0
dXJlc190Cmdzb19mZWF0dXJlc19jaGVjayhjb25zdCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogICAg
ICAgIHJldHVybiBmZWF0dXJlczsKIH0KCi1uZXRkZXZfZmVhdHVyZXNfdCBuZXRpZl9za2JfZmVh
dHVyZXMoc3RydWN0IHNrX2J1ZmYgKnNrYikKK3ZvaWQgbmV0aWZfc2tiX2ZlYXR1cmVzKHN0cnVj
dCBza19idWZmICpza2IsIG5ldGRldl9mZWF0dXJlc190ICpmZWF0dXJlcykKIHsKICAgICAgICBz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2ID0gc2tiLT5kZXY7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVz
X3QgZmVhdHVyZXMgPSBkZXYtPmZlYXR1cmVzOwoKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfY29w
eShmZWF0dXJlcywgZGV2LT5mZWF0dXJlcyk7CiAgICAgICAgaWYgKHNrYl9pc19nc28oc2tiKSkK
LSAgICAgICAgICAgICAgIGZlYXR1cmVzID0gZ3NvX2ZlYXR1cmVzX2NoZWNrKHNrYiwgZGV2LCBm
ZWF0dXJlcyk7CisgICAgICAgICAgICAgICBmZWF0dXJlc1swXSA9IGdzb19mZWF0dXJlc19jaGVj
ayhza2IsIGRldiwgZmVhdHVyZXNbMF0pOwoKICAgICAgICAvKiBJZiBlbmNhcHN1bGF0aW9uIG9m
ZmxvYWQgcmVxdWVzdCwgdmVyaWZ5IHdlIGFyZSB0ZXN0aW5nCiAgICAgICAgICogaGFyZHdhcmUg
ZW5jYXBzdWxhdGlvbiBmZWF0dXJlcyBpbnN0ZWFkIG9mIHN0YW5kYXJkCiAgICAgICAgICogZmVh
dHVyZXMgZm9yIHRoZSBuZXRkZXYKICAgICAgICAgKi8KICAgICAgICBpZiAoc2tiLT5lbmNhcHN1
bGF0aW9uKQotICAgICAgICAgICAgICAgZmVhdHVyZXMgJj0gZGV2LT5od19lbmNfZmVhdHVyZXM7
CisgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfYW5kKGZlYXR1cmVzLCBkZXYtPmh3X2Vu
Y19mZWF0dXJlcyk7CgogICAgICAgIGlmIChza2Jfdmxhbl90YWdnZWQoc2tiKSkKLSAgICAgICAg
ICAgICAgIGZlYXR1cmVzID0gbmV0ZGV2X2ludGVyc2VjdF9mZWF0dXJlcyhmZWF0dXJlcywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPnZs
YW5fZmVhdHVyZXMgfAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIE5FVElGX0ZfSFdfVkxBTl9DVEFHX1RYIHwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBORVRJRl9GX0hXX1ZMQU5fU1RBR19UWCk7
CisgICAgICAgICAgICAgICBmZWF0dXJlc1swXSA9IG5ldGRldl9pbnRlcnNlY3RfZmVhdHVyZXMo
ZmVhdHVyZXNbMF0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZGV2LT52bGFuX2ZlYXR1cmVzWzBdIHwKKwpORVRJRl9GX0hXX1ZMQU5fQ1RB
R19UWCB8CisKTkVUSUZfRl9IV19WTEFOX1NUQUdfVFgpOwoKICAgICAgICBpZiAoZGV2LT5uZXRk
ZXZfb3BzLT5uZG9fZmVhdHVyZXNfY2hlY2spCi0gICAgICAgICAgICAgICBmZWF0dXJlcyAmPSBk
ZXYtPm5ldGRldl9vcHMtPm5kb19mZWF0dXJlc19jaGVjayhza2IsIGRldiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1
cmVzKTsKKyAgICAgICAgICAgICAgIGRldi0+bmV0ZGV2X29wcy0+bmRvX2ZlYXR1cmVzX2NoZWNr
KHNrYiwgZGV2LCBmZWF0dXJlcyk7CiAgICAgICAgZWxzZQotICAgICAgICAgICAgICAgZmVhdHVy
ZXMgJj0gZGZsdF9mZWF0dXJlc19jaGVjayhza2IsIGRldiwgZmVhdHVyZXMpOworICAgICAgICAg
ICAgICAgZmVhdHVyZXNbMF0gJj0gZGZsdF9mZWF0dXJlc19jaGVjayhza2IsIGRldiwgZmVhdHVy
ZXNbMF0pOwoKLSAgICAgICByZXR1cm4gaGFybW9uaXplX2ZlYXR1cmVzKHNrYiwgZmVhdHVyZXMp
OworICAgICAgIGZlYXR1cmVzWzBdID0gaGFybW9uaXplX2ZlYXR1cmVzKHNrYiwgZmVhdHVyZXNb
MF0pOwogfQogRVhQT1JUX1NZTUJPTChuZXRpZl9za2JfZmVhdHVyZXMpOwoKQEAgLTM3MjIsMTAg
KzM3MjIsMTAgQEAgRVhQT1JUX1NZTUJPTChza2JfY3N1bV9od29mZmxvYWRfaGVscCk7Cgogc3Rh
dGljIHN0cnVjdCBza19idWZmICp2YWxpZGF0ZV94bWl0X3NrYihzdHJ1Y3Qgc2tfYnVmZiAqc2ti
LCBzdHJ1Y3QKbmV0X2RldmljZSAqZGV2LCBib29sICphZ2FpbikKIHsKLSAgICAgICBuZXRkZXZf
ZmVhdHVyZXNfdCBmZWF0dXJlczsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlc1tO
RVRERVZfRkVBVFVSRV9EV09SRFNdOwoKLSAgICAgICBmZWF0dXJlcyA9IG5ldGlmX3NrYl9mZWF0
dXJlcyhza2IpOwotICAgICAgIHNrYiA9IHZhbGlkYXRlX3htaXRfdmxhbihza2IsIGZlYXR1cmVz
KTsKKyAgICAgICBuZXRpZl9za2JfZmVhdHVyZXMoc2tiLCBmZWF0dXJlcyk7CisgICAgICAgc2ti
ID0gdmFsaWRhdGVfeG1pdF92bGFuKHNrYiwgZmVhdHVyZXNbMF0pOwogICAgICAgIGlmICh1bmxp
a2VseSghc2tiKSkKICAgICAgICAgICAgICAgIGdvdG8gb3V0X251bGw7CgpAQCAtMzczMywxMCAr
MzczMywxMCBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYKKnZhbGlkYXRlX3htaXRfc2tiKHN0cnVj
dCBza19idWZmICpza2IsIHN0cnVjdCBuZXRfZGV2aWNlCiAgICAgICAgaWYgKHVubGlrZWx5KCFz
a2IpKQogICAgICAgICAgICAgICAgZ290byBvdXRfbnVsbDsKCi0gICAgICAgaWYgKG5ldGlmX25l
ZWRzX2dzbyhza2IsIGZlYXR1cmVzKSkgeworICAgICAgIGlmIChuZXRpZl9uZWVkc19nc28oc2ti
LCBmZWF0dXJlc1swXSkpIHsKICAgICAgICAgICAgICAgIHN0cnVjdCBza19idWZmICpzZWdzOwoK
LSAgICAgICAgICAgICAgIHNlZ3MgPSBza2JfZ3NvX3NlZ21lbnQoc2tiLCBmZWF0dXJlcyk7Cisg
ICAgICAgICAgICAgICBzZWdzID0gc2tiX2dzb19zZWdtZW50KHNrYiwgZmVhdHVyZXNbMF0pOwog
ICAgICAgICAgICAgICAgaWYgKElTX0VSUihzZWdzKSkgewogICAgICAgICAgICAgICAgICAgICAg
ICBnb3RvIG91dF9rZnJlZV9za2I7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlZ3MpIHsK
QEAgLTM3NDQsNyArMzc0NCw3IEBAIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqdmFsaWRhdGVfeG1p
dF9za2Ioc3RydWN0CnNrX2J1ZmYgKnNrYiwgc3RydWN0IG5ldF9kZXZpY2UKICAgICAgICAgICAg
ICAgICAgICAgICAgc2tiID0gc2VnczsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug
ewotICAgICAgICAgICAgICAgaWYgKHNrYl9uZWVkc19saW5lYXJpemUoc2tiLCBmZWF0dXJlcykg
JiYKKyAgICAgICAgICAgICAgIGlmIChza2JfbmVlZHNfbGluZWFyaXplKHNrYiwgZmVhdHVyZXNb
MF0pICYmCiAgICAgICAgICAgICAgICAgICAgX19za2JfbGluZWFyaXplKHNrYikpCiAgICAgICAg
ICAgICAgICAgICAgICAgIGdvdG8gb3V0X2tmcmVlX3NrYjsKCkBAIC0zNzU5LDEyICszNzU5LDEy
IEBAIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZgoqdmFsaWRhdGVfeG1pdF9za2Ioc3RydWN0IHNrX2J1
ZmYgKnNrYiwgc3RydWN0IG5ldF9kZXZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNrYl9zZXRfdHJhbnNwb3J0X2hlYWRlcihz
a2IsCgpza2JfY2hlY2tzdW1fc3RhcnRfb2Zmc2V0KHNrYikpOwotICAgICAgICAgICAgICAgICAg
ICAgICBpZiAoc2tiX2NzdW1faHdvZmZsb2FkX2hlbHAoc2tiLCBmZWF0dXJlcykpCisgICAgICAg
ICAgICAgICAgICAgICAgIGlmIChza2JfY3N1bV9od29mZmxvYWRfaGVscChza2IsIGZlYXR1cmVz
WzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIG91dF9rZnJlZV9za2I7
CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKLSAgICAgICBza2IgPSB2YWxpZGF0ZV94bWl0
X3hmcm0oc2tiLCBmZWF0dXJlcywgYWdhaW4pOworICAgICAgIHNrYiA9IHZhbGlkYXRlX3htaXRf
eGZybShza2IsIGZlYXR1cmVzWzBdLCBhZ2Fpbik7CgogICAgICAgIHJldHVybiBza2I7CgpAQCAt
NDQyOSw3ICs0NDI5LDcgQEAgc2V0X3Jwc19jcHUoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwgc3Ry
dWN0IHNrX2J1ZmYgKnNrYiwKCiAgICAgICAgICAgICAgICAvKiBTaG91bGQgd2Ugc3RlZXIgdGhp
cyBmbG93IHRvIGEgZGlmZmVyZW50IGhhcmR3YXJlIHF1ZXVlPyAqLwogICAgICAgICAgICAgICAg
aWYgKCFza2JfcnhfcXVldWVfcmVjb3JkZWQoc2tiKSB8fCAhZGV2LT5yeF9jcHVfcm1hcCB8fAot
ICAgICAgICAgICAgICAgICAgICEoZGV2LT5mZWF0dXJlcyAmIE5FVElGX0ZfTlRVUExFKSkKKyAg
ICAgICAgICAgICAgICAgICAhKGRldi0+ZmVhdHVyZXNbMF0gJiBORVRJRl9GX05UVVBMRSkpCiAg
ICAgICAgICAgICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICAgICAgICAgcnhxX2luZGV4
ID0gY3B1X3JtYXBfbG9va3VwX2luZGV4KGRldi0+cnhfY3B1X3JtYXAsIG5leHRfY3B1KTsKICAg
ICAgICAgICAgICAgIGlmIChyeHFfaW5kZXggPT0gc2tiX2dldF9yeF9xdWV1ZShza2IpKQpAQCAt
OTc5OSwxNzEgKzk3OTksMTc5IEBAIHN0YXRpYyB2b2lkIG5ldF9zZXRfdG9kbyhzdHJ1Y3QgbmV0
X2RldmljZSAqZGV2KQogICAgICAgIGRldl9uZXQoZGV2KS0+ZGV2X3VucmVnX2NvdW50Kys7CiB9
Cgotc3RhdGljIG5ldGRldl9mZWF0dXJlc190IG5ldGRldl9zeW5jX3VwcGVyX2ZlYXR1cmVzKHN0
cnVjdCBuZXRfZGV2aWNlICpsb3dlciwKLSAgICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqdXBwZXIs
IG5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVzKQorc3RhdGljIHZvaWQgbmV0ZGV2X3N5bmNfdXBw
ZXJfZmVhdHVyZXMoc3RydWN0IG5ldF9kZXZpY2UgKmxvd2VyLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqdXBwZXIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc190ICpmZWF0dXJlcykK
IHsKICAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCB1cHBlcl9kaXNhYmxlcyA9IE5FVElGX0ZfVVBQ
RVJfRElTQUJMRVM7CiAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVhdHVyZTsKICAgICAgICBp
bnQgZmVhdHVyZV9iaXQ7CisgICAgICAgdW5zaWduZWQgaW50IGk7CgotICAgICAgIGZvcl9lYWNo
X25ldGRldl9mZWF0dXJlKHVwcGVyX2Rpc2FibGVzLCBmZWF0dXJlX2JpdCkgewotICAgICAgICAg
ICAgICAgZmVhdHVyZSA9IF9fTkVUSUZfRl9CSVQoZmVhdHVyZV9iaXQpOwotICAgICAgICAgICAg
ICAgaWYgKCEodXBwZXItPndhbnRlZF9mZWF0dXJlcyAmIGZlYXR1cmUpCi0gICAgICAgICAgICAg
ICAgICAgJiYgKGZlYXR1cmVzICYgZmVhdHVyZSkpIHsKLSAgICAgICAgICAgICAgICAgICAgICAg
bmV0ZGV2X2RiZyhsb3dlciwgIkRyb3BwaW5nIGZlYXR1cmUgJXBORiwKdXBwZXIgZGV2ICVzIGhh
cyBpdCBvZmYuXG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZmZWF0dXJl
LCB1cHBlci0+bmFtZSk7Ci0gICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzICY9IH5mZWF0
dXJlOworICAgICAgIGZvciAoaSA9IDA7IGkgPCBORVRERVZfRkVBVFVSRV9EV09SRFM7IGkrKykg
eworICAgICAgICAgICAgICAgZm9yX2VhY2hfbmV0ZGV2X2ZlYXR1cmUodXBwZXJfZGlzYWJsZXMs
IGZlYXR1cmVfYml0KSB7CisgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmUgPSBfX05FVElG
X0ZfQklUKGZlYXR1cmVfYml0KTsKKyAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodXBwZXIt
PndhbnRlZF9mZWF0dXJlc1tpXSAmIGZlYXR1cmUpICYmCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAoZmVhdHVyZXNbaV0gJiBmZWF0dXJlKSkgeworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG5ldGRldl9kYmcobG93ZXIsICJEcm9wcGluZwpmZWF0dXJlWyV1XSAlcE5GLCB1cHBl
ciBkZXYgJXMgaGFzIGl0IG9mZi5cbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBpLCAmZmVhdHVyZSwgdXBwZXItPm5hbWUpOworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGZlYXR1cmVzW2ldICY9IH5mZWF0dXJlOworICAgICAgICAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQotCi0gICAgICAgcmV0dXJuIGZlYXR1
cmVzOwogfQoKIHN0YXRpYyB2b2lkIG5ldGRldl9zeW5jX2xvd2VyX2ZlYXR1cmVzKHN0cnVjdCBu
ZXRfZGV2aWNlICp1cHBlciwKLSAgICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqbG93ZXIsIG5ldGRl
dl9mZWF0dXJlc190IGZlYXR1cmVzKQorICAgICAgIHN0cnVjdCBuZXRfZGV2aWNlICpsb3dlciwg
bmV0ZGV2X2ZlYXR1cmVzX3QgKmZlYXR1cmVzKQogewogICAgICAgIG5ldGRldl9mZWF0dXJlc190
IHVwcGVyX2Rpc2FibGVzID0gTkVUSUZfRl9VUFBFUl9ESVNBQkxFUzsKICAgICAgICBuZXRkZXZf
ZmVhdHVyZXNfdCBmZWF0dXJlOwogICAgICAgIGludCBmZWF0dXJlX2JpdDsKKyAgICAgICB1bnNp
Z25lZCBpbnQgaTsKCi0gICAgICAgZm9yX2VhY2hfbmV0ZGV2X2ZlYXR1cmUodXBwZXJfZGlzYWJs
ZXMsIGZlYXR1cmVfYml0KSB7Ci0gICAgICAgICAgICAgICBmZWF0dXJlID0gX19ORVRJRl9GX0JJ
VChmZWF0dXJlX2JpdCk7Ci0gICAgICAgICAgICAgICBpZiAoIShmZWF0dXJlcyAmIGZlYXR1cmUp
ICYmIChsb3dlci0+ZmVhdHVyZXMgJiBmZWF0dXJlKSkgewotICAgICAgICAgICAgICAgICAgICAg
ICBuZXRkZXZfZGJnKHVwcGVyLCAiRGlzYWJsaW5nIGZlYXR1cmUgJXBORiBvbgpsb3dlciBkZXYg
JXMuXG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZmZWF0dXJlLCBsb3dl
ci0+bmFtZSk7Ci0gICAgICAgICAgICAgICAgICAgICAgIGxvd2VyLT53YW50ZWRfZmVhdHVyZXMg
Jj0gfmZlYXR1cmU7Ci0gICAgICAgICAgICAgICAgICAgICAgIF9fbmV0ZGV2X3VwZGF0ZV9mZWF0
dXJlcyhsb3dlcik7Ci0KLSAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVubGlrZWx5KGxvd2Vy
LT5mZWF0dXJlcyAmIGZlYXR1cmUpKQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l
dGRldl9XQVJOKHVwcGVyLCAiZmFpbGVkIHRvIGRpc2FibGUKJXBORiBvbiAlcyFcbiIsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmZlYXR1cmUsIGxvd2VyLT5u
YW1lKTsKLSAgICAgICAgICAgICAgICAgICAgICAgZWxzZQotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG5ldGRldl9mZWF0dXJlc19jaGFuZ2UobG93ZXIpOworICAgICAgIGZvciAoaSA9
IDA7IGkgPCBORVRERVZfRkVBVFVSRV9EV09SRFM7IGkrKykgeworICAgICAgICAgICAgICAgZm9y
X2VhY2hfbmV0ZGV2X2ZlYXR1cmUodXBwZXJfZGlzYWJsZXMsIGZlYXR1cmVfYml0KSB7CisgICAg
ICAgICAgICAgICAgICAgICAgIGZlYXR1cmUgPSBfX05FVElGX0ZfQklUKGZlYXR1cmVfYml0KTsK
KyAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoZmVhdHVyZXNbaV0gJiBmZWF0dXJlKSAmJgor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgKGxvd2VyLT5mZWF0dXJlc1tpXSAmIGZlYXR1cmUp
KSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2RiZyh1cHBlciwgIkRp
c2FibGluZwpmZWF0dXJlWyV1XSAlcE5GIG9uIGxvd2VyIGRldiAlcy5cbiIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCAmZmVhdHVyZSwgbG93ZXItPm5hbWUp
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyLT53YW50ZWRfZmVhdHVyZXNb
aV0gJj0gfmZlYXR1cmVbaV07CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19uZXRk
ZXZfdXBkYXRlX2ZlYXR1cmVzKGxvd2VyKTsKKworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGlmICh1bmxpa2VseShsb3dlci0+ZmVhdHVyZXNbaV0gJiBmZWF0dXJlKSkKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9XQVJOKHVwcGVyLCAiZmFpbGVk
IHRvCmRpc2FibGUgZmVhdHVyZVsldV0gJXBORiBvbiAlcyFcbiIsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCAmZmVhdHVyZSwgbG93ZXItPm5h
bWUpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc19jaGFuZ2UobG93ZXIpOwor
ICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogfQoK
LXN0YXRpYyBuZXRkZXZfZmVhdHVyZXNfdCBuZXRkZXZfZml4X2ZlYXR1cmVzKHN0cnVjdCBuZXRf
ZGV2aWNlICpkZXYsCi0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVhdHVyZXMpCitzdGF0aWMg
dm9pZCBuZXRkZXZfZml4X2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgKmZlYXR1cmVzKQogewog
ICAgICAgIC8qIEZpeCBpbGxlZ2FsIGNoZWNrc3VtIGNvbWJpbmF0aW9ucyAqLwotICAgICAgIGlm
ICgoZmVhdHVyZXMgJiBORVRJRl9GX0hXX0NTVU0pICYmCi0gICAgICAgICAgIChmZWF0dXJlcyAm
IChORVRJRl9GX0lQX0NTVU18TkVUSUZfRl9JUFY2X0NTVU0pKSkgeworICAgICAgIGlmICgoZmVh
dHVyZXNbMF0gJiBORVRJRl9GX0hXX0NTVU0pICYmCisgICAgICAgICAgIChmZWF0dXJlc1swXSAm
IChORVRJRl9GX0lQX0NTVU0gfCBORVRJRl9GX0lQVjZfQ1NVTSkpKSB7CiAgICAgICAgICAgICAg
ICBuZXRkZXZfd2FybihkZXYsICJtaXhlZCBIVyBhbmQgSVAgY2hlY2tzdW0gc2V0dGluZ3MuXG4i
KTsKLSAgICAgICAgICAgICAgIGZlYXR1cmVzICY9IH4oTkVUSUZfRl9JUF9DU1VNfE5FVElGX0Zf
SVBWNl9DU1VNKTsKKyAgICAgICAgICAgICAgIGZlYXR1cmVzWzBdICY9IH4oTkVUSUZfRl9JUF9D
U1VNIHwgTkVUSUZfRl9JUFY2X0NTVU0pOwogICAgICAgIH0KCiAgICAgICAgLyogVFNPIHJlcXVp
cmVzIHRoYXQgU0cgaXMgcHJlc2VudCBhcyB3ZWxsLiAqLwotICAgICAgIGlmICgoZmVhdHVyZXMg
JiBORVRJRl9GX0FMTF9UU08pICYmICEoZmVhdHVyZXMgJiBORVRJRl9GX1NHKSkgeworICAgICAg
IGlmICgoZmVhdHVyZXNbMF0gJiBORVRJRl9GX0FMTF9UU08pICYmICEoZmVhdHVyZXNbMF0gJiBO
RVRJRl9GX1NHKSkgewogICAgICAgICAgICAgICAgbmV0ZGV2X2RiZyhkZXYsICJEcm9wcGluZyBU
U08gZmVhdHVyZXMgc2luY2Ugbm8gU0cgZmVhdHVyZS5cbiIpOwotICAgICAgICAgICAgICAgZmVh
dHVyZXMgJj0gfk5FVElGX0ZfQUxMX1RTTzsKKyAgICAgICAgICAgICAgIGZlYXR1cmVzWzBdICY9
IH5ORVRJRl9GX0FMTF9UU087CiAgICAgICAgfQoKLSAgICAgICBpZiAoKGZlYXR1cmVzICYgTkVU
SUZfRl9UU08pICYmICEoZmVhdHVyZXMgJiBORVRJRl9GX0hXX0NTVU0pICYmCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhKGZlYXR1cmVzICYgTkVUSUZfRl9JUF9DU1VN
KSkgeworICAgICAgIGlmICgoZmVhdHVyZXNbMF0gJiBORVRJRl9GX1RTTykgJiYgIShmZWF0dXJl
c1swXSAmIE5FVElGX0ZfSFdfQ1NVTSkgJiYKKyAgICAgICAgICAgIShmZWF0dXJlc1swXSAmIE5F
VElGX0ZfSVBfQ1NVTSkpIHsKICAgICAgICAgICAgICAgIG5ldGRldl9kYmcoZGV2LCAiRHJvcHBp
bmcgVFNPIGZlYXR1cmVzIHNpbmNlIG5vIENTVU0KZmVhdHVyZS5cbiIpOwotICAgICAgICAgICAg
ICAgZmVhdHVyZXMgJj0gfk5FVElGX0ZfVFNPOwotICAgICAgICAgICAgICAgZmVhdHVyZXMgJj0g
fk5FVElGX0ZfVFNPX0VDTjsKKyAgICAgICAgICAgICAgIGZlYXR1cmVzWzBdICY9IH5ORVRJRl9G
X1RTTzsKKyAgICAgICAgICAgICAgIGZlYXR1cmVzWzBdICY9IH5ORVRJRl9GX1RTT19FQ047CiAg
ICAgICAgfQoKLSAgICAgICBpZiAoKGZlYXR1cmVzICYgTkVUSUZfRl9UU082KSAmJiAhKGZlYXR1
cmVzICYgTkVUSUZfRl9IV19DU1VNKSAmJgotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICEoZmVhdHVyZXMgJiBORVRJRl9GX0lQVjZfQ1NVTSkpIHsKKyAgICAgICBpZiAo
KGZlYXR1cmVzWzBdICYgTkVUSUZfRl9UU082KSAmJiAhKGZlYXR1cmVzWzBdICYgTkVUSUZfRl9I
V19DU1VNKSAmJgorICAgICAgICAgICAhKGZlYXR1cmVzWzBdICYgTkVUSUZfRl9JUFY2X0NTVU0p
KSB7CiAgICAgICAgICAgICAgICBuZXRkZXZfZGJnKGRldiwgIkRyb3BwaW5nIFRTTzYgZmVhdHVy
ZXMgc2luY2Ugbm8gQ1NVTQpmZWF0dXJlLlxuIik7Ci0gICAgICAgICAgICAgICBmZWF0dXJlcyAm
PSB+TkVUSUZfRl9UU082OworICAgICAgICAgICAgICAgZmVhdHVyZXNbMF0gJj0gfk5FVElGX0Zf
VFNPNjsKICAgICAgICB9CgogICAgICAgIC8qIFRTTyB3aXRoIElQdjQgSUQgbWFuZ2xpbmcgcmVx
dWlyZXMgSVB2NCBUU08gYmUgZW5hYmxlZCAqLwotICAgICAgIGlmICgoZmVhdHVyZXMgJiBORVRJ
Rl9GX1RTT19NQU5HTEVJRCkgJiYgIShmZWF0dXJlcyAmIE5FVElGX0ZfVFNPKSkKLSAgICAgICAg
ICAgICAgIGZlYXR1cmVzICY9IH5ORVRJRl9GX1RTT19NQU5HTEVJRDsKKyAgICAgICBpZiAoKGZl
YXR1cmVzWzBdICYgTkVUSUZfRl9UU09fTUFOR0xFSUQpICYmCisgICAgICAgICAgICEoZmVhdHVy
ZXNbMF0gJiBORVRJRl9GX1RTTykpCisgICAgICAgICAgICAgICBmZWF0dXJlc1swXSAmPSB+TkVU
SUZfRl9UU09fTUFOR0xFSUQ7CgogICAgICAgIC8qIFRTTyBFQ04gcmVxdWlyZXMgdGhhdCBUU08g
aXMgcHJlc2VudCBhcyB3ZWxsLiAqLwotICAgICAgIGlmICgoZmVhdHVyZXMgJiBORVRJRl9GX0FM
TF9UU08pID09IE5FVElGX0ZfVFNPX0VDTikKLSAgICAgICAgICAgICAgIGZlYXR1cmVzICY9IH5O
RVRJRl9GX1RTT19FQ047CisgICAgICAgaWYgKChmZWF0dXJlc1swXSAmIE5FVElGX0ZfQUxMX1RT
TykgPT0gTkVUSUZfRl9UU09fRUNOKQorICAgICAgICAgICAgICAgZmVhdHVyZXNbMF0gJj0gfk5F
VElGX0ZfVFNPX0VDTjsKCiAgICAgICAgLyogU29mdHdhcmUgR1NPIGRlcGVuZHMgb24gU0cuICov
Ci0gICAgICAgaWYgKChmZWF0dXJlcyAmIE5FVElGX0ZfR1NPKSAmJiAhKGZlYXR1cmVzICYgTkVU
SUZfRl9TRykpIHsKKyAgICAgICBpZiAoKGZlYXR1cmVzWzBdICYgTkVUSUZfRl9HU08pICYmICEo
ZmVhdHVyZXNbMF0gJiBORVRJRl9GX1NHKSkgewogICAgICAgICAgICAgICAgbmV0ZGV2X2RiZyhk
ZXYsICJEcm9wcGluZyBORVRJRl9GX0dTTyBzaW5jZSBubyBTRyBmZWF0dXJlLlxuIik7Ci0gICAg
ICAgICAgICAgICBmZWF0dXJlcyAmPSB+TkVUSUZfRl9HU087CisgICAgICAgICAgICAgICBmZWF0
dXJlc1swXSAmPSB+TkVUSUZfRl9HU087CiAgICAgICAgfQoKICAgICAgICAvKiBHU08gcGFydGlh
bCBmZWF0dXJlcyByZXF1aXJlIEdTTyBwYXJ0aWFsIGJlIHNldCAqLwotICAgICAgIGlmICgoZmVh
dHVyZXMgJiBkZXYtPmdzb19wYXJ0aWFsX2ZlYXR1cmVzKSAmJgotICAgICAgICAgICAhKGZlYXR1
cmVzICYgTkVUSUZfRl9HU09fUEFSVElBTCkpIHsKKyAgICAgICBpZiAoKGZlYXR1cmVzWzBdICYg
ZGV2LT5nc29fcGFydGlhbF9mZWF0dXJlcykgJiYKKyAgICAgICAgICAgIShmZWF0dXJlc1swXSAm
IE5FVElGX0ZfR1NPX1BBUlRJQUwpKSB7CiAgICAgICAgICAgICAgICBuZXRkZXZfZGJnKGRldiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIkRyb3BwaW5nIHBhcnRpYWxseSBzdXBwb3J0ZWQg
R1NPIGZlYXR1cmVzCnNpbmNlIG5vIEdTTyBwYXJ0aWFsLlxuIik7Ci0gICAgICAgICAgICAgICBm
ZWF0dXJlcyAmPSB+ZGV2LT5nc29fcGFydGlhbF9mZWF0dXJlczsKKyAgICAgICAgICAgICAgIGZl
YXR1cmVzWzBdICY9IH5kZXYtPmdzb19wYXJ0aWFsX2ZlYXR1cmVzOwogICAgICAgIH0KCi0gICAg
ICAgaWYgKCEoZmVhdHVyZXMgJiBORVRJRl9GX1JYQ1NVTSkpIHsKKyAgICAgICBpZiAoIShmZWF0
dXJlc1swXSAmIE5FVElGX0ZfUlhDU1VNKSkgewogICAgICAgICAgICAgICAgLyogTkVUSUZfRl9H
Uk9fSFcgaW1wbGllcyBkb2luZyBSWENTVU0gc2luY2UgZXZlcnkgcGFja2V0CiAgICAgICAgICAg
ICAgICAgKiBzdWNjZXNzZnVsbHkgbWVyZ2VkIGJ5IGhhcmR3YXJlIG11c3QgYWxzbyBoYXZlIHRo
ZQogICAgICAgICAgICAgICAgICogY2hlY2tzdW0gdmVyaWZpZWQgYnkgaGFyZHdhcmUuICBJZiB0
aGUgdXNlciBkb2VzIG5vdAogICAgICAgICAgICAgICAgICogd2FudCB0byBlbmFibGUgUlhDU1VN
LCBsb2dpY2FsbHksIHdlIHNob3VsZCBkaXNhYmxlIEdST19IVy4KICAgICAgICAgICAgICAgICAq
LwotICAgICAgICAgICAgICAgaWYgKGZlYXR1cmVzICYgTkVUSUZfRl9HUk9fSFcpIHsKKyAgICAg
ICAgICAgICAgIGlmIChmZWF0dXJlc1swXSAmIE5FVElGX0ZfR1JPX0hXKSB7CiAgICAgICAgICAg
ICAgICAgICAgICAgIG5ldGRldl9kYmcoZGV2LCAiRHJvcHBpbmcgTkVUSUZfRl9HUk9fSFcgc2lu
Y2UKbm8gUlhDU1VNIGZlYXR1cmUuXG4iKTsKLSAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVy
ZXMgJj0gfk5FVElGX0ZfR1JPX0hXOworICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1sw
XSAmPSB+TkVUSUZfRl9HUk9fSFc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg
ICAvKiBMUk8vSFctR1JPIGZlYXR1cmVzIGNhbm5vdCBiZSBjb21iaW5lZCB3aXRoIFJYLUZDUyAq
LwotICAgICAgIGlmIChmZWF0dXJlcyAmIE5FVElGX0ZfUlhGQ1MpIHsKLSAgICAgICAgICAgICAg
IGlmIChmZWF0dXJlcyAmIE5FVElGX0ZfTFJPKSB7CisgICAgICAgaWYgKGZlYXR1cmVzWzBdICYg
TkVUSUZfRl9SWEZDUykgeworICAgICAgICAgICAgICAgaWYgKGZlYXR1cmVzWzBdICYgTkVUSUZf
Rl9MUk8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2RiZyhkZXYsICJEcm9wcGlu
ZyBMUk8gZmVhdHVyZSBzaW5jZQpSWC1GQ1MgaXMgcmVxdWVzdGVkLlxuIik7Ci0gICAgICAgICAg
ICAgICAgICAgICAgIGZlYXR1cmVzICY9IH5ORVRJRl9GX0xSTzsKKyAgICAgICAgICAgICAgICAg
ICAgICAgZmVhdHVyZXNbMF0gJj0gfk5FVElGX0ZfTFJPOwogICAgICAgICAgICAgICAgfQoKLSAg
ICAgICAgICAgICAgIGlmIChmZWF0dXJlcyAmIE5FVElGX0ZfR1JPX0hXKSB7CisgICAgICAgICAg
ICAgICBpZiAoZmVhdHVyZXNbMF0gJiBORVRJRl9GX0dST19IVykgewogICAgICAgICAgICAgICAg
ICAgICAgICBuZXRkZXZfZGJnKGRldiwgIkRyb3BwaW5nIEhXLUdSTyBmZWF0dXJlIHNpbmNlClJY
LUZDUyBpcyByZXF1ZXN0ZWQuXG4iKTsKLSAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXMg
Jj0gfk5FVElGX0ZfR1JPX0hXOworICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1swXSAm
PSB+TkVUSUZfRl9HUk9fSFc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKLSAgICAgICBp
ZiAoZmVhdHVyZXMgJiBORVRJRl9GX0hXX1RMU19UWCkgewotICAgICAgICAgICAgICAgYm9vbCBp
cF9jc3VtID0gKGZlYXR1cmVzICYgKE5FVElGX0ZfSVBfQ1NVTSB8Ck5FVElGX0ZfSVBWNl9DU1VN
KSkgPT0KKyAgICAgICBpZiAoZmVhdHVyZXNbMF0gJiBORVRJRl9GX0hXX1RMU19UWCkgeworICAg
ICAgICAgICAgICAgYm9vbCBpcF9jc3VtID0gKGZlYXR1cmVzWzBdICYgKE5FVElGX0ZfSVBfQ1NV
TSB8Ck5FVElGX0ZfSVBWNl9DU1VNKSkgPT0KICAgICAgICAgICAgICAgICAgICAgICAgKE5FVElG
X0ZfSVBfQ1NVTSB8IE5FVElGX0ZfSVBWNl9DU1VNKTsKLSAgICAgICAgICAgICAgIGJvb2wgaHdf
Y3N1bSA9IGZlYXR1cmVzICYgTkVUSUZfRl9IV19DU1VNOworICAgICAgICAgICAgICAgYm9vbCBo
d19jc3VtID0gZmVhdHVyZXNbMF0gJiBORVRJRl9GX0hXX0NTVU07CgogICAgICAgICAgICAgICAg
aWYgKCFpcF9jc3VtICYmICFod19jc3VtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRl
dl9kYmcoZGV2LCAiRHJvcHBpbmcgVExTIFRYIEhXIG9mZmxvYWQKZmVhdHVyZSBzaW5jZSBubyBD
U1VNIGZlYXR1cmUuXG4iKTsKLSAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgJj0gfk5F
VElGX0ZfSFdfVExTX1RYOworICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1swXSAmPSB+
TkVUSUZfRl9IV19UTFNfVFg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKLSAgICAgICBp
ZiAoKGZlYXR1cmVzICYgTkVUSUZfRl9IV19UTFNfUlgpICYmICEoZmVhdHVyZXMgJiBORVRJRl9G
X1JYQ1NVTSkpIHsKKyAgICAgICBpZiAoKGZlYXR1cmVzWzBdICYgTkVUSUZfRl9IV19UTFNfUlgp
ICYmCisgICAgICAgICAgICEoZmVhdHVyZXNbMF0gJiBORVRJRl9GX1JYQ1NVTSkpIHsKICAgICAg
ICAgICAgICAgIG5ldGRldl9kYmcoZGV2LCAiRHJvcHBpbmcgVExTIFJYIEhXIG9mZmxvYWQgZmVh
dHVyZQpzaW5jZSBubyBSWENTVU0gZmVhdHVyZS5cbiIpOwotICAgICAgICAgICAgICAgZmVhdHVy
ZXMgJj0gfk5FVElGX0ZfSFdfVExTX1JYOworICAgICAgICAgICAgICAgZmVhdHVyZXNbMF0gJj0g
fk5FVElGX0ZfSFdfVExTX1JYOwogICAgICAgIH0KLQotICAgICAgIHJldHVybiBmZWF0dXJlczsK
IH0KCiBpbnQgX19uZXRkZXZfdXBkYXRlX2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYp
CiB7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVhdHVyZXNbTkVUREVWX0ZFQVRVUkVfRFdP
UkRTXTsKICAgICAgICBzdHJ1Y3QgbmV0X2RldmljZSAqdXBwZXIsICpsb3dlcjsKLSAgICAgICBu
ZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlczsKICAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkICppdGVy
OworICAgICAgIHVuc2lnbmVkIGludCBpOwogICAgICAgIGludCBlcnIgPSAtMTsKCiAgICAgICAg
QVNTRVJUX1JUTkwoKTsKCi0gICAgICAgZmVhdHVyZXMgPSBuZXRkZXZfZ2V0X3dhbnRlZF9mZWF0
dXJlcyhkZXYpOworICAgICAgIG5ldGRldl9nZXRfd2FudGVkX2ZlYXR1cmVzKGRldiwgZmVhdHVy
ZXMpOwoKICAgICAgICBpZiAoZGV2LT5uZXRkZXZfb3BzLT5uZG9fZml4X2ZlYXR1cmVzKQotICAg
ICAgICAgICAgICAgZmVhdHVyZXMgPSBkZXYtPm5ldGRldl9vcHMtPm5kb19maXhfZmVhdHVyZXMo
ZGV2LCBmZWF0dXJlcyk7CisgICAgICAgICAgICAgICBkZXYtPm5ldGRldl9vcHMtPm5kb19maXhf
ZmVhdHVyZXMoZGV2LCBmZWF0dXJlcyk7CgogICAgICAgIC8qIGRyaXZlciBtaWdodCBiZSBsZXNz
IHN0cmljdCBhYm91dCBmZWF0dXJlIGRlcGVuZGVuY2llcyAqLwotICAgICAgIGZlYXR1cmVzID0g
bmV0ZGV2X2ZpeF9mZWF0dXJlcyhkZXYsIGZlYXR1cmVzKTsKKyAgICAgICBuZXRkZXZfZml4X2Zl
YXR1cmVzKGRldiwgZmVhdHVyZXMpOwoKICAgICAgICAvKiBzb21lIGZlYXR1cmVzIGNhbid0IGJl
IGVuYWJsZWQgaWYgdGhleSdyZSBvZmYgb24gYW4gdXBwZXIgZGV2aWNlICovCiAgICAgICAgbmV0
ZGV2X2Zvcl9lYWNoX3VwcGVyX2Rldl9yY3UoZGV2LCB1cHBlciwgaXRlcikKLSAgICAgICAgICAg
ICAgIGZlYXR1cmVzID0gbmV0ZGV2X3N5bmNfdXBwZXJfZmVhdHVyZXMoZGV2LCB1cHBlciwgZmVh
dHVyZXMpOworICAgICAgICAgICAgICAgbmV0ZGV2X3N5bmNfdXBwZXJfZmVhdHVyZXMoZGV2LCB1
cHBlciwgZmVhdHVyZXMpOwoKLSAgICAgICBpZiAoZGV2LT5mZWF0dXJlcyA9PSBmZWF0dXJlcykK
KyAgICAgICBpZiAobmV0ZGV2X2ZlYXR1cmVzX2VxdWFsKGRldi0+ZmVhdHVyZXMsIGZlYXR1cmVz
KSkKICAgICAgICAgICAgICAgIGdvdG8gc3luY19sb3dlcjsKCi0gICAgICAgbmV0ZGV2X2RiZyhk
ZXYsICJGZWF0dXJlcyBjaGFuZ2VkOiAlcE5GIC0+ICVwTkZcbiIsCi0gICAgICAgICAgICAgICAm
ZGV2LT5mZWF0dXJlcywgJmZlYXR1cmVzKTsKKyAgICAgICBmb3IgKGkgPSAwOyBpIDwgTkVUREVW
X0ZFQVRVUkVfRFdPUkRTOyBpKyspCisgICAgICAgICAgICAgICBuZXRkZXZfZGJnKGRldiwgIkZl
YXR1cmVzWyV1XSBjaGFuZ2VkOiAlcE5GIC0+ICVwTkZcbiIsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgIGksICZkZXYtPmZlYXR1cmVzW2ldLCAmZmVhdHVyZXNbaV0pOwoKICAgICAgICBpZiAo
ZGV2LT5uZXRkZXZfb3BzLT5uZG9fc2V0X2ZlYXR1cmVzKQogICAgICAgICAgICAgICAgZXJyID0g
ZGV2LT5uZXRkZXZfb3BzLT5uZG9fc2V0X2ZlYXR1cmVzKGRldiwgZmVhdHVyZXMpOwpAQCAtOTk3
MSw5ICs5OTc5LDEwIEBAIGludCBfX25ldGRldl91cGRhdGVfZmVhdHVyZXMoc3RydWN0IG5ldF9k
ZXZpY2UgKmRldikKICAgICAgICAgICAgICAgIGVyciA9IDA7CgogICAgICAgIGlmICh1bmxpa2Vs
eShlcnIgPCAwKSkgewotICAgICAgICAgICAgICAgbmV0ZGV2X2VycihkZXYsCi0gICAgICAgICAg
ICAgICAgICAgICAgICJzZXRfZmVhdHVyZXMoKSBmYWlsZWQgKCVkKTsgd2FudGVkICVwTkYsIGxl
ZnQgJXBORlxuIiwKLSAgICAgICAgICAgICAgICAgICAgICAgZXJyLCAmZmVhdHVyZXMsICZkZXYt
PmZlYXR1cmVzKTsKKyAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBORVRERVZfRkVBVFVS
RV9EV09SRFM7IGkrKykKKyAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2VycihkZXYsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldF9mZWF0dXJlcygpIGZhaWxlZCAo
JWQpOwp3YW50ZWRbJXVdICVwTkYsIGxlZnRbJXVdICVwTkZcbiIsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZXJyLCBpLCAmZmVhdHVyZXNbaV0sIGksICZkZXYtPmZlYXR1cmVz
W2ldKTsKICAgICAgICAgICAgICAgIC8qIHJldHVybiBub24tMCBzaW5jZSBzb21lIGZlYXR1cmVz
IG1pZ2h0IGhhdmUgY2hhbmdlZCBhbmQKICAgICAgICAgICAgICAgICAqIGl0J3MgYmV0dGVyIHRv
IGZpcmUgYSBzcHVyaW91cyBub3RpZmljYXRpb24gdGhhbiBtaXNzIGl0CiAgICAgICAgICAgICAg
ICAgKi8KQEAgLTk5ODgsOSArOTk5NywxMCBAQCBpbnQgX19uZXRkZXZfdXBkYXRlX2ZlYXR1cmVz
KHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpCiAgICAgICAgICAgICAgICBuZXRkZXZfc3luY19sb3dl
cl9mZWF0dXJlcyhkZXYsIGxvd2VyLCBmZWF0dXJlcyk7CgogICAgICAgIGlmICghZXJyKSB7Ci0g
ICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBkaWZmID0gZmVhdHVyZXMgXiBkZXYtPmZl
YXR1cmVzOworICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZGlmZltORVRERVZfRkVB
VFVSRV9EV09SRFNdOwoKLSAgICAgICAgICAgICAgIGlmIChkaWZmICYgTkVUSUZfRl9SWF9VRFBf
VFVOTkVMX1BPUlQpIHsKKyAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc194b3IoZGlmZiwg
ZmVhdHVyZXMsIGRldi0+ZmVhdHVyZXMpOworICAgICAgICAgICAgICAgaWYgKGRpZmZbMF0gJiBO
RVRJRl9GX1JYX1VEUF9UVU5ORUxfUE9SVCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKiB1
ZHBfdHVubmVsX3tnZXQsZHJvcH1fcnhfaW5mbyBib3RoIG5lZWQKICAgICAgICAgICAgICAgICAg
ICAgICAgICogTkVUSUZfRl9SWF9VRFBfVFVOTkVMX1BPUlQgZW5hYmxlZCBvbiB0aGUKICAgICAg
ICAgICAgICAgICAgICAgICAgICogZGV2aWNlLCBvciB0aGV5IHdvbid0IGRvIGFueXRoaW5nLgpA
QCAtOTk5OCwzMyArMTAwMDgsMzMgQEAgaW50IF9fbmV0ZGV2X3VwZGF0ZV9mZWF0dXJlcyhzdHJ1
Y3QgbmV0X2RldmljZSAqZGV2KQogICAgICAgICAgICAgICAgICAgICAgICAgKiAqYmVmb3JlKiBj
YWxsaW5nIHVkcF90dW5uZWxfZ2V0X3J4X2luZm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAq
IGJ1dCAqYWZ0ZXIqIGNhbGxpbmcgdWRwX3R1bm5lbF9kcm9wX3J4X2luZm8uCiAgICAgICAgICAg
ICAgICAgICAgICAgICAqLwotICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmVhdHVyZXMgJiBO
RVRJRl9GX1JYX1VEUF9UVU5ORUxfUE9SVCkgewotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGRldi0+ZmVhdHVyZXMgPSBmZWF0dXJlczsKKyAgICAgICAgICAgICAgICAgICAgICAgaWYg
KGZlYXR1cmVzWzBdICYgTkVUSUZfRl9SWF9VRFBfVFVOTkVMX1BPUlQpIHsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBkZXYtPmZlYXR1cmVzWzBdID0gZmVhdHVyZXNbMF07CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdWRwX3R1bm5lbF9nZXRfcnhfaW5mbyhkZXYpOwog
ICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVkcF90dW5uZWxfZHJvcF9yeF9pbmZvKGRldik7CiAgICAgICAgICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgIH0KCi0gICAgICAgICAgICAgICBpZiAoZGlmZiAmIE5FVElG
X0ZfSFdfVkxBTl9DVEFHX0ZJTFRFUikgewotICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmVh
dHVyZXMgJiBORVRJRl9GX0hXX1ZMQU5fQ1RBR19GSUxURVIpIHsKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBkZXYtPmZlYXR1cmVzID0gZmVhdHVyZXM7CisgICAgICAgICAgICAgICBp
ZiAoZGlmZlswXSAmIE5FVElGX0ZfSFdfVkxBTl9DVEFHX0ZJTFRFUikgeworICAgICAgICAgICAg
ICAgICAgICAgICBpZiAoZmVhdHVyZXNbMF0gJiBORVRJRl9GX0hXX1ZMQU5fQ1RBR19GSUxURVIp
IHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmZlYXR1cmVzWzBdID0gZmVh
dHVyZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyIHw9IHZsYW5fZ2V0
X3J4X2N0YWdfZmlsdGVyX2luZm8oZGV2KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNl
IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bGFuX2Ryb3BfcnhfY3RhZ19maWx0
ZXJfaW5mbyhkZXYpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9
CgotICAgICAgICAgICAgICAgaWYgKGRpZmYgJiBORVRJRl9GX0hXX1ZMQU5fU1RBR19GSUxURVIp
IHsKKyAgICAgICAgICAgICAgIGlmIChkaWZmWzBdICYgTkVUSUZfRl9IV19WTEFOX1NUQUdfRklM
VEVSKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZWF0dXJlcyAmIE5FVElGX0ZfSFdf
VkxBTl9TVEFHX0ZJTFRFUikgewotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+
ZmVhdHVyZXMgPSBmZWF0dXJlczsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYt
PmZlYXR1cmVzWzBdID0gZmVhdHVyZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZXJyIHw9IHZsYW5fZ2V0X3J4X3N0YWdfZmlsdGVyX2luZm8oZGV2KTsKICAgICAgICAgICAg
ICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bGFu
X2Ryb3Bfcnhfc3RhZ19maWx0ZXJfaW5mbyhkZXYpOwogICAgICAgICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICB9CgotICAgICAgICAgICAgICAgZGV2LT5mZWF0dXJlcyA9IGZlYXR1
cmVzOworICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2NvcHkoZGV2LT5mZWF0dXJlcywg
ZmVhdHVyZXMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVyciA8IDAgPyAwIDogMTsKQEAg
LTEwMjEzLDcgKzEwMjIzLDcgQEAgaW50IHJlZ2lzdGVyX25ldGRldmljZShzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2KQogICAgICAgIGludCByZXQ7CiAgICAgICAgc3RydWN0IG5ldCAqbmV0ID0gZGV2
X25ldChkZXYpOwoKLSAgICAgICBCVUlMRF9CVUdfT04oc2l6ZW9mKG5ldGRldl9mZWF0dXJlc190
KSAqIEJJVFNfUEVSX0JZVEUgPAorICAgICAgIEJVSUxEX0JVR19PTihzaXplb2YoZGV2LT5mZWF0
dXJlcykgKiBCSVRTX1BFUl9CWVRFIDwKICAgICAgICAgICAgICAgICAgICAgTkVUREVWX0ZFQVRV
UkVfQ09VTlQpOwogICAgICAgIEJVR19PTihkZXZfYm9vdF9waGFzZSk7CiAgICAgICAgQVNTRVJU
X1JUTkwoKTsKQEAgLTEwMjUwLDcgKzEwMjYwLDcgQEAgaW50IHJlZ2lzdGVyX25ldGRldmljZShz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCi0gICAg
ICAgaWYgKCgoZGV2LT5od19mZWF0dXJlcyB8IGRldi0+ZmVhdHVyZXMpICYKKyAgICAgICBpZiAo
KChkZXYtPmh3X2ZlYXR1cmVzWzBdIHwgZGV2LT5mZWF0dXJlc1swXSkgJgogICAgICAgICAgICAg
TkVUSUZfRl9IV19WTEFOX0NUQUdfRklMVEVSKSAmJgogICAgICAgICAgICAoIWRldi0+bmV0ZGV2
X29wcy0+bmRvX3ZsYW5fcnhfYWRkX3ZpZCB8fAogICAgICAgICAgICAgIWRldi0+bmV0ZGV2X29w
cy0+bmRvX3ZsYW5fcnhfa2lsbF92aWQpKSB7CkBAIC0xMDI2OCw0NCArMTAyNzgsNDYgQEAgaW50
IHJlZ2lzdGVyX25ldGRldmljZShzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogICAgICAgIC8qIFRy
YW5zZmVyIGNoYW5nZWFibGUgZmVhdHVyZXMgdG8gd2FudGVkX2ZlYXR1cmVzIGFuZCBlbmFibGUK
ICAgICAgICAgKiBzb2Z0d2FyZSBvZmZsb2FkcyAoR1NPIGFuZCBHUk8pLgogICAgICAgICAqLwot
ICAgICAgIGRldi0+aHdfZmVhdHVyZXMgfD0gKE5FVElGX0ZfU09GVF9GRUFUVVJFUyB8IE5FVElG
X0ZfU09GVF9GRUFUVVJFU19PRkYpOwotICAgICAgIGRldi0+ZmVhdHVyZXMgfD0gTkVUSUZfRl9T
T0ZUX0ZFQVRVUkVTOworICAgICAgIGRldi0+aHdfZmVhdHVyZXNbMF0gfD0KKyAgICAgICAgICAg
ICAgICAgICAgICAgKE5FVElGX0ZfU09GVF9GRUFUVVJFUyB8IE5FVElGX0ZfU09GVF9GRUFUVVJF
U19PRkYpOworICAgICAgIGRldi0+ZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9TT0ZUX0ZFQVRVUkVT
OwoKICAgICAgICBpZiAoZGV2LT51ZHBfdHVubmVsX25pY19pbmZvKSB7Ci0gICAgICAgICAgICAg
ICBkZXYtPmZlYXR1cmVzIHw9IE5FVElGX0ZfUlhfVURQX1RVTk5FTF9QT1JUOwotICAgICAgICAg
ICAgICAgZGV2LT5od19mZWF0dXJlcyB8PSBORVRJRl9GX1JYX1VEUF9UVU5ORUxfUE9SVDsKKyAg
ICAgICAgICAgICAgIGRldi0+ZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9SWF9VRFBfVFVOTkVMX1BP
UlQ7CisgICAgICAgICAgICAgICBkZXYtPmh3X2ZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfUlhfVURQ
X1RVTk5FTF9QT1JUOwogICAgICAgIH0KCi0gICAgICAgZGV2LT53YW50ZWRfZmVhdHVyZXMgPSBk
ZXYtPmZlYXR1cmVzICYgZGV2LT5od19mZWF0dXJlczsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNf
YW5kKGRldi0+d2FudGVkX2ZlYXR1cmVzLCBkZXYtPmZlYXR1cmVzLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZGV2LT5od19mZWF0dXJlcyk7CgogICAgICAgIGlmICghKGRldi0+ZmxhZ3Mg
JiBJRkZfTE9PUEJBQ0spKQotICAgICAgICAgICAgICAgZGV2LT5od19mZWF0dXJlcyB8PSBORVRJ
Rl9GX05PQ0FDSEVfQ09QWTsKKyAgICAgICAgICAgICAgIGRldi0+aHdfZmVhdHVyZXNbMF0gfD0g
TkVUSUZfRl9OT0NBQ0hFX0NPUFk7CgogICAgICAgIC8qIElmIElQdjQgVENQIHNlZ21lbnRhdGlv
biBvZmZsb2FkIGlzIHN1cHBvcnRlZCB3ZSBzaG91bGQgYWxzbwogICAgICAgICAqIGFsbG93IHRo
ZSBkZXZpY2UgdG8gZW5hYmxlIHNlZ21lbnRpbmcgdGhlIGZyYW1lIHdpdGggdGhlIG9wdGlvbgog
ICAgICAgICAqIG9mIGlnbm9yaW5nIGEgc3RhdGljIElQIElEIHZhbHVlLiAgVGhpcyBkb2Vzbid0
IGVuYWJsZSB0aGUKICAgICAgICAgKiBmZWF0dXJlIGl0c2VsZiBidXQgYWxsb3dzIHRoZSB1c2Vy
IHRvIGVuYWJsZSBpdCBsYXRlci4KICAgICAgICAgKi8KLSAgICAgICBpZiAoZGV2LT5od19mZWF0
dXJlcyAmIE5FVElGX0ZfVFNPKQotICAgICAgICAgICAgICAgZGV2LT5od19mZWF0dXJlcyB8PSBO
RVRJRl9GX1RTT19NQU5HTEVJRDsKLSAgICAgICBpZiAoZGV2LT52bGFuX2ZlYXR1cmVzICYgTkVU
SUZfRl9UU08pCi0gICAgICAgICAgICAgICBkZXYtPnZsYW5fZmVhdHVyZXMgfD0gTkVUSUZfRl9U
U09fTUFOR0xFSUQ7Ci0gICAgICAgaWYgKGRldi0+bXBsc19mZWF0dXJlcyAmIE5FVElGX0ZfVFNP
KQotICAgICAgICAgICAgICAgZGV2LT5tcGxzX2ZlYXR1cmVzIHw9IE5FVElGX0ZfVFNPX01BTkdM
RUlEOwotICAgICAgIGlmIChkZXYtPmh3X2VuY19mZWF0dXJlcyAmIE5FVElGX0ZfVFNPKQotICAg
ICAgICAgICAgICAgZGV2LT5od19lbmNfZmVhdHVyZXMgfD0gTkVUSUZfRl9UU09fTUFOR0xFSUQ7
CisgICAgICAgaWYgKGRldi0+aHdfZmVhdHVyZXNbMF0gJiBORVRJRl9GX1RTTykKKyAgICAgICAg
ICAgICAgIGRldi0+aHdfZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9UU09fTUFOR0xFSUQ7CisgICAg
ICAgaWYgKGRldi0+dmxhbl9mZWF0dXJlc1swXSAmIE5FVElGX0ZfVFNPKQorICAgICAgICAgICAg
ICAgZGV2LT52bGFuX2ZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfVFNPX01BTkdMRUlEOworICAgICAg
IGlmIChkZXYtPm1wbHNfZmVhdHVyZXNbMF0gJiBORVRJRl9GX1RTTykKKyAgICAgICAgICAgICAg
IGRldi0+bXBsc19mZWF0dXJlc1swXSB8PSBORVRJRl9GX1RTT19NQU5HTEVJRDsKKyAgICAgICBp
ZiAoZGV2LT5od19lbmNfZmVhdHVyZXNbMF0gJiBORVRJRl9GX1RTTykKKyAgICAgICAgICAgICAg
IGRldi0+aHdfZW5jX2ZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfVFNPX01BTkdMRUlEOwoKICAgICAg
ICAvKiBNYWtlIE5FVElGX0ZfSElHSERNQSBpbmhlcml0YWJsZSB0byBWTEFOIGRldmljZXMuCiAg
ICAgICAgICovCi0gICAgICAgZGV2LT52bGFuX2ZlYXR1cmVzIHw9IE5FVElGX0ZfSElHSERNQTsK
KyAgICAgICBkZXYtPnZsYW5fZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9ISUdIRE1BOwoKICAgICAg
ICAvKiBNYWtlIE5FVElGX0ZfU0cgaW5oZXJpdGFibGUgdG8gdHVubmVsIGRldmljZXMuCiAgICAg
ICAgICovCi0gICAgICAgZGV2LT5od19lbmNfZmVhdHVyZXMgfD0gTkVUSUZfRl9TRyB8IE5FVElG
X0ZfR1NPX1BBUlRJQUw7CisgICAgICAgZGV2LT5od19lbmNfZmVhdHVyZXNbMF0gfD0gTkVUSUZf
Rl9TRyB8IE5FVElGX0ZfR1NPX1BBUlRJQUw7CgogICAgICAgIC8qIE1ha2UgTkVUSUZfRl9TRyBp
bmhlcml0YWJsZSB0byBNUExTLgogICAgICAgICAqLwotICAgICAgIGRldi0+bXBsc19mZWF0dXJl
cyB8PSBORVRJRl9GX1NHOworICAgICAgIGRldi0+bXBsc19mZWF0dXJlc1swXSB8PSBORVRJRl9G
X1NHOwoKICAgICAgICByZXQgPSBjYWxsX25ldGRldmljZV9ub3RpZmllcnMoTkVUREVWX1BPU1Rf
SU5JVCwgZGV2KTsKICAgICAgICByZXQgPSBub3RpZmllcl90b19lcnJubyhyZXQpOwpAQCAtMTEx
NDYsNyArMTExNTgsNyBAQCBpbnQgX19kZXZfY2hhbmdlX25ldF9uYW1lc3BhY2Uoc3RydWN0Cm5l
dF9kZXZpY2UgKmRldiwgc3RydWN0IG5ldCAqbmV0LAoKICAgICAgICAvKiBEb24ndCBhbGxvdyBu
YW1lc3BhY2UgbG9jYWwgZGV2aWNlcyB0byBiZSBtb3ZlZC4gKi8KICAgICAgICBlcnIgPSAtRUlO
VkFMOwotICAgICAgIGlmIChkZXYtPmZlYXR1cmVzICYgTkVUSUZfRl9ORVROU19MT0NBTCkKKyAg
ICAgICBpZiAoZGV2LT5mZWF0dXJlc1swXSAmIE5FVElGX0ZfTkVUTlNfTE9DQUwpCiAgICAgICAg
ICAgICAgICBnb3RvIG91dDsKCiAgICAgICAgLyogRW5zdXJlIHRoZSBkZXZpY2UgaGFzIGJlZW4g
cmVnaXN0cmVyZWQgKi8KQEAgLTExNTA2LDcgKzExNTE4LDcgQEAgc3RhdGljIHZvaWQgX19uZXRf
ZXhpdApkZWZhdWx0X2RldmljZV9leGl0KHN0cnVjdCBuZXQgKm5ldCkKICAgICAgICAgICAgICAg
IGNoYXIgZmJfbmFtZVtJRk5BTVNJWl07CgogICAgICAgICAgICAgICAgLyogSWdub3JlIHVubW92
ZWFibGUgZGV2aWNlcyAoaS5lLiBsb29wYmFjaykgKi8KLSAgICAgICAgICAgICAgIGlmIChkZXYt
PmZlYXR1cmVzICYgTkVUSUZfRl9ORVROU19MT0NBTCkKKyAgICAgICAgICAgICAgIGlmIChkZXYt
PmZlYXR1cmVzWzBdICYgTkVUSUZfRl9ORVROU19MT0NBTCkKICAgICAgICAgICAgICAgICAgICAg
ICAgY29udGludWU7CgogICAgICAgICAgICAgICAgLyogTGVhdmUgdmlydHVhbCBkZXZpY2VzIGZv
ciB0aGUgZ2VuZXJpYyBjbGVhbnVwICovCmRpZmYgLS1naXQgYS9uZXQvY29yZS9uZXRwb2xsLmMg
Yi9uZXQvY29yZS9uZXRwb2xsLmMKaW5kZXggMGE2YjA0Ny4uMmMwYWRmNCAxMDA2NDQKLS0tIGEv
bmV0L2NvcmUvbmV0cG9sbC5jCisrKyBiL25ldC9jb3JlL25ldHBvbGwuYwpAQCAtNzQsMTMgKzc0
LDEzIEBAIHN0YXRpYyBuZXRkZXZfdHhfdCBuZXRwb2xsX3N0YXJ0X3htaXQoc3RydWN0IHNrX2J1
ZmYgKnNrYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbmV0
X2RldmljZSAqZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dCBuZXRkZXZfcXVldWUgKnR4cSkKIHsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJl
c1tORVRERVZfRkVBVFVSRV9EV09SRFNdOwogICAgICAgIG5ldGRldl90eF90IHN0YXR1cyA9IE5F
VERFVl9UWF9PSzsKLSAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBmZWF0dXJlczsKCi0gICAgICAg
ZmVhdHVyZXMgPSBuZXRpZl9za2JfZmVhdHVyZXMoc2tiKTsKKyAgICAgICBuZXRpZl9za2JfZmVh
dHVyZXMoc2tiLCBmZWF0dXJlcyk7CgogICAgICAgIGlmIChza2Jfdmxhbl90YWdfcHJlc2VudChz
a2IpICYmCi0gICAgICAgICAgICF2bGFuX2h3X29mZmxvYWRfY2FwYWJsZShmZWF0dXJlcywgc2ti
LT52bGFuX3Byb3RvKSkgeworICAgICAgICAgICAhdmxhbl9od19vZmZsb2FkX2NhcGFibGUoZmVh
dHVyZXNbMF0sIHNrYi0+dmxhbl9wcm90bykpIHsKICAgICAgICAgICAgICAgIHNrYiA9IF9fdmxh
bl9od2FjY2VsX3B1c2hfaW5zaWRlKHNrYik7CiAgICAgICAgICAgICAgICBpZiAodW5saWtlbHko
IXNrYikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyogVGhpcyBpcyBhY3R1YWxseSBhIHBh
Y2tldCBkcm9wLCBidXQgd2UKZGlmZiAtLWdpdCBhL25ldC9ldGh0b29sL2ZlYXR1cmVzLmMgYi9u
ZXQvZXRodG9vbC9mZWF0dXJlcy5jCmluZGV4IDFjOWY0ZGYuLjBlZWRiMTcgMTAwNjQ0Ci0tLSBh
L25ldC9ldGh0b29sL2ZlYXR1cmVzLmMKKysrIGIvbmV0L2V0aHRvb2wvZmVhdHVyZXMuYwpAQCAt
MjUsMTIgKzI1LDEzIEBAIGNvbnN0IHN0cnVjdCBubGFfcG9saWN5IGV0aG5sX2ZlYXR1cmVzX2dl
dF9wb2xpY3lbXSA9IHsKICAgICAgICAgICAgICAgIE5MQV9QT0xJQ1lfTkVTVEVEKGV0aG5sX2hl
YWRlcl9wb2xpY3kpLAogfTsKCi1zdGF0aWMgdm9pZCBldGhubF9mZWF0dXJlc190b19iaXRtYXAz
Mih1MzIgKmRlc3QsIG5ldGRldl9mZWF0dXJlc190IHNyYykKK3N0YXRpYyB2b2lkIGV0aG5sX2Zl
YXR1cmVzX3RvX2JpdG1hcDMyKHUzMiAqZGVzdCwgbmV0ZGV2X2ZlYXR1cmVzX3QgKnNyYykKIHsK
KyAgICAgICB1MzIgKl9fc3JjID0gKHUzMiAqKXNyYzsKICAgICAgICB1bnNpZ25lZCBpbnQgaTsK
CiAgICAgICAgZm9yIChpID0gMDsgaSA8IEVUSFRPT0xfREVWX0ZFQVRVUkVfV09SRFM7IGkrKykK
LSAgICAgICAgICAgICAgIGRlc3RbaV0gPSBzcmMgPj4gKDMyICogaSk7CisgICAgICAgICAgICAg
ICBkZXN0W2ldID0gX19zcmNbaV07CiB9Cgogc3RhdGljIGludCBmZWF0dXJlc19wcmVwYXJlX2Rh
dGEoY29uc3Qgc3RydWN0IGV0aG5sX3JlcV9pbmZvICpyZXFfYmFzZSwKQEAgLTM4LDE1ICszOSwy
MyBAQCBzdGF0aWMgaW50IGZlYXR1cmVzX3ByZXBhcmVfZGF0YShjb25zdCBzdHJ1Y3QKZXRobmxf
cmVxX2luZm8gKnJlcV9iYXNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgZ2VubF9pbmZvICppbmZvKQogewogICAgICAgIHN0cnVjdCBmZWF0dXJlc19yZXBseV9kYXRh
ICpkYXRhID0gRkVBVFVSRVNfUkVQREFUQShyZXBseV9iYXNlKTsKKyAgICAgICBuZXRkZXZfZmVh
dHVyZXNfdCBmZWF0dXJlc1tORVRERVZfRkVBVFVSRV9EV09SRFNdID0gezB9OwogICAgICAgIHN0
cnVjdCBuZXRfZGV2aWNlICpkZXYgPSByZXBseV9iYXNlLT5kZXY7Ci0gICAgICAgbmV0ZGV2X2Zl
YXR1cmVzX3QgYWxsX2ZlYXR1cmVzOworICAgICAgIHVuc2lnbmVkIGludCBpOwoKICAgICAgICBl
dGhubF9mZWF0dXJlc190b19iaXRtYXAzMihkYXRhLT5odywgZGV2LT5od19mZWF0dXJlcyk7CiAg
ICAgICAgZXRobmxfZmVhdHVyZXNfdG9fYml0bWFwMzIoZGF0YS0+d2FudGVkLCBkZXYtPndhbnRl
ZF9mZWF0dXJlcyk7CiAgICAgICAgZXRobmxfZmVhdHVyZXNfdG9fYml0bWFwMzIoZGF0YS0+YWN0
aXZlLCBkZXYtPmZlYXR1cmVzKTsKLSAgICAgICBldGhubF9mZWF0dXJlc190b19iaXRtYXAzMihk
YXRhLT5ub2NoYW5nZSwgTkVUSUZfRl9ORVZFUl9DSEFOR0UpOwotICAgICAgIGFsbF9mZWF0dXJl
cyA9IEdFTk1BU0tfVUxMKE5FVERFVl9GRUFUVVJFX0NPVU5UIC0gMSwgMCk7Ci0gICAgICAgZXRo
bmxfZmVhdHVyZXNfdG9fYml0bWFwMzIoZGF0YS0+YWxsLCBhbGxfZmVhdHVyZXMpOworICAgICAg
IGZlYXR1cmVzWzBdID0gTkVUSUZfRl9ORVZFUl9DSEFOR0U7CisgICAgICAgZXRobmxfZmVhdHVy
ZXNfdG9fYml0bWFwMzIoZGF0YS0+bm9jaGFuZ2UsIGZlYXR1cmVzKTsKKyAgICAgICBmb3IgKGkg
PSAwOyBpIDwgTkVUREVWX0ZFQVRVUkVfRFdPUkRTOyBpKyspIHsKKyAgICAgICAgICAgICAgIGlm
IChORVRERVZfRkVBVFVSRV9DT1VOVCA+PSAoaSArIDEpICogNjQpCisgICAgICAgICAgICAgICAg
ICAgICAgIGZlYXR1cmVzW2ldID0gR0VOTUFTS19VTEwoNjMsIDApOworICAgICAgICAgICAgICAg
ZWxzZQorICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1tpXSA9IEdFTk1BU0tfVUxMKE5F
VERFVl9GRUFUVVJFX0NPVU5UIC0gaSAqIDY0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDApOworICAgICAgIH0KKyAgICAgICBldGhubF9mZWF0dXJl
c190b19iaXRtYXAzMihkYXRhLT5hbGwsIGZlYXR1cmVzKTsKCiAgICAgICAgcmV0dXJuIDA7CiB9
CkBAIC0xMzEsMjcgKzE0MCwyOSBAQCBjb25zdCBzdHJ1Y3QgbmxhX3BvbGljeSBldGhubF9mZWF0
dXJlc19zZXRfcG9saWN5W10gPSB7CiAgICAgICAgW0VUSFRPT0xfQV9GRUFUVVJFU19XQU5URURd
ICAgICA9IHsgLnR5cGUgPSBOTEFfTkVTVEVEIH0sCiB9OwoKLXN0YXRpYyB2b2lkIGV0aG5sX2Zl
YXR1cmVzX3RvX2JpdG1hcCh1bnNpZ25lZCBsb25nICpkZXN0LApuZXRkZXZfZmVhdHVyZXNfdCB2
YWwpCitzdGF0aWMgdm9pZCBldGhubF9mZWF0dXJlc190b19iaXRtYXAodW5zaWduZWQgbG9uZyAq
ZGVzdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJl
c190ICp2YWwpCiB7CiAgICAgICAgY29uc3QgdW5zaWduZWQgaW50IHdvcmRzID0gQklUU19UT19M
T05HUyhORVRERVZfRkVBVFVSRV9DT1VOVCk7CiAgICAgICAgdW5zaWduZWQgaW50IGk7CgogICAg
ICAgIGJpdG1hcF96ZXJvKGRlc3QsIE5FVERFVl9GRUFUVVJFX0NPVU5UKTsKICAgICAgICBmb3Ig
KGkgPSAwOyBpIDwgd29yZHM7IGkrKykKLSAgICAgICAgICAgICAgIGRlc3RbaV0gPSAodW5zaWdu
ZWQgbG9uZykodmFsID4+IChpICogQklUU19QRVJfTE9ORykpOworICAgICAgICAgICAgICAgZGVz
dFtpXSA9CisgICAgICAgICAgICAgICAgICAgICAgICh1bnNpZ25lZCBsb25nKSh2YWxbaSAvIDJd
ID4+IChpICUgMiAqIEJJVFNfUEVSX0xPTkcpKTsKIH0KCi1zdGF0aWMgbmV0ZGV2X2ZlYXR1cmVz
X3QgZXRobmxfYml0bWFwX3RvX2ZlYXR1cmVzKHVuc2lnbmVkIGxvbmcgKnNyYykKK3N0YXRpYyB2
b2lkIGV0aG5sX2JpdG1hcF90b19mZWF0dXJlcyhuZXRkZXZfZmVhdHVyZXNfdCAqdmFsLCB1bnNp
Z25lZApsb25nICpzcmMpCiB7Ci0gICAgICAgY29uc3QgdW5zaWduZWQgaW50IG5mdF9iaXRzID0g
c2l6ZW9mKG5ldGRldl9mZWF0dXJlc190KSAqIEJJVFNfUEVSX0JZVEU7CiAgICAgICAgY29uc3Qg
dW5zaWduZWQgaW50IHdvcmRzID0gQklUU19UT19MT05HUyhORVRERVZfRkVBVFVSRV9DT1VOVCk7
Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgcmV0ID0gMDsKICAgICAgICB1bnNpZ25lZCBpbnQg
aTsKCisgICAgICAgZm9yIChpID0gMDsgaSA8IE5FVERFVl9GRUFUVVJFX0RXT1JEUzsgaSsrKQor
ICAgICAgICAgICAgICAgdmFsW2ldID0gMDsKKwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB3b3Jk
czsgaSsrKQotICAgICAgICAgICAgICAgcmV0IHw9IChuZXRkZXZfZmVhdHVyZXNfdCkoc3JjW2ld
KSA8PCAoaSAqIEJJVFNfUEVSX0xPTkcpOwotICAgICAgIHJldCAmPSB+KG5ldGRldl9mZWF0dXJl
c190KTAgPj4gKG5mdF9iaXRzIC0gTkVUREVWX0ZFQVRVUkVfQ09VTlQpOwotICAgICAgIHJldHVy
biByZXQ7CisgICAgICAgICAgICAgICB2YWxbaSAvIDJdIHw9CisgICAgICAgICAgICAgICAgICAg
ICAgIChuZXRkZXZfZmVhdHVyZXNfdCkoc3JjW2ldKSA8PCAoaSAlIDIgKiBCSVRTX1BFUl9MT05H
KTsKIH0KCiBzdGF0aWMgaW50IGZlYXR1cmVzX3NlbmRfcmVwbHkoc3RydWN0IG5ldF9kZXZpY2Ug
KmRldiwgc3RydWN0IGdlbmxfaW5mbyAqaW5mbywKQEAgLTIxMiwxMiArMjIzLDE0IEBAIGludCBl
dGhubF9zZXRfZmVhdHVyZXMoc3RydWN0IHNrX2J1ZmYgKnNrYiwKc3RydWN0IGdlbmxfaW5mbyAq
aW5mbykKIHsKICAgICAgICBERUNMQVJFX0JJVE1BUCh3YW50ZWRfZGlmZl9tYXNrLCBORVRERVZf
RkVBVFVSRV9DT1VOVCk7CiAgICAgICAgREVDTEFSRV9CSVRNQVAoYWN0aXZlX2RpZmZfbWFzaywg
TkVUREVWX0ZFQVRVUkVfQ09VTlQpOworICAgICAgIG5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVz
W05FVERFVl9GRUFUVVJFX0RXT1JEU107CiAgICAgICAgREVDTEFSRV9CSVRNQVAob2xkX2FjdGl2
ZSwgTkVUREVWX0ZFQVRVUkVfQ09VTlQpOwogICAgICAgIERFQ0xBUkVfQklUTUFQKG9sZF93YW50
ZWQsIE5FVERFVl9GRUFUVVJFX0NPVU5UKTsKICAgICAgICBERUNMQVJFX0JJVE1BUChuZXdfYWN0
aXZlLCBORVRERVZfRkVBVFVSRV9DT1VOVCk7CiAgICAgICAgREVDTEFSRV9CSVRNQVAobmV3X3dh
bnRlZCwgTkVUREVWX0ZFQVRVUkVfQ09VTlQpOwogICAgICAgIERFQ0xBUkVfQklUTUFQKHJlcV93
YW50ZWQsIE5FVERFVl9GRUFUVVJFX0NPVU5UKTsKICAgICAgICBERUNMQVJFX0JJVE1BUChyZXFf
bWFzaywgTkVUREVWX0ZFQVRVUkVfQ09VTlQpOworICAgICAgIG5ldGRldl9mZWF0dXJlc190IHRt
cFtORVRERVZfRkVBVFVSRV9EV09SRFNdOwogICAgICAgIHN0cnVjdCBldGhubF9yZXFfaW5mbyBy
ZXFfaW5mbyA9IHt9OwogICAgICAgIHN0cnVjdCBubGF0dHIgKip0YiA9IGluZm8tPmF0dHJzOwog
ICAgICAgIHN0cnVjdCBuZXRfZGV2aWNlICpkZXY7CkBAIC0yNDIsNyArMjU1LDExIEBAIGludCBl
dGhubF9zZXRfZmVhdHVyZXMoc3RydWN0IHNrX2J1ZmYgKnNrYiwKc3RydWN0IGdlbmxfaW5mbyAq
aW5mbykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3N0
cmluZ3MsIGluZm8tPmV4dGFjayk7CiAgICAgICAgaWYgKHJldCA8IDApCiAgICAgICAgICAgICAg
ICBnb3RvIG91dF9ydG5sOwotICAgICAgIGlmIChldGhubF9iaXRtYXBfdG9fZmVhdHVyZXMocmVx
X21hc2spICYgfk5FVElGX0ZfRVRIVE9PTF9CSVRTKSB7CisKKyAgICAgICBldGhubF9iaXRtYXBf
dG9fZmVhdHVyZXMoZmVhdHVyZXMsIHJlcV9tYXNrKTsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNf
ZXRodG9vbF9iaXRzKHRtcCk7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZG5vdChmZWF0dXJl
cywgZmVhdHVyZXMsIHRtcCk7CisgICAgICAgaWYgKCFuZXRkZXZfZmVhdHVyZXNfZW1wdHkoZmVh
dHVyZXMpKSB7CiAgICAgICAgICAgICAgICBHRU5MX1NFVF9FUlJfTVNHKGluZm8sICJhdHRlbXB0
IHRvIGNoYW5nZSBub24tZXRodG9vbApmZWF0dXJlcyIpOwogICAgICAgICAgICAgICAgcmV0ID0g
LUVJTlZBTDsKICAgICAgICAgICAgICAgIGdvdG8gb3V0X3J0bmw7CkBAIC0yNTMsOCArMjcwLDEz
IEBAIGludCBldGhubF9zZXRfZmVhdHVyZXMoc3RydWN0IHNrX2J1ZmYgKnNrYiwKc3RydWN0IGdl
bmxfaW5mbyAqaW5mbykKICAgICAgICBiaXRtYXBfYW5kbm90KG5ld193YW50ZWQsIG9sZF93YW50
ZWQsIHJlcV9tYXNrLCBORVRERVZfRkVBVFVSRV9DT1VOVCk7CiAgICAgICAgYml0bWFwX29yKHJl
cV93YW50ZWQsIG5ld193YW50ZWQsIHJlcV93YW50ZWQsIE5FVERFVl9GRUFUVVJFX0NPVU5UKTsK
ICAgICAgICBpZiAoIWJpdG1hcF9lcXVhbChyZXFfd2FudGVkLCBvbGRfd2FudGVkLCBORVRERVZf
RkVBVFVSRV9DT1VOVCkpIHsKLSAgICAgICAgICAgICAgIGRldi0+d2FudGVkX2ZlYXR1cmVzICY9
IH5kZXYtPmh3X2ZlYXR1cmVzOwotICAgICAgICAgICAgICAgZGV2LT53YW50ZWRfZmVhdHVyZXMg
fD0KZXRobmxfYml0bWFwX3RvX2ZlYXR1cmVzKHJlcV93YW50ZWQpICYgZGV2LT5od19mZWF0dXJl
czsKKyAgICAgICAgICAgICAgIG5ldGRldl9mZWF0dXJlc19hbmRub3QoZGV2LT53YW50ZWRfZmVh
dHVyZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+d2FudGVk
X2ZlYXR1cmVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmh3
X2ZlYXR1cmVzKTsKKyAgICAgICAgICAgICAgIGV0aG5sX2JpdG1hcF90b19mZWF0dXJlcyhmZWF0
dXJlcywgcmVxX3dhbnRlZCk7CisgICAgICAgICAgICAgICBuZXRkZXZfZmVhdHVyZXNfYW5kKGZl
YXR1cmVzLCBmZWF0dXJlcywgZGV2LT5od19mZWF0dXJlcyk7CisgICAgICAgICAgICAgICBuZXRk
ZXZfZmVhdHVyZXNfb3IoZGV2LT53YW50ZWRfZmVhdHVyZXMsIGRldi0+d2FudGVkX2ZlYXR1cmVz
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzKTsKICAgICAgICAg
ICAgICAgIF9fbmV0ZGV2X3VwZGF0ZV9mZWF0dXJlcyhkZXYpOwogICAgICAgIH0KICAgICAgICBl
dGhubF9mZWF0dXJlc190b19iaXRtYXAobmV3X2FjdGl2ZSwgZGV2LT5mZWF0dXJlcyk7CmRpZmYg
LS1naXQgYS9uZXQvZXRodG9vbC9pb2N0bC5jIGIvbmV0L2V0aHRvb2wvaW9jdGwuYwppbmRleCBi
YWE1ZDEwLi5mMjEzZWM5IDEwMDY0NAotLS0gYS9uZXQvZXRodG9vbC9pb2N0bC5jCisrKyBiL25l
dC9ldGh0b29sL2lvY3RsLmMKQEAgLTY3LDEyICs2NywxNSBAQCBzdGF0aWMgaW50IGV0aHRvb2xf
Z2V0X2ZlYXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlCipkZXYsIHZvaWQgX191c2VyICp1c2VyYWRk
cikKICAgICAgICBpbnQgaTsKCiAgICAgICAgLyogaW4gY2FzZSBmZWF0dXJlIGJpdHMgcnVuIG91
dCBhZ2FpbiAqLwotICAgICAgIEJVSUxEX0JVR19PTihFVEhUT09MX0RFVl9GRUFUVVJFX1dPUkRT
ICogc2l6ZW9mKHUzMikgPgpzaXplb2YobmV0ZGV2X2ZlYXR1cmVzX3QpKTsKKyAgICAgICBCVUlM
RF9CVUdfT04oRVRIVE9PTF9ERVZfRkVBVFVSRV9XT1JEUyAqIHNpemVvZih1MzIpID4Kc2l6ZW9m
KGRldi0+ZmVhdHVyZXMpKTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IEVUSFRPT0xfREVWX0ZF
QVRVUkVfV09SRFM7ICsraSkgewotICAgICAgICAgICAgICAgZmVhdHVyZXNbaV0uYXZhaWxhYmxl
ID0gKHUzMikoZGV2LT5od19mZWF0dXJlcyA+PiAoMzIgKiBpKSk7Ci0gICAgICAgICAgICAgICBm
ZWF0dXJlc1tpXS5yZXF1ZXN0ZWQgPSAodTMyKShkZXYtPndhbnRlZF9mZWF0dXJlcyA+PiAoMzIg
KiBpKSk7Ci0gICAgICAgICAgICAgICBmZWF0dXJlc1tpXS5hY3RpdmUgPSAodTMyKShkZXYtPmZl
YXR1cmVzID4+ICgzMiAqIGkpKTsKKyAgICAgICAgICAgICAgIGZlYXR1cmVzW2ldLmF2YWlsYWJs
ZSA9CisgICAgICAgICAgICAgICAgICAgICAgICh1MzIpKGRldi0+aHdfZmVhdHVyZXNbaSAvIDJd
ID4+IChpICUgMiAqIDMyKSk7CisgICAgICAgICAgICAgICBmZWF0dXJlc1tpXS5yZXF1ZXN0ZWQg
PQorICAgICAgICAgICAgICAgICAgICAgICAodTMyKShkZXYtPndhbnRlZF9mZWF0dXJlc1tpIC8g
Ml0gPj4gKGkgJSAyICogMzIpKTsKKyAgICAgICAgICAgICAgIGZlYXR1cmVzW2ldLmFjdGl2ZSA9
CisgICAgICAgICAgICAgICAgICAgICAgICh1MzIpKGRldi0+ZmVhdHVyZXNbaSAvIDJdID4+IChp
ICUgMiAqIDMyKSk7CiAgICAgICAgICAgICAgICBmZWF0dXJlc1tpXS5uZXZlcl9jaGFuZ2VkID0K
ICAgICAgICAgICAgICAgICAgICAgICAgKHUzMikoTkVUSUZfRl9ORVZFUl9DSEFOR0UgPj4gKDMy
ICogaSkpOwogICAgICAgIH0KQEAgLTk3LDcgKzEwMCw5IEBAIHN0YXRpYyBpbnQgZXRodG9vbF9z
ZXRfZmVhdHVyZXMoc3RydWN0IG5ldF9kZXZpY2UKKmRldiwgdm9pZCBfX3VzZXIgKnVzZXJhZGRy
KQogewogICAgICAgIHN0cnVjdCBldGh0b29sX3NmZWF0dXJlcyBjbWQ7CiAgICAgICAgc3RydWN0
IGV0aHRvb2xfc2V0X2ZlYXR1cmVzX2Jsb2NrIGZlYXR1cmVzW0VUSFRPT0xfREVWX0ZFQVRVUkVf
V09SRFNdOwotICAgICAgIG5ldGRldl9mZWF0dXJlc190IHdhbnRlZCA9IDAsIHZhbGlkID0gMDsK
KyAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCB3YW50ZWRbTkVUREVWX0ZFQVRVUkVfRFdPUkRTXSA9
IHswfTsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCB2YWxpZFtORVRERVZfRkVBVFVSRV9EV09S
RFNdID0gezB9OworICAgICAgIG5ldGRldl9mZWF0dXJlc190IHRtcFtORVRERVZfRkVBVFVSRV9E
V09SRFNdOwogICAgICAgIGludCBpLCByZXQgPSAwOwoKICAgICAgICBpZiAoY29weV9mcm9tX3Vz
ZXIoJmNtZCwgdXNlcmFkZHIsIHNpemVvZihjbWQpKSkKQEAgLTExMSwyMyArMTE2LDMzIEBAIHN0
YXRpYyBpbnQgZXRodG9vbF9zZXRfZmVhdHVyZXMoc3RydWN0Cm5ldF9kZXZpY2UgKmRldiwgdm9p
ZCBfX3VzZXIgKnVzZXJhZGRyKQogICAgICAgICAgICAgICAgcmV0dXJuIC1FRkFVTFQ7CgogICAg
ICAgIGZvciAoaSA9IDA7IGkgPCBFVEhUT09MX0RFVl9GRUFUVVJFX1dPUkRTOyArK2kpIHsKLSAg
ICAgICAgICAgICAgIHZhbGlkIHw9IChuZXRkZXZfZmVhdHVyZXNfdClmZWF0dXJlc1tpXS52YWxp
ZCA8PCAoMzIgKiBpKTsKLSAgICAgICAgICAgICAgIHdhbnRlZCB8PSAobmV0ZGV2X2ZlYXR1cmVz
X3QpZmVhdHVyZXNbaV0ucmVxdWVzdGVkIDw8ICgzMiAqIGkpOworICAgICAgICAgICAgICAgdmFs
aWRbaSAvIDJdIHw9CisgICAgICAgICAgICAgICAgICAgICAgIChuZXRkZXZfZmVhdHVyZXNfdClm
ZWF0dXJlc1tpXS52YWxpZCA8PCAoMzIgKiBpKTsKKyAgICAgICAgICAgICAgIHdhbnRlZFtpIC8g
Ml0gfD0KKyAgICAgICAgICAgICAgICAgICAgICAgKG5ldGRldl9mZWF0dXJlc190KWZlYXR1cmVz
W2ldLnJlcXVlc3RlZCA8PCAoMzIgKiBpKTsKICAgICAgICB9CgotICAgICAgIGlmICh2YWxpZCAm
IH5ORVRJRl9GX0VUSFRPT0xfQklUUykKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfZXRodG9vbF9i
aXRzKHRtcCk7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZG5vdCh0bXAsIGZlYXR1cmVzLCB0
bXApOworICAgICAgIGlmICghbmV0ZGV2X2ZlYXR1cmVzX2VtcHR5KHRtcCkpCiAgICAgICAgICAg
ICAgICByZXR1cm4gLUVJTlZBTDsKCi0gICAgICAgaWYgKHZhbGlkICYgfmRldi0+aHdfZmVhdHVy
ZXMpIHsKLSAgICAgICAgICAgICAgIHZhbGlkICY9IGRldi0+aHdfZmVhdHVyZXM7CisgICAgICAg
bmV0ZGV2X2ZlYXR1cmVzX2FuZG5vdCh0bXAsIHZhbGlkLCBkZXYtPmh3X2ZlYXR1cmVzKTsKKwor
ICAgICAgIGlmICghbmV0ZGV2X2ZlYXR1cmVzX2VtcHR5KHRtcCkpIHsKKyAgICAgICAgICAgICAg
IG5ldGRldl9mZWF0dXJlc19hbmQodmFsaWQsIHZhbGlkLCBkZXYtPmh3X2ZlYXR1cmVzKTsKICAg
ICAgICAgICAgICAgIHJldCB8PSBFVEhUT09MX0ZfVU5TVVBQT1JURUQ7CiAgICAgICAgfQoKLSAg
ICAgICBkZXYtPndhbnRlZF9mZWF0dXJlcyAmPSB+dmFsaWQ7Ci0gICAgICAgZGV2LT53YW50ZWRf
ZmVhdHVyZXMgfD0gd2FudGVkICYgdmFsaWQ7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZG5v
dChkZXYtPndhbnRlZF9mZWF0dXJlcywgZGV2LT53YW50ZWRfZmVhdHVyZXMsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2YWxpZCk7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZCh3
YW50ZWQsIHdhbnRlZCwgdmFsaWQpOworICAgICAgIG5ldGRldl9mZWF0dXJlc19vcihkZXYtPndh
bnRlZF9mZWF0dXJlcywgZGV2LT53YW50ZWRfZmVhdHVyZXMsIHdhbnRlZCk7CiAgICAgICAgX19u
ZXRkZXZfdXBkYXRlX2ZlYXR1cmVzKGRldik7CgotICAgICAgIGlmICgoZGV2LT53YW50ZWRfZmVh
dHVyZXMgXiBkZXYtPmZlYXR1cmVzKSAmIHZhbGlkKQorICAgICAgIG5ldGRldl9mZWF0dXJlc194
b3IodG1wLCBkZXYtPndhbnRlZF9mZWF0dXJlcywgZGV2LT5mZWF0dXJlcyk7CisgICAgICAgbmV0
ZGV2X2ZlYXR1cmVzX2FuZCh0bXAsIHRtcCwgdmFsaWQpOworICAgICAgIGlmICghbmV0ZGV2X2Zl
YXR1cmVzX2VtcHR5KHRtcCkpCiAgICAgICAgICAgICAgICByZXQgfD0gRVRIVE9PTF9GX1dJU0g7
CgogICAgICAgIHJldHVybiByZXQ7CkBAIC0yMjcsNyArMjQyLDcgQEAgc3RhdGljIGludCBldGh0
b29sX2dldF9vbmVfZmVhdHVyZShzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAogICAgICAgIG5ldGRl
dl9mZWF0dXJlc190IG1hc2sgPSBldGh0b29sX2dldF9mZWF0dXJlX21hc2soZXRoY21kKTsKICAg
ICAgICBzdHJ1Y3QgZXRodG9vbF92YWx1ZSBlZGF0YSA9IHsKICAgICAgICAgICAgICAgIC5jbWQg
PSBldGhjbWQsCi0gICAgICAgICAgICAgICAuZGF0YSA9ICEhKGRldi0+ZmVhdHVyZXMgJiBtYXNr
KSwKKyAgICAgICAgICAgICAgIC5kYXRhID0gISEoZGV2LT5mZWF0dXJlc1swXSAmIG1hc2spLAog
ICAgICAgIH07CgogICAgICAgIGlmIChjb3B5X3RvX3VzZXIodXNlcmFkZHIsICZlZGF0YSwgc2l6
ZW9mKGVkYXRhKSkpCkBAIC0yMzgsMjEgKzI1MywyMyBAQCBzdGF0aWMgaW50IGV0aHRvb2xfZ2V0
X29uZV9mZWF0dXJlKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCiBzdGF0aWMgaW50IGV0aHRvb2xf
c2V0X29uZV9mZWF0dXJlKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCiAgICAgICAgdm9pZCBfX3Vz
ZXIgKnVzZXJhZGRyLCB1MzIgZXRoY21kKQogeworICAgICAgIG5ldGRldl9mZWF0dXJlc190IG1h
c2tbTkVUREVWX0ZFQVRVUkVfRFdPUkRTXSA9IHswfTsKICAgICAgICBzdHJ1Y3QgZXRodG9vbF92
YWx1ZSBlZGF0YTsKLSAgICAgICBuZXRkZXZfZmVhdHVyZXNfdCBtYXNrOwoKICAgICAgICBpZiAo
Y29weV9mcm9tX3VzZXIoJmVkYXRhLCB1c2VyYWRkciwgc2l6ZW9mKGVkYXRhKSkpCiAgICAgICAg
ICAgICAgICByZXR1cm4gLUVGQVVMVDsKCi0gICAgICAgbWFzayA9IGV0aHRvb2xfZ2V0X2ZlYXR1
cmVfbWFzayhldGhjbWQpOwotICAgICAgIG1hc2sgJj0gZGV2LT5od19mZWF0dXJlczsKLSAgICAg
ICBpZiAoIW1hc2spCisgICAgICAgbWFza1swXSA9IGV0aHRvb2xfZ2V0X2ZlYXR1cmVfbWFzayhl
dGhjbWQpOworICAgICAgIG5ldGRldl9mZWF0dXJlc19hbmQobWFzaywgbWFzaywgZGV2LT5od19m
ZWF0dXJlcyk7CisgICAgICAgaWYgKG5ldGRldl9mZWF0dXJlc19lbXB0eShtYXNrKSkKICAgICAg
ICAgICAgICAgIHJldHVybiAtRU9QTk9UU1VQUDsKCiAgICAgICAgaWYgKGVkYXRhLmRhdGEpCi0g
ICAgICAgICAgICAgICBkZXYtPndhbnRlZF9mZWF0dXJlcyB8PSBtYXNrOworICAgICAgICAgICAg
ICAgbmV0ZGV2X2ZlYXR1cmVzX29yKGRldi0+d2FudGVkX2ZlYXR1cmVzLCBkZXYtPndhbnRlZF9m
ZWF0dXJlcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXNrKQogICAgICAg
IGVsc2UKLSAgICAgICAgICAgICAgIGRldi0+d2FudGVkX2ZlYXR1cmVzICY9IH5tYXNrOworICAg
ICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZG5vdChkZXYtPndhbnRlZF9mZWF0dXJlcywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT53YW50ZWRfZmVhdHVy
ZXMsIG1hc2spOwoKICAgICAgICBfX25ldGRldl91cGRhdGVfZmVhdHVyZXMoZGV2KTsKCkBAIC0y
ODUsMjkgKzMwMiwzNyBAQCBzdGF0aWMgdTMyIF9fZXRodG9vbF9nZXRfZmxhZ3Moc3RydWN0IG5l
dF9kZXZpY2UgKmRldikKCiBzdGF0aWMgaW50IF9fZXRodG9vbF9zZXRfZmxhZ3Moc3RydWN0IG5l
dF9kZXZpY2UgKmRldiwgdTMyIGRhdGEpCiB7Ci0gICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgZmVh
dHVyZXMgPSAwLCBjaGFuZ2VkOworICAgICAgIG5ldGRldl9mZWF0dXJlc190IGZlYXR1cmVzW05F
VERFVl9GRUFUVVJFX0RXT1JEU10gPSB7MH07CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3QgY2hh
bmdlZFtORVRERVZfRkVBVFVSRV9EV09SRFNdOworICAgICAgIG5ldGRldl9mZWF0dXJlc190IHRt
cFtORVRERVZfRkVBVFVSRV9EV09SRFNdOwoKICAgICAgICBpZiAoZGF0YSAmIH5FVEhfQUxMX0ZM
QUdTKQogICAgICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CgogICAgICAgIGlmIChkYXRhICYg
RVRIX0ZMQUdfTFJPKQotICAgICAgICAgICAgICAgZmVhdHVyZXMgfD0gTkVUSUZfRl9MUk87Cisg
ICAgICAgICAgICAgICBmZWF0dXJlc1swXSB8PSBORVRJRl9GX0xSTzsKICAgICAgICBpZiAoZGF0
YSAmIEVUSF9GTEFHX1JYVkxBTikKLSAgICAgICAgICAgICAgIGZlYXR1cmVzIHw9IE5FVElGX0Zf
SFdfVkxBTl9DVEFHX1JYOworICAgICAgICAgICAgICAgZmVhdHVyZXNbMF0gfD0gTkVUSUZfRl9I
V19WTEFOX0NUQUdfUlg7CiAgICAgICAgaWYgKGRhdGEgJiBFVEhfRkxBR19UWFZMQU4pCi0gICAg
ICAgICAgICAgICBmZWF0dXJlcyB8PSBORVRJRl9GX0hXX1ZMQU5fQ1RBR19UWDsKKyAgICAgICAg
ICAgICAgIGZlYXR1cmVzWzBdIHw9IE5FVElGX0ZfSFdfVkxBTl9DVEFHX1RYOwogICAgICAgIGlm
IChkYXRhICYgRVRIX0ZMQUdfTlRVUExFKQotICAgICAgICAgICAgICAgZmVhdHVyZXMgfD0gTkVU
SUZfRl9OVFVQTEU7CisgICAgICAgICAgICAgICBmZWF0dXJlc1swXSB8PSBORVRJRl9GX05UVVBM
RTsKICAgICAgICBpZiAoZGF0YSAmIEVUSF9GTEFHX1JYSEFTSCkKLSAgICAgICAgICAgICAgIGZl
YXR1cmVzIHw9IE5FVElGX0ZfUlhIQVNIOworICAgICAgICAgICAgICAgZmVhdHVyZXNbMF0gfD0g
TkVUSUZfRl9SWEhBU0g7CgogICAgICAgIC8qIGFsbG93IGNoYW5naW5nIG9ubHkgYml0cyBzZXQg
aW4gaHdfZmVhdHVyZXMgKi8KLSAgICAgICBjaGFuZ2VkID0gKGZlYXR1cmVzIF4gZGV2LT5mZWF0
dXJlcykgJiBFVEhfQUxMX0ZFQVRVUkVTOwotICAgICAgIGlmIChjaGFuZ2VkICYgfmRldi0+aHdf
ZmVhdHVyZXMpCi0gICAgICAgICAgICAgICByZXR1cm4gKGNoYW5nZWQgJiBkZXYtPmh3X2ZlYXR1
cmVzKSA/IC1FSU5WQUwgOiAtRU9QTk9UU1VQUDsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfeG9y
KGNoYW5nZWQsIGZlYXR1cmVzLCBkZXYtPmZlYXR1cmVzKTsKKyAgICAgICBjaGFuZ2VkWzBdICY9
IEVUSF9BTExfRkVBVFVSRVM7CisKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfYW5kbm90KHRtcCwg
Y2hhbmdlZCwgZGV2LT5od19mZWF0dXJlcyk7CisgICAgICAgaWYgKCFuZXRkZXZfZmVhdHVyZXNf
ZW1wdHkodG1wKSkgeworICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2FuZCh0bXAsIGNo
YW5nZWQsIGRldi0+aHdfZmVhdHVyZXMpOworICAgICAgICAgICAgICAgcmV0dXJuICghbmV0ZGV2
X2ZlYXR1cmVzX2VtcHR5KHRtcCkpID8gLUVJTlZBTCA6IC1FT1BOT1RTVVBQOworICAgICAgIH0K
Ci0gICAgICAgZGV2LT53YW50ZWRfZmVhdHVyZXMgPQotICAgICAgICAgICAgICAgKGRldi0+d2Fu
dGVkX2ZlYXR1cmVzICYgfmNoYW5nZWQpIHwgKGZlYXR1cmVzICYgY2hhbmdlZCk7CisgICAgICAg
bmV0ZGV2X2ZlYXR1cmVzX2FuZG5vdCh0bXAsIGRldi0+d2FudGVkX2ZlYXR1cmVzLCBjaGFuZ2Vk
KTsKKyAgICAgICBuZXRkZXZfZmVhdHVyZXNfYW5kKGZlYXR1cmVzLCBmZWF0dXJlcywgY2hhbmdl
ZCk7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX29yKGRldi0+d2FudGVkX2ZlYXR1cmVzLCB0bXAs
IGZlYXR1cmVzKTsKCiAgICAgICAgX19uZXRkZXZfdXBkYXRlX2ZlYXR1cmVzKGRldik7CgpAQCAt
MjU4Nyw3ICsyNjEyLDcgQEAgaW50IGRldl9ldGh0b29sKHN0cnVjdCBuZXQgKm5ldCwgc3RydWN0
IGlmcmVxICppZnIpCiAgICAgICAgdm9pZCBfX3VzZXIgKnVzZXJhZGRyID0gaWZyLT5pZnJfZGF0
YTsKICAgICAgICB1MzIgZXRoY21kLCBzdWJfY21kOwogICAgICAgIGludCByYzsKLSAgICAgICBu
ZXRkZXZfZmVhdHVyZXNfdCBvbGRfZmVhdHVyZXM7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX3Qg
b2xkX2ZlYXR1cmVzW05FVERFVl9GRUFUVVJFX0RXT1JEU107CgogICAgICAgIGlmICghZGV2IHx8
ICFuZXRpZl9kZXZpY2VfcHJlc2VudChkZXYpKQogICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9E
RVY7CkBAIC0yNjUwLDcgKzI2NzUsNyBAQCBpbnQgZGV2X2V0aHRvb2woc3RydWN0IG5ldCAqbmV0
LCBzdHJ1Y3QgaWZyZXEgKmlmcikKICAgICAgICAgICAgICAgIGlmIChyYyAgPCAwKQogICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gcmM7CiAgICAgICAgfQotICAgICAgIG9sZF9mZWF0dXJl
cyA9IGRldi0+ZmVhdHVyZXM7CisgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2NvcHkob2xkX2ZlYXR1
cmVzLCBkZXYtPmZlYXR1cmVzKTsKCiAgICAgICAgc3dpdGNoIChldGhjbWQpIHsKICAgICAgICBj
YXNlIEVUSFRPT0xfR1NFVDoKQEAgLTI4NjUsNyArMjg5MCw3IEBAIGludCBkZXZfZXRodG9vbChz
dHJ1Y3QgbmV0ICpuZXQsIHN0cnVjdCBpZnJlcSAqaWZyKQogICAgICAgIGlmIChkZXYtPmV0aHRv
b2xfb3BzLT5jb21wbGV0ZSkKICAgICAgICAgICAgICAgIGRldi0+ZXRodG9vbF9vcHMtPmNvbXBs
ZXRlKGRldik7CgotICAgICAgIGlmIChvbGRfZmVhdHVyZXMgIT0gZGV2LT5mZWF0dXJlcykKKyAg
ICAgICBpZiAoIW5ldGRldl9mZWF0dXJlc19lcXVhbChvbGRfZmVhdHVyZXMsIGRldi0+ZmVhdHVy
ZXMpKQogICAgICAgICAgICAgICAgbmV0ZGV2X2ZlYXR1cmVzX2NoYW5nZShkZXYpOwoKICAgICAg
ICByZXR1cm4gcmM7Ci0tCjIuOC4xCgoKCi0tIApMYXRlc3QgUG9kY2FzdDoKaHR0cHM6Ly93d3cu
bGlua2VkaW4uY29tL2ZlZWQvdXBkYXRlL3VybjpsaTphY3Rpdml0eTo2NzkxMDE0Mjg0OTM2Nzg1
OTIwLwoKRGF2ZSBUw6RodCBDVE8sIFRla0xpYnJlLCBMTEMKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KQ2FrZSBtYWlsaW5nIGxpc3QKQ2FrZUBsaXN0cy5i
dWZmZXJibG9hdC5uZXQKaHR0cHM6Ly9saXN0cy5idWZmZXJibG9hdC5uZXQvbGlzdGluZm8vY2Fr
ZQo=

Return-Path: <cake-bounces@lists.bufferbloat.net>
X-Original-To: lists+cake@lfdr.de
Delivered-To: lists+cake@lfdr.de
Received: from lists.bufferbloat.net (lists.bufferbloat.net [IPv6:2600:3c03:e000:3ca:f00f:f00f:b33b:b33b])
	by mail.lfdr.de (Postfix) with ESMTPS id CE4ED2141E5
	for <lists+cake@lfdr.de>; Sat,  4 Jul 2020 01:10:00 +0200 (CEST)
Received: from pitt.bufferbloat.net (localhost [127.0.0.1])
	by lists.bufferbloat.net (Postfix) with ESMTP id 7B6123CB39;
	Fri,  3 Jul 2020 19:09:59 -0400 (EDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
	d=lists.bufferbloat.net; s=201610; t=1593817799;
	bh=TP70ZENZ1WxDEXXsEtm7dfSYN7Z+i8/Uunt25nU/wsU=;
	h=From:To:Date:Subject:List-Id:List-Unsubscribe:List-Archive:
	 List-Post:List-Help:List-Subscribe:Cc:From;
	b=h8TjRM/K+cZkN/ZBZ/AyAkkNLIVPtaJ/lMSnUYSTcBYqImaSMdamUV1BWENMmfEyB
	 1DaCM70lNnsHOXRPPAz3ve0af6t5faaX5JtH7CQPdYkfD3IjCTpZxzPVzpXX66i8Qb
	 IPF5BOAKhHLfDrCADo1HbvkF1ECFb4AZ54D8DYAvtaJefCk4Y1n8Dm8Z5lXsGrPAwo
	 cf1mPbooqBOcn7LcyiERxWVgRyzGrQO0ktGOsSA8/grICNzwTwiB+SqaTn9f6fX/05
	 /L2+I0i0NybB4Y+0LL1lgekjz9jWtLxCn8KjCFzTlNvQ7uqm4eZGxZ2O8RAVAjnNQp
	 UpLihGKEHt6QQ==
X-Original-To: cake@lists.bufferbloat.net
Delivered-To: cake@lists.bufferbloat.net
Received: from us-smtp-delivery-1.mimecast.com (us-smtp-2.mimecast.com
 [207.211.31.81])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-SHA384 (256/256 bits))
 (No client certificate requested)
 by lists.bufferbloat.net (Postfix) with ESMTPS id 939FA3B2A4
 for <cake@lists.bufferbloat.net>; Fri,  3 Jul 2020 16:27:44 -0400 (EDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1593808064;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding;
 bh=qjFdI6gwi+WACg4Wj1dPXSQONSFYoYYjLYblfl+digA=;
 b=HnaXmMiAnmkNOFz+pLbH2+kSB6IeKtUF1QWfMmVLUuvq2mHH/a7l66WPX+PkS08m/VHsuf
 kVl939v757R87hWlfrq7gYqguC/6qUw3eok+wuRpmS5d4Zn7RM6Kun8JAF8wKN+lIxnGp/
 lXugZ1i25sT7iHjN27HnY9NZGKTnyMk=
Received: from mail-pg1-f198.google.com (mail-pg1-f198.google.com
 [209.85.215.198]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-59-3CT8Sv9GM9iWCHYoM_5ZRg-1; Fri, 03 Jul 2020 16:27:41 -0400
X-MC-Unique: 3CT8Sv9GM9iWCHYoM_5ZRg-1
Received: by mail-pg1-f198.google.com with SMTP id 72so24097244pgb.1
 for <cake@lists.bufferbloat.net>; Fri, 03 Jul 2020 13:27:40 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=qjFdI6gwi+WACg4Wj1dPXSQONSFYoYYjLYblfl+digA=;
 b=S8FtlsnD0fcp6I0WIRtC4clK5dy7weieclj3Y2A7VHTkXsK1sQKsjZPrwUlIhM/T/M
 1Ei5UbcN7yDHhMx5a/y7YMgVrAWpZ20Dvkuexxt2eJrNlNcNgMrrMuxrJMguOq8ln1SR
 7oUA6y+JFEbRpWjEQOo4gH3bmuR/fsjamQ0H0oMTsYa1XeXpAblqVizGaqJkQTzbPWzD
 djjO58Fr2hd1Ga4Kl3NXKTzFeBuXvtpGzLG/VfNClUnl9pzxPwLvvRkOGXAhRQ4Xsle2
 FmnSBUy8nML9VXVOqjnHhfMqCR419yweI9UjOAqbFGwijA9jRPFvC9cjK6/BiOqs5DJr
 aGoA==
X-Gm-Message-State: AOAM533e+fFDzNoPeAOM2T6OVUz75cJBbPU3Xzj9Wj19P2DU0AxuZ3zg
 7DXmBe8E8FNPugL1GQ/pK//+lWt3vh7ErV8iCl1Ju5aBjFi7CzFcrKaY4R6nnkqfDLnUAMuk6D8
 Ez1iG1UHEW7/44TroJVB39g==
X-Received: by 2002:a17:90a:b781:: with SMTP id
 m1mr36980545pjr.14.1593808059069; 
 Fri, 03 Jul 2020 13:27:39 -0700 (PDT)
X-Google-Smtp-Source: ABdhPJw1ATBE7EypPvRFq8yRn0n7Bj1TQiEG6LjUf2mfuHXCK1xJzVOJA+/Bmj7JtKXMDNH9e0gNaw==
X-Received: by 2002:a17:90a:b781:: with SMTP id
 m1mr36980523pjr.14.1593808058741; 
 Fri, 03 Jul 2020 13:27:38 -0700 (PDT)
Received: from alrua-x1.borgediget.toke.dk ([45.145.92.2])
 by smtp.gmail.com with ESMTPSA id m92sm12081848pje.13.2020.07.03.13.27.36
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 03 Jul 2020 13:27:37 -0700 (PDT)
Received: by alrua-x1.borgediget.toke.dk (Postfix, from userid 1000)
 id D00151804A8; Fri,  3 Jul 2020 22:27:32 +0200 (CEST)
From: =?UTF-8?q?Toke=20H=C3=B8iland-J=C3=B8rgensen?= <toke@redhat.com>
To: davem@davemloft.net
Date: Fri,  3 Jul 2020 22:26:43 +0200
Message-Id: <20200703202643.12919-1-toke@redhat.com>
X-Mailer: git-send-email 2.27.0
MIME-Version: 1.0
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=toke@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
X-Mailman-Approved-At: Fri, 03 Jul 2020 19:09:58 -0400
Subject: [Cake] [PATCH net v3] sched: consistently handle layer3 header
	accesses in the presence of VLANs
X-BeenThere: cake@lists.bufferbloat.net
X-Mailman-Version: 2.1.20
Precedence: list
List-Id: Cake - FQ_codel the next generation <cake.lists.bufferbloat.net>
List-Unsubscribe: <https://lists.bufferbloat.net/options/cake>,
 <mailto:cake-request@lists.bufferbloat.net?subject=unsubscribe>
List-Archive: <https://lists.bufferbloat.net/pipermail/cake>
List-Post: <mailto:cake@lists.bufferbloat.net>
List-Help: <mailto:cake-request@lists.bufferbloat.net?subject=help>
List-Subscribe: <https://lists.bufferbloat.net/listinfo/cake>,
 <mailto:cake-request@lists.bufferbloat.net?subject=subscribe>
Cc: Lawrence Brakmo <brakmo@fb.com>, Davide Caratti <dcaratti@redhat.com>,
 Jiri Pirko <jiri@resnulli.us>, netdev@vger.kernel.org,
 Jamal Hadi Salim <jhs@mojatatu.com>, cake@lists.bufferbloat.net,
 Roman Mashak <mrv@mojatatu.com>, Ilya Ponetayev <i.ponetaev@ndmsystems.com>,
 Cong Wang <xiyou.wangcong@gmail.com>, bpf@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: cake-bounces@lists.bufferbloat.net
Sender: "Cake" <cake-bounces@lists.bufferbloat.net>

VGhlcmUgYXJlIGEgY291cGxlIG9mIHBsYWNlcyBpbiBuZXQvc2NoZWQvIHRoYXQgY2hlY2sgc2ti
LT5wcm90b2NvbCBhbmQgYWN0Cm9uIHRoZSB2YWx1ZSB0aGVyZS4gSG93ZXZlciwgaW4gdGhlIHBy
ZXNlbmNlIG9mIFZMQU4gdGFncywgdGhlIHZhbHVlIHN0b3JlZAppbiBza2ItPnByb3RvY29sIGNh
biBiZSBpbmNvbnNpc3RlbnQgYmFzZWQgb24gd2hldGhlciBWTEFOIGFjY2VsZXJhdGlvbiBpcwpl
bmFibGVkLiBUaGUgY29tbWl0IHF1b3RlZCBpbiB0aGUgRml4ZXMgdGFnIGJlbG93IGZpeGVkIHRo
ZSB1c2VycyBvZgpza2ItPnByb3RvY29sIHRvIHVzZSBhIGhlbHBlciB0aGF0IHdpbGwgYWx3YXlz
IHNlZSB0aGUgVkxBTiBldGhlcnR5cGUuCgpIb3dldmVyLCBtb3N0IG9mIHRoZSBjYWxsZXJzIGRv
bid0IGFjdHVhbGx5IGhhbmRsZSB0aGUgVkxBTiBldGhlcnR5cGUsIGJ1dApleHBlY3QgdG8gZmlu
ZCB0aGUgSVAgaGVhZGVyIHR5cGUgaW4gdGhlIHByb3RvY29sIGZpZWxkLiBUaGlzIG1lYW5zIHRo
YXQKdGhpbmdzIGxpa2UgY2hhbmdpbmcgdGhlIEVDTiBmaWVsZCwgb3IgcGFyc2luZyBkaWZmc2Vy
diB2YWx1ZXMsIHN0b3BzCndvcmtpbmcgaWYgdGhlcmUncyBhIFZMQU4gdGFnLCBvciBpZiB0aGVy
ZSBhcmUgbXVsdGlwbGUgbmVzdGVkIFZMQU4KdGFncyAoUWluUSkuCgpUbyBmaXggdGhpcywgY2hh
bmdlIHRoZSBoZWxwZXIgdG8gdGFrZSBhbiBhcmd1bWVudCB0aGF0IGluZGljYXRlcyB3aGV0aGVy
CnRoZSBjYWxsZXIgd2FudHMgdG8gc2tpcCB0aGUgVkxBTiB0YWdzIG9yIG5vdC4gV2hlbiBza2lw
cGluZyBWTEFOIHRhZ3MsIHdlCm1ha2Ugc3VyZSB0byBza2lwIGFsbCBvZiB0aGVtLCBzbyBiZWhh
dmlvdXIgaXMgY29uc2lzdGVudCBldmVuIGluIFFpblEKbW9kZS4KClRvIG1ha2UgdGhlIGhlbHBl
ciB1c2FibGUgZnJvbSB0aGUgRUNOIGNvZGUsIG1vdmUgaXQgdG8gaWZfdmxhbi5oIGluc3RlYWQK
b2YgcGt0X3NjaGVkLmguCgp2MzoKLSBSZW1vdmUgZW1wdHkgbGluZXMKLSBNb3ZlIHZsYW4gdmFy
aWFibGUgZGVmaW5pdGlvbnMgaW5zaWRlIGxvb3AgaW4gc2tiX3Byb3RvY29sKCkKLSBBbHNvIHVz
ZSBza2JfcHJvdG9jb2woKSBoZWxwZXIgaW4gSVB7LDZ9X0VDTl9kZWNhcHN1bGF0ZSgpIGFuZAog
IGJwZl9za2JfZWNuX3NldF9jZSgpCgp2MjoKLSBVc2UgZXRoX3R5cGVfdmxhbigpIGhlbHBlciBp
biBza2JfcHJvdG9jb2woKQotIEFsc28gZml4IGNvZGUgdGhhdCByZWFkcyBza2ItPnByb3RvY29s
IGRpcmVjdGx5Ci0gQ2hhbmdlIGEgY291cGxlIG9mICdpZi9lbHNlIGlmJyBzdGF0ZW1lbnRzIHRv
IHN3aXRjaCBjb25zdHJ1Y3RzIHRvIGF2b2lkCiAgY2FsbGluZyB0aGUgaGVscGVyIHR3aWNlCgpS
ZXBvcnRlZC1ieTogSWx5YSBQb25ldGF5ZXYgPGkucG9uZXRhZXZAbmRtc3lzdGVtcy5jb20+CkZp
eGVzOiBkOGI5NjA1ZDI2OTcgKCJuZXQ6IHNjaGVkOiBmaXggc2tiLT5wcm90b2NvbCB1c2UgaW4g
Y2FzZSBvZiBhY2NlbGVyYXRlZCB2bGFuIHBhdGgiKQpTaWduZWQtb2ZmLWJ5OiBUb2tlIEjDuGls
YW5kLUrDuHJnZW5zZW4gPHRva2VAcmVkaGF0LmNvbT4KLS0tCiBpbmNsdWRlL2xpbnV4L2lmX3Zs
YW4uaCAgfCAyOCArKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL25ldC9pbmV0
X2Vjbi5oICAgfCAyNSArKysrKysrKysrKysrKysrKy0tLS0tLS0tCiBpbmNsdWRlL25ldC9wa3Rf
c2NoZWQuaCAgfCAxMSAtLS0tLS0tLS0tLQogbmV0L2NvcmUvZmlsdGVyLmMgICAgICAgIHwgMTAg
KysrKysrKy0tLQogbmV0L3NjaGVkL2FjdF9jb25ubWFyay5jIHwgIDkgKysrKysrLS0tCiBuZXQv
c2NoZWQvYWN0X2NzdW0uYyAgICAgfCAgMiArLQogbmV0L3NjaGVkL2FjdF9jdC5jICAgICAgIHwg
IDkgKysrKy0tLS0tCiBuZXQvc2NoZWQvYWN0X2N0aW5mby5jICAgfCAgOSArKysrKystLS0KIG5l
dC9zY2hlZC9hY3RfbXBscy5jICAgICB8ICAyICstCiBuZXQvc2NoZWQvYWN0X3NrYmVkaXQuYyAg
fCAgMiArLQogbmV0L3NjaGVkL2Nsc19hcGkuYyAgICAgIHwgIDIgKy0KIG5ldC9zY2hlZC9jbHNf
Zmxvdy5jICAgICB8ICA4ICsrKystLS0tCiBuZXQvc2NoZWQvY2xzX2Zsb3dlci5jICAgfCAgMiAr
LQogbmV0L3NjaGVkL2VtX2lwc2V0LmMgICAgIHwgIDIgKy0KIG5ldC9zY2hlZC9lbV9pcHQuYyAg
ICAgICB8ICAyICstCiBuZXQvc2NoZWQvZW1fbWV0YS5jICAgICAgfCAgMiArLQogbmV0L3NjaGVk
L3NjaF9jYWtlLmMgICAgIHwgIDQgKystLQogbmV0L3NjaGVkL3NjaF9kc21hcmsuYyAgIHwgIDYg
KysrLS0tCiBuZXQvc2NoZWQvc2NoX3RlcWwuYyAgICAgfCAgMiArLQogMTkgZmlsZXMgY2hhbmdl
ZCwgODYgaW5zZXJ0aW9ucygrKSwgNTEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS9saW51eC9pZl92bGFuLmggYi9pbmNsdWRlL2xpbnV4L2lmX3ZsYW4uaAppbmRleCBiMDVlODU1
ZjFkZGQuLjQyN2E1Yjg1OTdjMiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9pZl92bGFuLmgK
KysrIGIvaW5jbHVkZS9saW51eC9pZl92bGFuLmgKQEAgLTMwOCw2ICszMDgsMzQgQEAgc3RhdGlj
IGlubGluZSBib29sIGV0aF90eXBlX3ZsYW4oX19iZTE2IGV0aGVydHlwZSkKIAl9CiB9CiAKKy8q
IEEgZ2V0dGVyIGZvciB0aGUgU0tCIHByb3RvY29sIGZpZWxkIHdoaWNoIHdpbGwgaGFuZGxlIFZM
QU4gdGFncyBjb25zaXN0ZW50bHkKKyAqIHdoZXRoZXIgVkxBTiBhY2NlbGVyYXRpb24gaXMgZW5h
YmxlZCBvciBub3QuCisgKi8KK3N0YXRpYyBpbmxpbmUgX19iZTE2IHNrYl9wcm90b2NvbChjb25z
dCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBib29sIHNraXBfdmxhbikKK3sKKwl1bnNpZ25lZCBpbnQg
b2Zmc2V0ID0gc2tiX21hY19vZmZzZXQoc2tiKSArIHNpemVvZihzdHJ1Y3QgZXRoaGRyKTsKKwlf
X2JlMTYgcHJvdG8gPSBza2ItPnByb3RvY29sOworCisJaWYgKCFza2lwX3ZsYW4pCisJCS8qIFZM
QU4gYWNjZWxlcmF0aW9uIHN0cmlwcyB0aGUgVkxBTiBoZWFkZXIgZnJvbSB0aGUgc2tiIGFuZAor
CQkgKiBtb3ZlcyBpdCB0byBza2ItPnZsYW5fcHJvdG8KKwkJICovCisJCXJldHVybiBza2Jfdmxh
bl90YWdfcHJlc2VudChza2IpID8gc2tiLT52bGFuX3Byb3RvIDogcHJvdG87CisKKwl3aGlsZSAo
ZXRoX3R5cGVfdmxhbihwcm90bykpIHsKKwkJc3RydWN0IHZsYW5faGRyIHZoZHIsICp2aDsKKwor
CQl2aCA9IHNrYl9oZWFkZXJfcG9pbnRlcihza2IsIG9mZnNldCwgc2l6ZW9mKHZoZHIpLCAmdmhk
cik7CisJCWlmICghdmgpCisJCQlicmVhazsKKworCQlwcm90byA9IHZoLT5oX3ZsYW5fZW5jYXBz
dWxhdGVkX3Byb3RvOworCQlvZmZzZXQgKz0gc2l6ZW9mKHZoZHIpOworCX0KKworCXJldHVybiBw
cm90bzsKK30KKwogc3RhdGljIGlubGluZSBib29sIHZsYW5faHdfb2ZmbG9hZF9jYXBhYmxlKG5l
dGRldl9mZWF0dXJlc190IGZlYXR1cmVzLAogCQkJCQkgICBfX2JlMTYgcHJvdG8pCiB7CmRpZmYg
LS1naXQgYS9pbmNsdWRlL25ldC9pbmV0X2Vjbi5oIGIvaW5jbHVkZS9uZXQvaW5ldF9lY24uaApp
bmRleCAwZjBkMWVmZTA2ZGQuLmUxZWFmMTc4MDI4OCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9uZXQv
aW5ldF9lY24uaAorKysgYi9pbmNsdWRlL25ldC9pbmV0X2Vjbi5oCkBAIC00LDYgKzQsNyBAQAog
CiAjaW5jbHVkZSA8bGludXgvaXAuaD4KICNpbmNsdWRlIDxsaW51eC9za2J1ZmYuaD4KKyNpbmNs
dWRlIDxsaW51eC9pZl92bGFuLmg+CiAKICNpbmNsdWRlIDxuZXQvaW5ldF9zb2NrLmg+CiAjaW5j
bHVkZSA8bmV0L2RzZmllbGQuaD4KQEAgLTE3Miw3ICsxNzMsNyBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgaXB2Nl9jb3B5X2RzY3AodW5zaWduZWQgaW50IGRzY3AsIHN0cnVjdCBpcHY2aGRyICppbm5l
cikKIAogc3RhdGljIGlubGluZSBpbnQgSU5FVF9FQ05fc2V0X2NlKHN0cnVjdCBza19idWZmICpz
a2IpCiB7Ci0Jc3dpdGNoIChza2ItPnByb3RvY29sKSB7CisJc3dpdGNoIChza2JfcHJvdG9jb2wo
c2tiLCB0cnVlKSkgewogCWNhc2UgY3B1X3RvX2JlMTYoRVRIX1BfSVApOgogCQlpZiAoc2tiX25l
dHdvcmtfaGVhZGVyKHNrYikgKyBzaXplb2Yoc3RydWN0IGlwaGRyKSA8PQogCQkgICAgc2tiX3Rh
aWxfcG9pbnRlcihza2IpKQpAQCAtMTkxLDcgKzE5Miw3IEBAIHN0YXRpYyBpbmxpbmUgaW50IElO
RVRfRUNOX3NldF9jZShzdHJ1Y3Qgc2tfYnVmZiAqc2tiKQogCiBzdGF0aWMgaW5saW5lIGludCBJ
TkVUX0VDTl9zZXRfZWN0MShzdHJ1Y3Qgc2tfYnVmZiAqc2tiKQogewotCXN3aXRjaCAoc2tiLT5w
cm90b2NvbCkgeworCXN3aXRjaCAoc2tiX3Byb3RvY29sKHNrYiwgdHJ1ZSkpIHsKIAljYXNlIGNw
dV90b19iZTE2KEVUSF9QX0lQKToKIAkJaWYgKHNrYl9uZXR3b3JrX2hlYWRlcihza2IpICsgc2l6
ZW9mKHN0cnVjdCBpcGhkcikgPD0KIAkJICAgIHNrYl90YWlsX3BvaW50ZXIoc2tiKSkKQEAgLTI3
MiwxMiArMjczLDE2IEBAIHN0YXRpYyBpbmxpbmUgaW50IElQX0VDTl9kZWNhcHN1bGF0ZShjb25z
dCBzdHJ1Y3QgaXBoZHIgKm9pcGgsCiB7CiAJX191OCBpbm5lcjsKIAotCWlmIChza2ItPnByb3Rv
Y29sID09IGh0b25zKEVUSF9QX0lQKSkKKwlzd2l0Y2ggKHNrYl9wcm90b2NvbChza2IsIHRydWUp
KSB7CisJY2FzZSBodG9ucyhFVEhfUF9JUCk6CiAJCWlubmVyID0gaXBfaGRyKHNrYiktPnRvczsK
LQllbHNlIGlmIChza2ItPnByb3RvY29sID09IGh0b25zKEVUSF9QX0lQVjYpKQorCQlicmVhazsK
KwljYXNlIGh0b25zKEVUSF9QX0lQVjYpOgogCQlpbm5lciA9IGlwdjZfZ2V0X2RzZmllbGQoaXB2
Nl9oZHIoc2tiKSk7Ci0JZWxzZQorCQlicmVhazsKKwlkZWZhdWx0OgogCQlyZXR1cm4gMDsKKwl9
CiAKIAlyZXR1cm4gSU5FVF9FQ05fZGVjYXBzdWxhdGUoc2tiLCBvaXBoLT50b3MsIGlubmVyKTsK
IH0KQEAgLTI4NywxMiArMjkyLDE2IEBAIHN0YXRpYyBpbmxpbmUgaW50IElQNl9FQ05fZGVjYXBz
dWxhdGUoY29uc3Qgc3RydWN0IGlwdjZoZHIgKm9pcHY2aCwKIHsKIAlfX3U4IGlubmVyOwogCi0J
aWYgKHNrYi0+cHJvdG9jb2wgPT0gaHRvbnMoRVRIX1BfSVApKQorCXN3aXRjaCAoc2tiX3Byb3Rv
Y29sKHNrYiwgdHJ1ZSkpIHsKKwljYXNlIGh0b25zKEVUSF9QX0lQKToKIAkJaW5uZXIgPSBpcF9o
ZHIoc2tiKS0+dG9zOwotCWVsc2UgaWYgKHNrYi0+cHJvdG9jb2wgPT0gaHRvbnMoRVRIX1BfSVBW
NikpCisJCWJyZWFrOworCWNhc2UgaHRvbnMoRVRIX1BfSVBWNik6CiAJCWlubmVyID0gaXB2Nl9n
ZXRfZHNmaWVsZChpcHY2X2hkcihza2IpKTsKLQllbHNlCisJCWJyZWFrOworCWRlZmF1bHQ6CiAJ
CXJldHVybiAwOworCX0KIAogCXJldHVybiBJTkVUX0VDTl9kZWNhcHN1bGF0ZShza2IsIGlwdjZf
Z2V0X2RzZmllbGQob2lwdjZoKSwgaW5uZXIpOwogfQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9uZXQv
cGt0X3NjaGVkLmggYi9pbmNsdWRlL25ldC9wa3Rfc2NoZWQuaAppbmRleCA5MDkyZTY5NzA1OWUu
LmFjOGM4OTBhMjY1NyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9uZXQvcGt0X3NjaGVkLmgKKysrIGIv
aW5jbHVkZS9uZXQvcGt0X3NjaGVkLmgKQEAgLTEzNiwxNyArMTM2LDYgQEAgc3RhdGljIGlubGlu
ZSB2b2lkIHFkaXNjX3J1bihzdHJ1Y3QgUWRpc2MgKnEpCiAJfQogfQogCi1zdGF0aWMgaW5saW5l
IF9fYmUxNiB0Y19za2JfcHJvdG9jb2woY29uc3Qgc3RydWN0IHNrX2J1ZmYgKnNrYikKLXsKLQkv
KiBXZSBuZWVkIHRvIHRha2UgZXh0cmEgY2FyZSBpbiBjYXNlIHRoZSBza2IgY2FtZSB2aWEKLQkg
KiB2bGFuIGFjY2VsZXJhdGVkIHBhdGguIEluIHRoYXQgY2FzZSwgdXNlIHNrYi0+dmxhbl9wcm90
bwotCSAqIGFzIHRoZSBvcmlnaW5hbCB2bGFuIGhlYWRlciB3YXMgYWxyZWFkeSBzdHJpcHBlZC4K
LQkgKi8KLQlpZiAoc2tiX3ZsYW5fdGFnX3ByZXNlbnQoc2tiKSkKLQkJcmV0dXJuIHNrYi0+dmxh
bl9wcm90bzsKLQlyZXR1cm4gc2tiLT5wcm90b2NvbDsKLX0KLQogLyogQ2FsY3VsYXRlIG1heGlt
YWwgc2l6ZSBvZiBwYWNrZXQgc2VlbiBieSBoYXJkX3N0YXJ0X3htaXQKICAgIHJvdXRpbmUgb2Yg
dGhpcyBkZXZpY2UuCiAgKi8KZGlmZiAtLWdpdCBhL25ldC9jb3JlL2ZpbHRlci5jIGIvbmV0L2Nv
cmUvZmlsdGVyLmMKaW5kZXggNzMzOTUzODRhZmUyLi44MmUxYjViMDYxNjcgMTAwNjQ0Ci0tLSBh
L25ldC9jb3JlL2ZpbHRlci5jCisrKyBiL25ldC9jb3JlL2ZpbHRlci5jCkBAIC01ODUzLDEyICs1
ODUzLDE2IEBAIEJQRl9DQUxMXzEoYnBmX3NrYl9lY25fc2V0X2NlLCBzdHJ1Y3Qgc2tfYnVmZiAq
LCBza2IpCiB7CiAJdW5zaWduZWQgaW50IGlwaGRyX2xlbjsKIAotCWlmIChza2ItPnByb3RvY29s
ID09IGNwdV90b19iZTE2KEVUSF9QX0lQKSkKKwlzd2l0Y2ggKHNrYl9wcm90b2NvbChza2IsIHRy
dWUpKSB7CisJY2FzZSBjcHVfdG9fYmUxNihFVEhfUF9JUCk6CiAJCWlwaGRyX2xlbiA9IHNpemVv
ZihzdHJ1Y3QgaXBoZHIpOwotCWVsc2UgaWYgKHNrYi0+cHJvdG9jb2wgPT0gY3B1X3RvX2JlMTYo
RVRIX1BfSVBWNikpCisJCWJyZWFrOworCWNhc2UgY3B1X3RvX2JlMTYoRVRIX1BfSVBWNik6CiAJ
CWlwaGRyX2xlbiA9IHNpemVvZihzdHJ1Y3QgaXB2Nmhkcik7Ci0JZWxzZQorCQlicmVhazsKKwlk
ZWZhdWx0OgogCQlyZXR1cm4gMDsKKwl9CiAKIAlpZiAoc2tiX2hlYWRsZW4oc2tiKSA8IGlwaGRy
X2xlbikKIAkJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9uZXQvc2NoZWQvYWN0X2Nvbm5tYXJrLmMg
Yi9uZXQvc2NoZWQvYWN0X2Nvbm5tYXJrLmMKaW5kZXggNDNhMjQzMDgxZTdkLi5mOTAxNDIxYjA2
MzQgMTAwNjQ0Ci0tLSBhL25ldC9zY2hlZC9hY3RfY29ubm1hcmsuYworKysgYi9uZXQvc2NoZWQv
YWN0X2Nvbm5tYXJrLmMKQEAgLTQzLDE3ICs0MywyMCBAQCBzdGF0aWMgaW50IHRjZl9jb25ubWFy
a19hY3Qoc3RydWN0IHNrX2J1ZmYgKnNrYiwgY29uc3Qgc3RydWN0IHRjX2FjdGlvbiAqYSwKIAl0
Y2ZfbGFzdHVzZV91cGRhdGUoJmNhLT50Y2ZfdG0pOwogCWJzdGF0c191cGRhdGUoJmNhLT50Y2Zf
YnN0YXRzLCBza2IpOwogCi0JaWYgKHNrYi0+cHJvdG9jb2wgPT0gaHRvbnMoRVRIX1BfSVApKSB7
CisJc3dpdGNoIChza2JfcHJvdG9jb2woc2tiLCB0cnVlKSkgeworCWNhc2UgaHRvbnMoRVRIX1Bf
SVApOgogCQlpZiAoc2tiLT5sZW4gPCBzaXplb2Yoc3RydWN0IGlwaGRyKSkKIAkJCWdvdG8gb3V0
OwogCiAJCXByb3RvID0gTkZQUk9UT19JUFY0OwotCX0gZWxzZSBpZiAoc2tiLT5wcm90b2NvbCA9
PSBodG9ucyhFVEhfUF9JUFY2KSkgeworCQlicmVhazsKKwljYXNlIGh0b25zKEVUSF9QX0lQVjYp
OgogCQlpZiAoc2tiLT5sZW4gPCBzaXplb2Yoc3RydWN0IGlwdjZoZHIpKQogCQkJZ290byBvdXQ7
CiAKIAkJcHJvdG8gPSBORlBST1RPX0lQVjY7Ci0JfSBlbHNlIHsKKwkJYnJlYWs7CisJZGVmYXVs
dDoKIAkJZ290byBvdXQ7CiAJfQogCmRpZmYgLS1naXQgYS9uZXQvc2NoZWQvYWN0X2NzdW0uYyBi
L25ldC9zY2hlZC9hY3RfY3N1bS5jCmluZGV4IGNiODYwOGYwYTc3YS4uYzYwNjc0Y2YyNWM0IDEw
MDY0NAotLS0gYS9uZXQvc2NoZWQvYWN0X2NzdW0uYworKysgYi9uZXQvc2NoZWQvYWN0X2NzdW0u
YwpAQCAtNTg3LDcgKzU4Nyw3IEBAIHN0YXRpYyBpbnQgdGNmX2NzdW1fYWN0KHN0cnVjdCBza19i
dWZmICpza2IsIGNvbnN0IHN0cnVjdCB0Y19hY3Rpb24gKmEsCiAJCWdvdG8gZHJvcDsKIAogCXVw
ZGF0ZV9mbGFncyA9IHBhcmFtcy0+dXBkYXRlX2ZsYWdzOwotCXByb3RvY29sID0gdGNfc2tiX3By
b3RvY29sKHNrYik7CisJcHJvdG9jb2wgPSBza2JfcHJvdG9jb2woc2tiLCBmYWxzZSk7CiBhZ2Fp
bjoKIAlzd2l0Y2ggKHByb3RvY29sKSB7CiAJY2FzZSBjcHVfdG9fYmUxNihFVEhfUF9JUCk6CmRp
ZmYgLS1naXQgYS9uZXQvc2NoZWQvYWN0X2N0LmMgYi9uZXQvc2NoZWQvYWN0X2N0LmMKaW5kZXgg
ZTlmMzU3NmNiZjcxLi44NmVkMDI0ODc0NjcgMTAwNjQ0Ci0tLSBhL25ldC9zY2hlZC9hY3RfY3Qu
YworKysgYi9uZXQvc2NoZWQvYWN0X2N0LmMKQEAgLTYyNCw3ICs2MjQsNyBAQCBzdGF0aWMgdTgg
dGNmX2N0X3NrYl9uZl9mYW1pbHkoc3RydWN0IHNrX2J1ZmYgKnNrYikKIHsKIAl1OCBmYW1pbHkg
PSBORlBST1RPX1VOU1BFQzsKIAotCXN3aXRjaCAoc2tiLT5wcm90b2NvbCkgeworCXN3aXRjaCAo
c2tiX3Byb3RvY29sKHNrYiwgdHJ1ZSkpIHsKIAljYXNlIGh0b25zKEVUSF9QX0lQKToKIAkJZmFt
aWx5ID0gTkZQUk9UT19JUFY0OwogCQlicmVhazsKQEAgLTc0OCw2ICs3NDgsNyBAQCBzdGF0aWMg
aW50IGN0X25hdF9leGVjdXRlKHN0cnVjdCBza19idWZmICpza2IsIHN0cnVjdCBuZl9jb25uICpj
dCwKIAkJCSAgY29uc3Qgc3RydWN0IG5mX25hdF9yYW5nZTIgKnJhbmdlLAogCQkJICBlbnVtIG5m
X25hdF9tYW5pcF90eXBlIG1hbmlwdHlwZSkKIHsKKwlfX2JlMTYgcHJvdG8gPSBza2JfcHJvdG9j
b2woc2tiLCB0cnVlKTsKIAlpbnQgaG9va251bSwgZXJyID0gTkZfQUNDRVBUOwogCiAJLyogU2Vl
IEhPT0syTUFOSVAoKS4gKi8KQEAgLTc1OSwxNCArNzYwLDEzIEBAIHN0YXRpYyBpbnQgY3RfbmF0
X2V4ZWN1dGUoc3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0IG5mX2Nvbm4gKmN0LAogCXN3aXRj
aCAoY3RpbmZvKSB7CiAJY2FzZSBJUF9DVF9SRUxBVEVEOgogCWNhc2UgSVBfQ1RfUkVMQVRFRF9S
RVBMWToKLQkJaWYgKHNrYi0+cHJvdG9jb2wgPT0gaHRvbnMoRVRIX1BfSVApICYmCisJCWlmIChw
cm90byA9PSBodG9ucyhFVEhfUF9JUCkgJiYKIAkJICAgIGlwX2hkcihza2IpLT5wcm90b2NvbCA9
PSBJUFBST1RPX0lDTVApIHsKIAkJCWlmICghbmZfbmF0X2ljbXBfcmVwbHlfdHJhbnNsYXRpb24o
c2tiLCBjdCwgY3RpbmZvLAogCQkJCQkJCSAgIGhvb2tudW0pKQogCQkJCWVyciA9IE5GX0RST1A7
CiAJCQlnb3RvIG91dDsKLQkJfSBlbHNlIGlmIChJU19FTkFCTEVEKENPTkZJR19JUFY2KSAmJgot
CQkJICAgc2tiLT5wcm90b2NvbCA9PSBodG9ucyhFVEhfUF9JUFY2KSkgeworCQl9IGVsc2UgaWYg
KElTX0VOQUJMRUQoQ09ORklHX0lQVjYpICYmIHByb3RvID09IGh0b25zKEVUSF9QX0lQVjYpKSB7
CiAJCQlfX2JlMTYgZnJhZ19vZmY7CiAJCQl1OCBuZXh0aGRyID0gaXB2Nl9oZHIoc2tiKS0+bmV4
dGhkcjsKIAkJCWludCBoZHJsZW4gPSBpcHY2X3NraXBfZXh0aGRyKHNrYiwKQEAgLTE1NTAsNCAr
MTU1MCwzIEBAIE1PRFVMRV9BVVRIT1IoIllvc3NpIEt1cGVybWFuIDx5b3NzaWt1QG1lbGxhbm94
LmNvbT4iKTsKIE1PRFVMRV9BVVRIT1IoIk1hcmNlbG8gUmljYXJkbyBMZWl0bmVyIDxtYXJjZWxv
LmxlaXRuZXJAZ21haWwuY29tPiIpOwogTU9EVUxFX0RFU0NSSVBUSU9OKCJDb25uZWN0aW9uIHRy
YWNraW5nIGFjdGlvbiIpOwogTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIpOwotCmRpZmYgLS1naXQg
YS9uZXQvc2NoZWQvYWN0X2N0aW5mby5jIGIvbmV0L3NjaGVkL2FjdF9jdGluZm8uYwppbmRleCAx
OTY0OTYyMzQ5M2IuLmI1MDQyZjNlYTA3OSAxMDA2NDQKLS0tIGEvbmV0L3NjaGVkL2FjdF9jdGlu
Zm8uYworKysgYi9uZXQvc2NoZWQvYWN0X2N0aW5mby5jCkBAIC05NiwxOSArOTYsMjIgQEAgc3Rh
dGljIGludCB0Y2ZfY3RpbmZvX2FjdChzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBjb25zdCBzdHJ1Y3Qg
dGNfYWN0aW9uICphLAogCWFjdGlvbiA9IFJFQURfT05DRShjYS0+dGNmX2FjdGlvbik7CiAKIAl3
bGVuID0gc2tiX25ldHdvcmtfb2Zmc2V0KHNrYik7Ci0JaWYgKHRjX3NrYl9wcm90b2NvbChza2Ip
ID09IGh0b25zKEVUSF9QX0lQKSkgeworCXN3aXRjaCAoc2tiX3Byb3RvY29sKHNrYiwgdHJ1ZSkp
IHsKKwljYXNlIGh0b25zKEVUSF9QX0lQKToKIAkJd2xlbiArPSBzaXplb2Yoc3RydWN0IGlwaGRy
KTsKIAkJaWYgKCFwc2tiX21heV9wdWxsKHNrYiwgd2xlbikpCiAJCQlnb3RvIG91dDsKIAogCQlw
cm90byA9IE5GUFJPVE9fSVBWNDsKLQl9IGVsc2UgaWYgKHRjX3NrYl9wcm90b2NvbChza2IpID09
IGh0b25zKEVUSF9QX0lQVjYpKSB7CisJCWJyZWFrOworCWNhc2UgaHRvbnMoRVRIX1BfSVBWNik6
CiAJCXdsZW4gKz0gc2l6ZW9mKHN0cnVjdCBpcHY2aGRyKTsKIAkJaWYgKCFwc2tiX21heV9wdWxs
KHNrYiwgd2xlbikpCiAJCQlnb3RvIG91dDsKIAogCQlwcm90byA9IE5GUFJPVE9fSVBWNjsKLQl9
IGVsc2UgeworCQlicmVhazsKKwlkZWZhdWx0OgogCQlnb3RvIG91dDsKIAl9CiAKZGlmZiAtLWdp
dCBhL25ldC9zY2hlZC9hY3RfbXBscy5jIGIvbmV0L3NjaGVkL2FjdF9tcGxzLmMKaW5kZXggYmUz
ZjIxNWNkMDI3Li44MTE4ZTI2NDA5NzkgMTAwNjQ0Ci0tLSBhL25ldC9zY2hlZC9hY3RfbXBscy5j
CisrKyBiL25ldC9zY2hlZC9hY3RfbXBscy5jCkBAIC04Miw3ICs4Miw3IEBAIHN0YXRpYyBpbnQg
dGNmX21wbHNfYWN0KHN0cnVjdCBza19idWZmICpza2IsIGNvbnN0IHN0cnVjdCB0Y19hY3Rpb24g
KmEsCiAJCQlnb3RvIGRyb3A7CiAJCWJyZWFrOwogCWNhc2UgVENBX01QTFNfQUNUX1BVU0g6Ci0J
CW5ld19sc2UgPSB0Y2ZfbXBsc19nZXRfbHNlKE5VTEwsIHAsICFldGhfcF9tcGxzKHNrYi0+cHJv
dG9jb2wpKTsKKwkJbmV3X2xzZSA9IHRjZl9tcGxzX2dldF9sc2UoTlVMTCwgcCwgIWV0aF9wX21w
bHMoc2tiX3Byb3RvY29sKHNrYiwgdHJ1ZSkpKTsKIAkJaWYgKHNrYl9tcGxzX3B1c2goc2tiLCBu
ZXdfbHNlLCBwLT50Y2ZtX3Byb3RvLCBtYWNfbGVuLAogCQkJCSAgc2tiLT5kZXYgJiYgc2tiLT5k
ZXYtPnR5cGUgPT0gQVJQSFJEX0VUSEVSKSkKIAkJCWdvdG8gZHJvcDsKZGlmZiAtLWdpdCBhL25l
dC9zY2hlZC9hY3Rfc2tiZWRpdC5jIGIvbmV0L3NjaGVkL2FjdF9za2JlZGl0LmMKaW5kZXggYjEy
NWIyYmU0NDY3Li5iMmIzZmFhNTcyOTQgMTAwNjQ0Ci0tLSBhL25ldC9zY2hlZC9hY3Rfc2tiZWRp
dC5jCisrKyBiL25ldC9zY2hlZC9hY3Rfc2tiZWRpdC5jCkBAIC00MSw3ICs0MSw3IEBAIHN0YXRp
YyBpbnQgdGNmX3NrYmVkaXRfYWN0KHN0cnVjdCBza19idWZmICpza2IsIGNvbnN0IHN0cnVjdCB0
Y19hY3Rpb24gKmEsCiAJaWYgKHBhcmFtcy0+ZmxhZ3MgJiBTS0JFRElUX0ZfSU5IRVJJVERTRklF
TEQpIHsKIAkJaW50IHdsZW4gPSBza2JfbmV0d29ya19vZmZzZXQoc2tiKTsKIAotCQlzd2l0Y2gg
KHRjX3NrYl9wcm90b2NvbChza2IpKSB7CisJCXN3aXRjaCAoc2tiX3Byb3RvY29sKHNrYiwgdHJ1
ZSkpIHsKIAkJY2FzZSBodG9ucyhFVEhfUF9JUCk6CiAJCQl3bGVuICs9IHNpemVvZihzdHJ1Y3Qg
aXBoZHIpOwogCQkJaWYgKCFwc2tiX21heV9wdWxsKHNrYiwgd2xlbikpCmRpZmYgLS1naXQgYS9u
ZXQvc2NoZWQvY2xzX2FwaS5jIGIvbmV0L3NjaGVkL2Nsc19hcGkuYwppbmRleCBmYWE3OGI3ZGQ5
NjIuLmU2MmJlZWMwZDg0NCAxMDA2NDQKLS0tIGEvbmV0L3NjaGVkL2Nsc19hcGkuYworKysgYi9u
ZXQvc2NoZWQvY2xzX2FwaS5jCkBAIC0xNTM4LDcgKzE1MzgsNyBAQCBzdGF0aWMgaW5saW5lIGlu
dCBfX3RjZl9jbGFzc2lmeShzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogcmVjbGFzc2lmeToKICNlbmRp
ZgogCWZvciAoOyB0cDsgdHAgPSByY3VfZGVyZWZlcmVuY2VfYmgodHAtPm5leHQpKSB7Ci0JCV9f
YmUxNiBwcm90b2NvbCA9IHRjX3NrYl9wcm90b2NvbChza2IpOworCQlfX2JlMTYgcHJvdG9jb2wg
PSBza2JfcHJvdG9jb2woc2tiLCBmYWxzZSk7CiAJCWludCBlcnI7CiAKIAkJaWYgKHRwLT5wcm90
b2NvbCAhPSBwcm90b2NvbCAmJgpkaWZmIC0tZ2l0IGEvbmV0L3NjaGVkL2Nsc19mbG93LmMgYi9u
ZXQvc2NoZWQvY2xzX2Zsb3cuYwppbmRleCA4MGFlN2I5ZmE5MGEuLmFiNTNhOTNiMmYyYiAxMDA2
NDQKLS0tIGEvbmV0L3NjaGVkL2Nsc19mbG93LmMKKysrIGIvbmV0L3NjaGVkL2Nsc19mbG93LmMK
QEAgLTgwLDcgKzgwLDcgQEAgc3RhdGljIHUzMiBmbG93X2dldF9kc3QoY29uc3Qgc3RydWN0IHNr
X2J1ZmYgKnNrYiwgY29uc3Qgc3RydWN0IGZsb3dfa2V5cyAqZmxvdykKIAlpZiAoZHN0KQogCQly
ZXR1cm4gbnRvaGwoZHN0KTsKIAotCXJldHVybiBhZGRyX2ZvbGQoc2tiX2RzdChza2IpKSBeIChf
X2ZvcmNlIHUxNikgdGNfc2tiX3Byb3RvY29sKHNrYik7CisJcmV0dXJuIGFkZHJfZm9sZChza2Jf
ZHN0KHNrYikpIF4gKF9fZm9yY2UgdTE2KXNrYl9wcm90b2NvbChza2IsIHRydWUpOwogfQogCiBz
dGF0aWMgdTMyIGZsb3dfZ2V0X3Byb3RvKGNvbnN0IHN0cnVjdCBza19idWZmICpza2IsCkBAIC0x
MDQsNyArMTA0LDcgQEAgc3RhdGljIHUzMiBmbG93X2dldF9wcm90b19kc3QoY29uc3Qgc3RydWN0
IHNrX2J1ZmYgKnNrYiwKIAlpZiAoZmxvdy0+cG9ydHMucG9ydHMpCiAJCXJldHVybiBudG9ocyhm
bG93LT5wb3J0cy5kc3QpOwogCi0JcmV0dXJuIGFkZHJfZm9sZChza2JfZHN0KHNrYikpIF4gKF9f
Zm9yY2UgdTE2KSB0Y19za2JfcHJvdG9jb2woc2tiKTsKKwlyZXR1cm4gYWRkcl9mb2xkKHNrYl9k
c3Qoc2tiKSkgXiAoX19mb3JjZSB1MTYpc2tiX3Byb3RvY29sKHNrYiwgdHJ1ZSk7CiB9CiAKIHN0
YXRpYyB1MzIgZmxvd19nZXRfaWlmKGNvbnN0IHN0cnVjdCBza19idWZmICpza2IpCkBAIC0xNTEs
NyArMTUxLDcgQEAgc3RhdGljIHUzMiBmbG93X2dldF9uZmN0KGNvbnN0IHN0cnVjdCBza19idWZm
ICpza2IpCiBzdGF0aWMgdTMyIGZsb3dfZ2V0X25mY3Rfc3JjKGNvbnN0IHN0cnVjdCBza19idWZm
ICpza2IsCiAJCQkgICAgIGNvbnN0IHN0cnVjdCBmbG93X2tleXMgKmZsb3cpCiB7Ci0Jc3dpdGNo
ICh0Y19za2JfcHJvdG9jb2woc2tiKSkgeworCXN3aXRjaCAoc2tiX3Byb3RvY29sKHNrYiwgdHJ1
ZSkpIHsKIAljYXNlIGh0b25zKEVUSF9QX0lQKToKIAkJcmV0dXJuIG50b2hsKENUVFVQTEUoc2ti
LCBzcmMudTMuaXApKTsKIAljYXNlIGh0b25zKEVUSF9QX0lQVjYpOgpAQCAtMTY0LDcgKzE2NCw3
IEBAIHN0YXRpYyB1MzIgZmxvd19nZXRfbmZjdF9zcmMoY29uc3Qgc3RydWN0IHNrX2J1ZmYgKnNr
YiwKIHN0YXRpYyB1MzIgZmxvd19nZXRfbmZjdF9kc3QoY29uc3Qgc3RydWN0IHNrX2J1ZmYgKnNr
YiwKIAkJCSAgICAgY29uc3Qgc3RydWN0IGZsb3dfa2V5cyAqZmxvdykKIHsKLQlzd2l0Y2ggKHRj
X3NrYl9wcm90b2NvbChza2IpKSB7CisJc3dpdGNoIChza2JfcHJvdG9jb2woc2tiLCB0cnVlKSkg
ewogCWNhc2UgaHRvbnMoRVRIX1BfSVApOgogCQlyZXR1cm4gbnRvaGwoQ1RUVVBMRShza2IsIGRz
dC51My5pcCkpOwogCWNhc2UgaHRvbnMoRVRIX1BfSVBWNik6CmRpZmYgLS1naXQgYS9uZXQvc2No
ZWQvY2xzX2Zsb3dlci5jIGIvbmV0L3NjaGVkL2Nsc19mbG93ZXIuYwppbmRleCBiMmRhMzcyODYw
ODIuLmUzMGJkOTY5ZmM0OCAxMDA2NDQKLS0tIGEvbmV0L3NjaGVkL2Nsc19mbG93ZXIuYworKysg
Yi9uZXQvc2NoZWQvY2xzX2Zsb3dlci5jCkBAIC0zMTMsNyArMzEzLDcgQEAgc3RhdGljIGludCBm
bF9jbGFzc2lmeShzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBjb25zdCBzdHJ1Y3QgdGNmX3Byb3RvICp0
cCwKIAkJLyogc2tiX2Zsb3dfZGlzc2VjdCgpIGRvZXMgbm90IHNldCBuX3Byb3RvIGluIGNhc2Ug
YW4gdW5rbm93bgogCQkgKiBwcm90b2NvbCwgc28gZG8gaXQgcmF0aGVyIGhlcmUuCiAJCSAqLwot
CQlza2Jfa2V5LmJhc2ljLm5fcHJvdG8gPSBza2ItPnByb3RvY29sOworCQlza2Jfa2V5LmJhc2lj
Lm5fcHJvdG8gPSBza2JfcHJvdG9jb2woc2tiLCBmYWxzZSk7CiAJCXNrYl9mbG93X2Rpc3NlY3Rf
dHVubmVsX2luZm8oc2tiLCAmbWFzay0+ZGlzc2VjdG9yLCAmc2tiX2tleSk7CiAJCXNrYl9mbG93
X2Rpc3NlY3RfY3Qoc2tiLCAmbWFzay0+ZGlzc2VjdG9yLCAmc2tiX2tleSwKIAkJCQkgICAgZmxf
Y3RfaW5mb190b19mbG93ZXJfbWFwLApkaWZmIC0tZ2l0IGEvbmV0L3NjaGVkL2VtX2lwc2V0LmMg
Yi9uZXQvc2NoZWQvZW1faXBzZXQuYwppbmRleCBkZjAwNTY2ZDMyN2QuLmM5NWNmODZmYjQzMSAx
MDA2NDQKLS0tIGEvbmV0L3NjaGVkL2VtX2lwc2V0LmMKKysrIGIvbmV0L3NjaGVkL2VtX2lwc2V0
LmMKQEAgLTU5LDcgKzU5LDcgQEAgc3RhdGljIGludCBlbV9pcHNldF9tYXRjaChzdHJ1Y3Qgc2tf
YnVmZiAqc2tiLCBzdHJ1Y3QgdGNmX2VtYXRjaCAqZW0sCiAJfTsKIAlpbnQgcmV0LCBuZXR3b3Jr
X29mZnNldDsKIAotCXN3aXRjaCAodGNfc2tiX3Byb3RvY29sKHNrYikpIHsKKwlzd2l0Y2ggKHNr
Yl9wcm90b2NvbChza2IsIHRydWUpKSB7CiAJY2FzZSBodG9ucyhFVEhfUF9JUCk6CiAJCXN0YXRl
LnBmID0gTkZQUk9UT19JUFY0OwogCQlpZiAoIXBza2JfbmV0d29ya19tYXlfcHVsbChza2IsIHNp
emVvZihzdHJ1Y3QgaXBoZHIpKSkKZGlmZiAtLWdpdCBhL25ldC9zY2hlZC9lbV9pcHQuYyBiL25l
dC9zY2hlZC9lbV9pcHQuYwppbmRleCAxODc1NWQyOWZkMTUuLjM2NTAxMTdkYTQ3ZiAxMDA2NDQK
LS0tIGEvbmV0L3NjaGVkL2VtX2lwdC5jCisrKyBiL25ldC9zY2hlZC9lbV9pcHQuYwpAQCAtMjEy
LDcgKzIxMiw3IEBAIHN0YXRpYyBpbnQgZW1faXB0X21hdGNoKHN0cnVjdCBza19idWZmICpza2Is
IHN0cnVjdCB0Y2ZfZW1hdGNoICplbSwKIAlzdHJ1Y3QgbmZfaG9va19zdGF0ZSBzdGF0ZTsKIAlp
bnQgcmV0OwogCi0Jc3dpdGNoICh0Y19za2JfcHJvdG9jb2woc2tiKSkgeworCXN3aXRjaCAoc2ti
X3Byb3RvY29sKHNrYiwgdHJ1ZSkpIHsKIAljYXNlIGh0b25zKEVUSF9QX0lQKToKIAkJaWYgKCFw
c2tiX25ldHdvcmtfbWF5X3B1bGwoc2tiLCBzaXplb2Yoc3RydWN0IGlwaGRyKSkpCiAJCQlyZXR1
cm4gMDsKZGlmZiAtLWdpdCBhL25ldC9zY2hlZC9lbV9tZXRhLmMgYi9uZXQvc2NoZWQvZW1fbWV0
YS5jCmluZGV4IGQ5OTk2NmE1NWM4NC4uNDYyNTQ5NjhkMzkwIDEwMDY0NAotLS0gYS9uZXQvc2No
ZWQvZW1fbWV0YS5jCisrKyBiL25ldC9zY2hlZC9lbV9tZXRhLmMKQEAgLTE5NSw3ICsxOTUsNyBA
QCBNRVRBX0NPTExFQ1RPUihpbnRfcHJpb3JpdHkpCiBNRVRBX0NPTExFQ1RPUihpbnRfcHJvdG9j
b2wpCiB7CiAJLyogTGV0IHVzZXJzcGFjZSB0YWtlIGNhcmUgb2YgdGhlIGJ5dGUgb3JkZXJpbmcg
Ki8KLQlkc3QtPnZhbHVlID0gdGNfc2tiX3Byb3RvY29sKHNrYik7CisJZHN0LT52YWx1ZSA9IHNr
Yl9wcm90b2NvbChza2IsIGZhbHNlKTsKIH0KIAogTUVUQV9DT0xMRUNUT1IoaW50X3BrdHR5cGUp
CmRpZmYgLS1naXQgYS9uZXQvc2NoZWQvc2NoX2Nha2UuYyBiL25ldC9zY2hlZC9zY2hfY2FrZS5j
CmluZGV4IGNhODEzNjk3NzI4ZS4uZWJhZWVjMWU1YzgyIDEwMDY0NAotLS0gYS9uZXQvc2NoZWQv
c2NoX2Nha2UuYworKysgYi9uZXQvc2NoZWQvc2NoX2Nha2UuYwpAQCAtNTkyLDcgKzU5Miw3IEBA
IHN0YXRpYyBib29sIGNha2VfdXBkYXRlX2Zsb3drZXlzKHN0cnVjdCBmbG93X2tleXMgKmtleXMs
CiAJYm9vbCByZXYgPSAhc2tiLT5fbmZjdCwgdXBkID0gZmFsc2U7CiAJX19iZTMyIGlwOwogCi0J
aWYgKHRjX3NrYl9wcm90b2NvbChza2IpICE9IGh0b25zKEVUSF9QX0lQKSkKKwlpZiAoc2tiX3By
b3RvY29sKHNrYiwgdHJ1ZSkgIT0gaHRvbnMoRVRIX1BfSVApKQogCQlyZXR1cm4gZmFsc2U7CiAK
IAlpZiAoIW5mX2N0X2dldF90dXBsZV9za2IoJnR1cGxlLCBza2IpKQpAQCAtMTU1Nyw3ICsxNTU3
LDcgQEAgc3RhdGljIHU4IGNha2VfaGFuZGxlX2RpZmZzZXJ2KHN0cnVjdCBza19idWZmICpza2Is
IGJvb2wgd2FzaCkKIAl1MTYgKmJ1ZiwgYnVmXzsKIAl1OCBkc2NwOwogCi0Jc3dpdGNoICh0Y19z
a2JfcHJvdG9jb2woc2tiKSkgeworCXN3aXRjaCAoc2tiX3Byb3RvY29sKHNrYiwgdHJ1ZSkpIHsK
IAljYXNlIGh0b25zKEVUSF9QX0lQKToKIAkJYnVmID0gc2tiX2hlYWRlcl9wb2ludGVyKHNrYiwg
b2Zmc2V0LCBzaXplb2YoYnVmXyksICZidWZfKTsKIAkJaWYgKHVubGlrZWx5KCFidWYpKQpkaWZm
IC0tZ2l0IGEvbmV0L3NjaGVkL3NjaF9kc21hcmsuYyBiL25ldC9zY2hlZC9zY2hfZHNtYXJrLmMK
aW5kZXggMDU2MDViMzBiZWYzLi4yYjg4NzEwOTk0ZDcgMTAwNjQ0Ci0tLSBhL25ldC9zY2hlZC9z
Y2hfZHNtYXJrLmMKKysrIGIvbmV0L3NjaGVkL3NjaF9kc21hcmsuYwpAQCAtMjEwLDcgKzIxMCw3
IEBAIHN0YXRpYyBpbnQgZHNtYXJrX2VucXVldWUoc3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0
IFFkaXNjICpzY2gsCiAJaWYgKHAtPnNldF90Y19pbmRleCkgewogCQlpbnQgd2xlbiA9IHNrYl9u
ZXR3b3JrX29mZnNldChza2IpOwogCi0JCXN3aXRjaCAodGNfc2tiX3Byb3RvY29sKHNrYikpIHsK
KwkJc3dpdGNoIChza2JfcHJvdG9jb2woc2tiLCB0cnVlKSkgewogCQljYXNlIGh0b25zKEVUSF9Q
X0lQKToKIAkJCXdsZW4gKz0gc2l6ZW9mKHN0cnVjdCBpcGhkcik7CiAJCQlpZiAoIXBza2JfbWF5
X3B1bGwoc2tiLCB3bGVuKSB8fApAQCAtMzAzLDcgKzMwMyw3IEBAIHN0YXRpYyBzdHJ1Y3Qgc2tf
YnVmZiAqZHNtYXJrX2RlcXVldWUoc3RydWN0IFFkaXNjICpzY2gpCiAJaW5kZXggPSBza2ItPnRj
X2luZGV4ICYgKHAtPmluZGljZXMgLSAxKTsKIAlwcl9kZWJ1ZygiaW5kZXggJWQtPiVkXG4iLCBz
a2ItPnRjX2luZGV4LCBpbmRleCk7CiAKLQlzd2l0Y2ggKHRjX3NrYl9wcm90b2NvbChza2IpKSB7
CisJc3dpdGNoIChza2JfcHJvdG9jb2woc2tiLCB0cnVlKSkgewogCWNhc2UgaHRvbnMoRVRIX1Bf
SVApOgogCQlpcHY0X2NoYW5nZV9kc2ZpZWxkKGlwX2hkcihza2IpLCBwLT5tdltpbmRleF0ubWFz
aywKIAkJCQkgICAgcC0+bXZbaW5kZXhdLnZhbHVlKTsKQEAgLTMyMCw3ICszMjAsNyBAQCBzdGF0
aWMgc3RydWN0IHNrX2J1ZmYgKmRzbWFya19kZXF1ZXVlKHN0cnVjdCBRZGlzYyAqc2NoKQogCQkg
Ki8KIAkJaWYgKHAtPm12W2luZGV4XS5tYXNrICE9IDB4ZmYgfHwgcC0+bXZbaW5kZXhdLnZhbHVl
KQogCQkJcHJfd2FybigiJXM6IHVuc3VwcG9ydGVkIHByb3RvY29sICVkXG4iLAotCQkJCV9fZnVu
Y19fLCBudG9ocyh0Y19za2JfcHJvdG9jb2woc2tiKSkpOworCQkJCV9fZnVuY19fLCBudG9ocyhz
a2JfcHJvdG9jb2woc2tiLCB0cnVlKSkpOwogCQlicmVhazsKIAl9CiAKZGlmZiAtLWdpdCBhL25l
dC9zY2hlZC9zY2hfdGVxbC5jIGIvbmV0L3NjaGVkL3NjaF90ZXFsLmMKaW5kZXggNjg5ZWY2ZjNk
ZWQ4Li4yZjFmMGEzNzg0MDggMTAwNjQ0Ci0tLSBhL25ldC9zY2hlZC9zY2hfdGVxbC5jCisrKyBi
L25ldC9zY2hlZC9zY2hfdGVxbC5jCkBAIC0yMzksNyArMjM5LDcgQEAgX190ZXFsX3Jlc29sdmUo
c3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0IHNrX2J1ZmYgKnNrYl9yZXMsCiAJCWNoYXIgaGFk
ZHJbTUFYX0FERFJfTEVOXTsKIAogCQluZWlnaF9oYV9zbmFwc2hvdChoYWRkciwgbiwgZGV2KTsK
LQkJZXJyID0gZGV2X2hhcmRfaGVhZGVyKHNrYiwgZGV2LCBudG9ocyh0Y19za2JfcHJvdG9jb2wo
c2tiKSksCisJCWVyciA9IGRldl9oYXJkX2hlYWRlcihza2IsIGRldiwgbnRvaHMoc2tiX3Byb3Rv
Y29sKHNrYiwgZmFsc2UpKSwKIAkJCQkgICAgICBoYWRkciwgTlVMTCwgc2tiLT5sZW4pOwogCiAJ
CWlmIChlcnIgPCAwKQotLSAKMi4yNy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpDYWtlIG1haWxpbmcgbGlzdApDYWtlQGxpc3RzLmJ1ZmZlcmJsb2F0
Lm5ldApodHRwczovL2xpc3RzLmJ1ZmZlcmJsb2F0Lm5ldC9saXN0aW5mby9jYWtlCg==
